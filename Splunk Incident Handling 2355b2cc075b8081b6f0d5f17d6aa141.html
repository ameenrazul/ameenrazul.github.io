<html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><title>Splunk Incident Handling</title><style>
/* cspell:disable-file */
/* webkit printing magic: print all background colors */
html {
	-webkit-print-color-adjust: exact;
}
* {
	box-sizing: border-box;
	-webkit-print-color-adjust: exact;
}

html,
body {
	margin: 0;
	padding: 0;
}
@media only screen {
	body {
		margin: 2em auto;
		max-width: 900px;
		color: rgb(55, 53, 47);
	}
}

body {
	line-height: 1.5;
	white-space: pre-wrap;
}

a,
a.visited {
	color: inherit;
	text-decoration: underline;
}

.pdf-relative-link-path {
	font-size: 80%;
	color: #444;
}

h1,
h2,
h3 {
	letter-spacing: -0.01em;
	line-height: 1.2;
	font-weight: 600;
	margin-bottom: 0;
}

.page-title {
	font-size: 2.5rem;
	font-weight: 700;
	margin-top: 0;
	margin-bottom: 0.75em;
}

h1 {
	font-size: 1.875rem;
	margin-top: 1.875rem;
}

h2 {
	font-size: 1.5rem;
	margin-top: 1.5rem;
}

h3 {
	font-size: 1.25rem;
	margin-top: 1.25rem;
}

.source {
	border: 1px solid #ddd;
	border-radius: 3px;
	padding: 1.5em;
	word-break: break-all;
}

.callout {
	border-radius: 3px;
	padding: 1rem;
}

figure {
	margin: 1.25em 0;
	page-break-inside: avoid;
}

figcaption {
	opacity: 0.5;
	font-size: 85%;
	margin-top: 0.5em;
}

mark {
	background-color: transparent;
}

.indented {
	padding-left: 1.5em;
}

hr {
	background: transparent;
	display: block;
	width: 100%;
	height: 1px;
	visibility: visible;
	border: none;
	border-bottom: 1px solid rgba(55, 53, 47, 0.09);
}

img {
	max-width: 100%;
}

@media only print {
	img {
		max-height: 100vh;
		object-fit: contain;
	}
}

@page {
	margin: 1in;
}

.collection-content {
	font-size: 0.875rem;
}

.column-list {
	display: flex;
	justify-content: space-between;
}

.column {
	padding: 0 1em;
}

.column:first-child {
	padding-left: 0;
}

.column:last-child {
	padding-right: 0;
}

.table_of_contents-item {
	display: block;
	font-size: 0.875rem;
	line-height: 1.3;
	padding: 0.125rem;
}

.table_of_contents-indent-1 {
	margin-left: 1.5rem;
}

.table_of_contents-indent-2 {
	margin-left: 3rem;
}

.table_of_contents-indent-3 {
	margin-left: 4.5rem;
}

.table_of_contents-link {
	text-decoration: none;
	opacity: 0.7;
	border-bottom: 1px solid rgba(55, 53, 47, 0.18);
}

table,
th,
td {
	border: 1px solid rgba(55, 53, 47, 0.09);
	border-collapse: collapse;
}

table {
	border-left: none;
	border-right: none;
}

th,
td {
	font-weight: normal;
	padding: 0.25em 0.5em;
	line-height: 1.5;
	min-height: 1.5em;
	text-align: left;
}

th {
	color: rgba(55, 53, 47, 0.6);
}

ol,
ul {
	margin: 0;
	margin-block-start: 0.6em;
	margin-block-end: 0.6em;
}

li > ol:first-child,
li > ul:first-child {
	margin-block-start: 0.6em;
}

ul > li {
	list-style: disc;
}

ul.to-do-list {
	padding-inline-start: 0;
}

ul.to-do-list > li {
	list-style: none;
}

.to-do-children-checked {
	text-decoration: line-through;
	opacity: 0.375;
}

ul.toggle > li {
	list-style: none;
}

ul {
	padding-inline-start: 1.7em;
}

ul > li {
	padding-left: 0.1em;
}

ol {
	padding-inline-start: 1.6em;
}

ol > li {
	padding-left: 0.2em;
}

.mono ol {
	padding-inline-start: 2em;
}

.mono ol > li {
	text-indent: -0.4em;
}

.toggle {
	padding-inline-start: 0em;
	list-style-type: none;
}

/* Indent toggle children */
.toggle > li > details {
	padding-left: 1.7em;
}

.toggle > li > details > summary {
	margin-left: -1.1em;
}

.selected-value {
	display: inline-block;
	padding: 0 0.5em;
	background: rgba(206, 205, 202, 0.5);
	border-radius: 3px;
	margin-right: 0.5em;
	margin-top: 0.3em;
	margin-bottom: 0.3em;
	white-space: nowrap;
}

.collection-title {
	display: inline-block;
	margin-right: 1em;
}

.page-description {
	margin-bottom: 2em;
}

.simple-table {
	margin-top: 1em;
	font-size: 0.875rem;
	empty-cells: show;
}
.simple-table td {
	height: 29px;
	min-width: 120px;
}

.simple-table th {
	height: 29px;
	min-width: 120px;
}

.simple-table-header-color {
	background: rgb(247, 246, 243);
	color: black;
}
.simple-table-header {
	font-weight: 500;
}

time {
	opacity: 0.5;
}

.icon {
	display: inline-block;
	max-width: 1.2em;
	max-height: 1.2em;
	text-decoration: none;
	vertical-align: text-bottom;
	margin-right: 0.5em;
}

img.icon {
	border-radius: 3px;
}

.user-icon {
	width: 1.5em;
	height: 1.5em;
	border-radius: 100%;
	margin-right: 0.5rem;
}

.user-icon-inner {
	font-size: 0.8em;
}

.text-icon {
	border: 1px solid #000;
	text-align: center;
}

.page-cover-image {
	display: block;
	object-fit: cover;
	width: 100%;
	max-height: 30vh;
}

.page-header-icon {
	font-size: 3rem;
	margin-bottom: 1rem;
}

.page-header-icon-with-cover {
	margin-top: -0.72em;
	margin-left: 0.07em;
}

.page-header-icon img {
	border-radius: 3px;
}

.link-to-page {
	margin: 1em 0;
	padding: 0;
	border: none;
	font-weight: 500;
}

p > .user {
	opacity: 0.5;
}

td > .user,
td > time {
	white-space: nowrap;
}

input[type="checkbox"] {
	transform: scale(1.5);
	margin-right: 0.6em;
	vertical-align: middle;
}

p {
	margin-top: 0.5em;
	margin-bottom: 0.5em;
}

.image {
	border: none;
	margin: 1.5em 0;
	padding: 0;
	border-radius: 0;
	text-align: center;
}

.code,
code {
	background: rgba(135, 131, 120, 0.15);
	border-radius: 3px;
	padding: 0.2em 0.4em;
	border-radius: 3px;
	font-size: 85%;
	tab-size: 2;
}

code {
	color: #eb5757;
}

.code {
	padding: 1.5em 1em;
}

.code-wrap {
	white-space: pre-wrap;
	word-break: break-all;
}

.code > code {
	background: none;
	padding: 0;
	font-size: 100%;
	color: inherit;
}

blockquote {
	font-size: 1.25em;
	margin: 1em 0;
	padding-left: 1em;
	border-left: 3px solid rgb(55, 53, 47);
}

.bookmark {
	text-decoration: none;
	max-height: 8em;
	padding: 0;
	display: flex;
	width: 100%;
	align-items: stretch;
}

.bookmark-title {
	font-size: 0.85em;
	overflow: hidden;
	text-overflow: ellipsis;
	height: 1.75em;
	white-space: nowrap;
}

.bookmark-text {
	display: flex;
	flex-direction: column;
}

.bookmark-info {
	flex: 4 1 180px;
	padding: 12px 14px 14px;
	display: flex;
	flex-direction: column;
	justify-content: space-between;
}

.bookmark-image {
	width: 33%;
	flex: 1 1 180px;
	display: block;
	position: relative;
	object-fit: cover;
	border-radius: 1px;
}

.bookmark-description {
	color: rgba(55, 53, 47, 0.6);
	font-size: 0.75em;
	overflow: hidden;
	max-height: 4.5em;
	word-break: break-word;
}

.bookmark-href {
	font-size: 0.75em;
	margin-top: 0.25em;
}

.sans { font-family: ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI Variable Display", "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol"; }
.code { font-family: "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace; }
.serif { font-family: Lyon-Text, Georgia, ui-serif, serif; }
.mono { font-family: iawriter-mono, Nitti, Menlo, Courier, monospace; }
.pdf .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI Variable Display", "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK JP'; }
.pdf:lang(zh-CN) .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI Variable Display", "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK SC'; }
.pdf:lang(zh-TW) .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI Variable Display", "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK TC'; }
.pdf:lang(ko-KR) .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI Variable Display", "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK KR'; }
.pdf .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK JP'; }
.pdf:lang(zh-CN) .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK SC'; }
.pdf:lang(zh-TW) .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK TC'; }
.pdf:lang(ko-KR) .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK KR'; }
.pdf .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK JP'; }
.pdf:lang(zh-CN) .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK SC'; }
.pdf:lang(zh-TW) .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK TC'; }
.pdf:lang(ko-KR) .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK KR'; }
.pdf .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK JP'; }
.pdf:lang(zh-CN) .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK SC'; }
.pdf:lang(zh-TW) .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK TC'; }
.pdf:lang(ko-KR) .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK KR'; }
.highlight-default {
	color: rgba(50, 48, 44, 1);
}
.highlight-gray {
	color: rgba(115, 114, 110, 1);
	fill: rgba(115, 114, 110, 1);
}
.highlight-brown {
	color: rgba(159, 107, 83, 1);
	fill: rgba(159, 107, 83, 1);
}
.highlight-orange {
	color: rgba(217, 115, 13, 1);
	fill: rgba(217, 115, 13, 1);
}
.highlight-yellow {
	color: rgba(203, 145, 47, 1);
	fill: rgba(203, 145, 47, 1);
}
.highlight-teal {
	color: rgba(68, 131, 97, 1);
	fill: rgba(68, 131, 97, 1);
}
.highlight-blue {
	color: rgba(51, 126, 169, 1);
	fill: rgba(51, 126, 169, 1);
}
.highlight-purple {
	color: rgba(144, 101, 176, 1);
	fill: rgba(144, 101, 176, 1);
}
.highlight-pink {
	color: rgba(193, 76, 138, 1);
	fill: rgba(193, 76, 138, 1);
}
.highlight-red {
	color: rgba(205, 60, 58, 1);
	fill: rgba(205, 60, 58, 1);
}
.highlight-default_background {
	color: rgba(50, 48, 44, 1);
}
.highlight-gray_background {
	background: rgba(248, 248, 247, 1);
}
.highlight-brown_background {
	background: rgba(244, 238, 238, 1);
}
.highlight-orange_background {
	background: rgba(251, 236, 221, 1);
}
.highlight-yellow_background {
	background: rgba(251, 243, 219, 1);
}
.highlight-teal_background {
	background: rgba(237, 243, 236, 1);
}
.highlight-blue_background {
	background: rgba(231, 243, 248, 1);
}
.highlight-purple_background {
	background: rgba(248, 243, 252, 1);
}
.highlight-pink_background {
	background: rgba(252, 241, 246, 1);
}
.highlight-red_background {
	background: rgba(253, 235, 236, 1);
}
.block-color-default {
	color: inherit;
	fill: inherit;
}
.block-color-gray {
	color: rgba(115, 114, 110, 1);
	fill: rgba(115, 114, 110, 1);
}
.block-color-brown {
	color: rgba(159, 107, 83, 1);
	fill: rgba(159, 107, 83, 1);
}
.block-color-orange {
	color: rgba(217, 115, 13, 1);
	fill: rgba(217, 115, 13, 1);
}
.block-color-yellow {
	color: rgba(203, 145, 47, 1);
	fill: rgba(203, 145, 47, 1);
}
.block-color-teal {
	color: rgba(68, 131, 97, 1);
	fill: rgba(68, 131, 97, 1);
}
.block-color-blue {
	color: rgba(51, 126, 169, 1);
	fill: rgba(51, 126, 169, 1);
}
.block-color-purple {
	color: rgba(144, 101, 176, 1);
	fill: rgba(144, 101, 176, 1);
}
.block-color-pink {
	color: rgba(193, 76, 138, 1);
	fill: rgba(193, 76, 138, 1);
}
.block-color-red {
	color: rgba(205, 60, 58, 1);
	fill: rgba(205, 60, 58, 1);
}
.block-color-default_background {
	color: inherit;
	fill: inherit;
}
.block-color-gray_background {
	background: rgba(248, 248, 247, 1);
}
.block-color-brown_background {
	background: rgba(244, 238, 238, 1);
}
.block-color-orange_background {
	background: rgba(251, 236, 221, 1);
}
.block-color-yellow_background {
	background: rgba(251, 243, 219, 1);
}
.block-color-teal_background {
	background: rgba(237, 243, 236, 1);
}
.block-color-blue_background {
	background: rgba(231, 243, 248, 1);
}
.block-color-purple_background {
	background: rgba(248, 243, 252, 1);
}
.block-color-pink_background {
	background: rgba(252, 241, 246, 1);
}
.block-color-red_background {
	background: rgba(253, 235, 236, 1);
}
.select-value-color-default { background-color: rgba(84, 72, 49, 0.08); }
.select-value-color-gray { background-color: rgba(84, 72, 49, 0.15); }
.select-value-color-brown { background-color: rgba(210, 162, 141, 0.35); }
.select-value-color-orange { background-color: rgba(224, 124, 57, 0.27); }
.select-value-color-yellow { background-color: rgba(236, 191, 66, 0.39); }
.select-value-color-green { background-color: rgba(123, 183, 129, 0.27); }
.select-value-color-blue { background-color: rgba(93, 165, 206, 0.27); }
.select-value-color-purple { background-color: rgba(168, 129, 197, 0.27); }
.select-value-color-pink { background-color: rgba(225, 136, 179, 0.27); }
.select-value-color-red { background-color: rgba(244, 171, 159, 0.4); }

.checkbox {
	display: inline-flex;
	vertical-align: text-bottom;
	width: 16;
	height: 16;
	background-size: 16px;
	margin-left: 2px;
	margin-right: 5px;
}

.checkbox-on {
	background-image: url("data:image/svg+xml;charset=UTF-8,%3Csvg%20width%3D%2216%22%20height%3D%2216%22%20viewBox%3D%220%200%2016%2016%22%20fill%3D%22none%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%0A%3Crect%20width%3D%2216%22%20height%3D%2216%22%20fill%3D%22%2358A9D7%22%2F%3E%0A%3Cpath%20d%3D%22M6.71429%2012.2852L14%204.9995L12.7143%203.71436L6.71429%209.71378L3.28571%206.2831L2%207.57092L6.71429%2012.2852Z%22%20fill%3D%22white%22%2F%3E%0A%3C%2Fsvg%3E");
}

.checkbox-off {
	background-image: url("data:image/svg+xml;charset=UTF-8,%3Csvg%20width%3D%2216%22%20height%3D%2216%22%20viewBox%3D%220%200%2016%2016%22%20fill%3D%22none%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%0A%3Crect%20x%3D%220.75%22%20y%3D%220.75%22%20width%3D%2214.5%22%20height%3D%2214.5%22%20fill%3D%22white%22%20stroke%3D%22%2336352F%22%20stroke-width%3D%221.5%22%2F%3E%0A%3C%2Fsvg%3E");
}
	
</style></head><body><article id="2355b2cc-075b-8081-b6f0-d5f17d6aa141" class="page sans"><header><div class="page-header-icon undefined"><img class="icon" src="https://tryhackme-images.s3.amazonaws.com/room-icons/82e133a20e4c9d556cf0eebcaf5ca500.png"/></div><h1 class="page-title">Splunk Incident Handling</h1><p class="page-description"></p></header><div class="page-body"><h2 id="2355b2cc-075b-804b-b735-f5871328dae4" class="">Introduction: Incident Handling</h2><p id="2355b2cc-075b-802b-9a8d-ecd80202b233" class="">
</p><p id="2355b2cc-075b-80f8-8db9-c51426003af7" class="">An incident from a security perspective is &quot;Any event or action, that has a negative consequence on the security of a user/computer or an organization is considered a security incident.&quot; Below are a few of the events that would negatively affect the environment when they occurred:</p><ul id="2355b2cc-075b-80fe-a7b6-c3aca26d4fcc" class="bulleted-list"><li style="list-style-type:disc">Crashing the system</li></ul><ul id="2355b2cc-075b-808a-a061-e88a9e63b8ce" class="bulleted-list"><li style="list-style-type:disc">Execution of an unwanted program</li></ul><ul id="2355b2cc-075b-8082-9b3e-d78f47bd37da" class="bulleted-list"><li style="list-style-type:disc">Access to sensitive information from an unauthorized user</li></ul><ul id="2355b2cc-075b-80c8-a175-f390f77862d7" class="bulleted-list"><li style="list-style-type:disc">A Website being defaced by the attacker</li></ul><ul id="2355b2cc-075b-8020-88a4-d0b086fb33c3" class="bulleted-list"><li style="list-style-type:disc">The use of USB devices when there is a restriction in usage is against the company&#x27;s policy</li></ul><p id="2355b2cc-075b-807a-ac61-ff4a8208db4e" class="">
</p><h2 id="2355b2cc-075b-8057-8657-d686a0c97d65" class=""><strong>Incident Handling Life Cycle</strong></h2><figure id="2355b2cc-075b-80e5-b11a-d78c802ba23a" class="image"><a href="assets/image%20260.png"><img style="width:528px" src="assets/image%20260.png"/></a></figure><p id="2355b2cc-075b-8093-9f9f-fd9630f926dc" class="">
</p><h2 id="2355b2cc-075b-807f-b318-d9c54325299c" class="">Incident Handling: Scenario</h2><h3 id="2355b2cc-075b-804d-811d-e053f78d4214" class=""><strong>Cyber Kill Chain</strong></h3><p id="2355b2cc-075b-80c7-a695-e22bdf3867e7" class="">We will follow the Cyber kill Chain Model and map the attacker&#x27;s activity in each phase during this Investigation. When required, we will also utilize Open Source Intelligence (OSINT) and other findings to fill the gaps in the kill chain. It is not necessary to follow this sequence of the phases while investigating.</p><ul id="2355b2cc-075b-8094-b829-ed54b9d868f0" class="bulleted-list"><li style="list-style-type:disc">Reconnaissance</li></ul><ul id="2355b2cc-075b-807e-a3ba-c3a76c8545eb" class="bulleted-list"><li style="list-style-type:disc">Weaponization</li></ul><ul id="2355b2cc-075b-80f7-b880-ec7b688e0198" class="bulleted-list"><li style="list-style-type:disc">Delivery</li></ul><ul id="2355b2cc-075b-8014-b68b-da25ac8c47c9" class="bulleted-list"><li style="list-style-type:disc">Exploitation</li></ul><ul id="2355b2cc-075b-804b-a279-e27e94dc5eab" class="bulleted-list"><li style="list-style-type:disc">Installation</li></ul><ul id="2355b2cc-075b-80ac-8126-d4d9da73d9ca" class="bulleted-list"><li style="list-style-type:disc">Command &amp; Control</li></ul><ul id="2355b2cc-075b-802a-a1d2-dbb28282175c" class="bulleted-list"><li style="list-style-type:disc">Actions on Objectives</li></ul><p id="2355b2cc-075b-800d-923a-e1fa685a1eb6" class=""><strong>Splunk</strong></p><p id="2355b2cc-075b-803b-ae02-d42f10dbd6ad" class="">During our investigation, we will be using <code>Splunk </code>as our SIEM solution. Logs are being ingested from webserver/firewall/Suricata/Sysmon etc. In the data summary tab, we can explore the log sources showing visibility into both network-centric and host-centric activities</p><p id="2355b2cc-075b-806b-bde0-f9a605e8830c" class=""><strong>Interesting log Sources</strong></p><p id="2355b2cc-075b-80cc-a297-c58419204dc4" class="">Some of the interesting log sources that will help us in our Investigation are:</p><table id="2355b2cc-075b-804f-bc8e-d788866e8025" class="simple-table"><tbody><tr id="2355b2cc-075b-8099-a0d0-c9b6899fcc58"><td id="ma@I" class=""><strong>Log Sources</strong></td><td id="zTa]" class="" style="width:561.0000152587891px"><strong>Details</strong></td></tr><tr id="2355b2cc-075b-809b-82c2-f0330ead4775"><td id="ma@I" class=""><strong>wineventlog</strong></td><td id="zTa]" class="" style="width:561.0000152587891px">It contains Windows Event logs</td></tr><tr id="2355b2cc-075b-8023-82b7-d825f5b9a890"><td id="ma@I" class=""><strong>winRegistry</strong></td><td id="zTa]" class="" style="width:561.0000152587891px">It contains the logs related to registry creation / modification / deletion etc.</td></tr><tr id="2355b2cc-075b-8079-9f61-df6493eea27e"><td id="ma@I" class=""><strong>XmlWinEventLog</strong></td><td id="zTa]" class="" style="width:561.0000152587891px">It contains the sysmon event logs. It is a very important log source from an investigation point of view.</td></tr><tr id="2355b2cc-075b-8041-b379-d99a03cb8ade"><td id="ma@I" class=""><strong>fortigate_utm</strong></td><td id="zTa]" class="" style="width:561.0000152587891px">It contains Fortinet Firewall logs</td></tr><tr id="2355b2cc-075b-80df-ac87-f30453549e31"><td id="ma@I" class=""><strong>iis</strong></td><td id="zTa]" class="" style="width:561.0000152587891px">It contains IIS web server logs</td></tr><tr id="2355b2cc-075b-800a-811d-f28e91f4c627"><td id="ma@I" class=""><strong>Nessus:scan</strong></td><td id="zTa]" class="" style="width:561.0000152587891px">It contains the results from the Nessus vulnerability scanner.</td></tr><tr id="2355b2cc-075b-80c0-806e-e4d3cd77be24"><td id="ma@I" class=""><strong>Suricata</strong></td><td id="zTa]" class="" style="width:561.0000152587891px">It contains the details of the alerts from the Suricata IDS. This log source shows which alert was triggered and what caused the alert to get triggered— a very important log source for the Investigation.</td></tr><tr id="2355b2cc-075b-801d-80e9-cc49bdc98d4a"><td id="ma@I" class=""><strong>stream:http</strong></td><td id="zTa]" class="" style="width:561.0000152587891px">It contains the network flow related to http traffic.</td></tr><tr id="2355b2cc-075b-80f3-ae3f-c95aa0ee59a1"><td id="ma@I" class=""><strong>stream: DNS</strong></td><td id="zTa]" class="" style="width:561.0000152587891px">It contains the network flow related to DNS traffic.</td></tr><tr id="2355b2cc-075b-807a-8de5-fe98f0a87369"><td id="ma@I" class=""><strong>stream:icmp</strong></td><td id="zTa]" class="" style="width:561.0000152587891px">It contains the network flow related to icmp traffic.</td></tr></tbody></table><h2 id="2355b2cc-075b-80d7-a525-c1aeffbfe216" class=""><strong>Reconnaissance Phase</strong></h2><p id="2355b2cc-075b-8066-9415-fe87932c5c59" class="">We will start our analysis by examining any reconnaissance attempt against the webserver <code>imreallynotbatman.com</code>. From an analyst perspective, where do we first need to look? If we look at the available log sources, we will find some log sources covering the network traffic, which means all the inbound communication towards our web server will be logged into the log source that contains the web traffic. Let&#x27;s start by searching for the domain in the search head and see which log source includes the traces of our domain.</p><p id="2355b2cc-075b-8057-a83e-cd8644611cde" class=""><strong>Search Query</strong>: <code>index=botsv1 imreallynotbatman.com</code></p><p id="2355b2cc-075b-803a-81aa-c93db251f22b" class=""><strong>Search Query explanation:</strong> We are going to look for the event logs in the index &quot;botsv1&quot; which contains the term <code>imreallynotbatman.com</code></p><figure id="2355b2cc-075b-8012-9bd1-cd5c70bdb60c" class="image"><a href="assets/77036857-4849-4FA1-80F8-83B0DD4A1CC1.png"><img style="width:685.9734497070312px" src="assets/77036857-4849-4FA1-80F8-83B0DD4A1CC1.png"/></a></figure><p id="2355b2cc-075b-80a1-8e21-d70161af3ed2" class="">78683 events returned, and 4 hosts observed</p><figure id="2355b2cc-075b-8035-87dd-f9b3dfe80f1b" class="image"><a href="assets/3AED90BD-3EA4-4EBE-95A4-9D0B69A8831B.png"><img style="width:670.9734497070312px" src="assets/3AED90BD-3EA4-4EBE-95A4-9D0B69A8831B.png"/></a></figure><p id="2355b2cc-075b-80a1-9c9c-cbb6f0150644" class="">First task is to identify the attackers IP that was doing the recon, obvious will be to check for incoming http traffic to the webserver.</p><p id="2355b2cc-075b-8019-8847-fb13e0cf6bbc" class="">For this I look at <code>stream:http</code></p><p id="2355b2cc-075b-80b2-9513-f35fa86865cb" class=""><strong>Search Query: </strong><code>index=botsv1 imreallynotbatman.com sourcetype=stream:http</code></p><p id="2355b2cc-075b-8013-83f3-efde10198a0f" class=""><strong>Search Query Explanation: </strong>This query will only look for the term  <code>imreallynotbatman.com</code>in the <strong>stream:http</strong> log source.</p><p id="2355b2cc-075b-80d4-a6ee-ff4856c51bc7" class="">once i applied the above filter, I was about to narrow down to 2 IPs, one with a significant percentage of traffic.</p><figure id="2355b2cc-075b-8038-9cb2-da839bc7378b" class="image"><a href="assets/image%20261.png"><img style="width:685.9734497070312px" src="assets/image%20261.png"/></a></figure><ul id="2355b2cc-075b-80bd-bf4b-d1980dee9513" class="bulleted-list"><li style="list-style-type:disc">If you don&#x27;t find the field of interest immediately, <strong>keep scrolling in the left panel</strong>.</li></ul><ul id="2355b2cc-075b-80c9-8153-d9acb9d548a8" class="bulleted-list"><li style="list-style-type:disc">When you click on a field, it will display <strong>all the values found in the logs</strong> for that field.</li></ul><ul id="2355b2cc-075b-803b-8134-d4a4ffedc072" class="bulleted-list"><li style="list-style-type:disc">In the <code>src_ip</code> field, <strong>two IPs were identified</strong>:</li></ul><ul id="2355b2cc-075b-8061-b659-c2e9cf2381d0" class="bulleted-list"><li style="list-style-type:disc">The IP <code>40.80.148.42</code> appears in a <strong>higher percentage of logs</strong> compared to the other IP.</li></ul><p id="2355b2cc-075b-80ac-b431-d3b2185ffbc8" class="">IP 40.80.148.42 is suspicious, i will look into it. To further confirm our suspicion about the IP address <strong>40.80.148.42</strong>, click on the IP and examine the logs. We can look at the interesting fields like User-Agent, Post request, URIs, etc., to see what kind of traffic is coming from this particular IP.</p><p id="2355b2cc-075b-80a9-a830-e38f2e4d050d" class="">The URI path signals a scanning activity</p><figure id="2355b2cc-075b-8074-81af-d7f9eb28ff42" class="image"><a href="assets/ED12F326-7B29-4F19-B56F-CEDD826ADB3B.png"><img style="width:673.9837646484375px" src="assets/ED12F326-7B29-4F19-B56F-CEDD826ADB3B.png"/></a></figure><p id="2355b2cc-075b-80cf-b0d3-c403b04ae99e" class="">This might be a scanner names acunetix</p><figure id="2355b2cc-075b-8061-bc56-c2f0d2952307" class="image"><a href="assets/7B912BF2-BDFA-4309-B887-2B11BA2F4BD9.png"><img style="width:599.96142578125px" src="assets/7B912BF2-BDFA-4309-B887-2B11BA2F4BD9.png"/></a></figure><p id="2355b2cc-075b-801f-a4f8-e43f006a3f6b" class="">
</p><h3 id="2355b2cc-075b-80d4-abd2-fe330767a516" class=""><strong>Validate the IP that is scanning</strong></h3><p id="2355b2cc-075b-80ce-b981-cda6645e61d6" class="">So what do we need to do to validate the scanning attempt? Simple, dig further into the weblogs. Let us narrow down the result, look into the <code>suricata</code> logs, and see if any rule is triggered on this communication.</p><p id="2355b2cc-075b-80f4-9f7a-e9fcce8ebe3c" class=""><strong>Search Query:</strong> <code>index=botsv1 imreallynotbatman.com src=40.80.148.42 sourcetype=suricata</code></p><p id="2355b2cc-075b-8014-bf2c-f59a93f5953f" class=""><strong>Search Query Explanation: </strong>This query will show the logs from the suricata log source that are detected/generated from the source IP <strong>40.80.248.42</strong></p><p id="2355b2cc-075b-8092-9a22-d76e7cc3522f" class="">
</p><h3 id="2355b2cc-075b-80c0-9def-db8ca15edc97" class="">Questions</h3><ul id="2355b2cc-075b-8089-b0bc-c4351955522a" class="bulleted-list"><li style="list-style-type:disc">One suricata alert highlighted the CVE value associated with the attack attempt. What is the CVE value?</li></ul><figure id="2355b2cc-075b-80fa-8948-d38c01266583" class="image"><a href="assets/15D52C0D-E236-47BC-A9C1-01C426B39FD7.png"><img style="width:685.986328125px" src="assets/15D52C0D-E236-47BC-A9C1-01C426B39FD7.png"/></a></figure><ul id="2355b2cc-075b-801b-bdfc-fd9b7d89eaab" class="bulleted-list"><li style="list-style-type:disc">What is the CMS our web server is using?</li></ul><p id="2355b2cc-075b-8000-a7ee-cb664f94e397" class="">Joomla - this is pretty obvious</p><ul id="2355b2cc-075b-8049-b143-efa334f19049" class="bulleted-list"><li style="list-style-type:disc">What is the web scanner, the attacker used to perform the scanning attempts?</li></ul><p id="2355b2cc-075b-80df-acee-d98612aab135" class="">Acunetix  - this can be seen from the http headers.</p><ul id="2355b2cc-075b-8011-8be3-cbf5350e1f55" class="bulleted-list"><li style="list-style-type:disc">What is the IP address of the server imreallynotbatman.com?<br/>this can be seen from the destination IP.</li></ul><figure id="2355b2cc-075b-80a8-8187-cfbc4ed9e8af" class="image"><a href="assets/03C7A2BA-9A11-47FE-B40C-2B5166D3D0C2.png"><img style="width:685.9605712890625px" src="assets/03C7A2BA-9A11-47FE-B40C-2B5166D3D0C2.png"/></a></figure><p id="2355b2cc-075b-8097-9621-e3dc94469d04" class="">
</p><h2 id="2355b2cc-075b-80a9-b866-c7350ccf06ce" class="">Exploitation Phase</h2><p id="2355b2cc-075b-8053-9bcb-e4d1f6b0b60f" class="">The information we have so far:</p><ul id="2355b2cc-075b-801b-90cf-e1b6e6820af6" class="bulleted-list"><li style="list-style-type:disc">We found two IP addresses from the reconnaissance phase with sending requests to our server.</li></ul><ul id="2355b2cc-075b-807e-ba15-c42163eba234" class="bulleted-list"><li style="list-style-type:disc">One of the IPs <code>40.80.148.42</code> was seen attempting to scan the server with IP <strong>192.168.250.70</strong>.</li></ul><ul id="2355b2cc-075b-805f-9c2e-fc8d65f00e98" class="bulleted-list"><li style="list-style-type:disc">The attacker was using the web scanner Acunetix for the scanning attempt.</li></ul><p id="2355b2cc-075b-80f9-ab86-d4c0afaf72f5" class=""><strong>Count</strong></p><p id="2355b2cc-075b-80e4-8aef-ee8428e33a8b" class="">Let&#x27;s use the following search query to see the number of counts by each source IP against the webserver.</p><p id="2355b2cc-075b-808a-adfd-c4339f5c1329" class=""><strong>Search Query</strong>:<code>index=botsv1 imreallynotbatman.com sourcetype=stream* | stats count(src_ip) as Requests by src_ip | sort - Requests</code></p><p id="2355b2cc-075b-802a-9848-f1e68d5a4295" class=""><strong>Query Explanation: </strong>This query uses the stats function to display the count of the IP addresses in the field src_ip.</p><figure id="2355b2cc-075b-80ba-a1b8-d8dbff583103" class="image"><a href="assets/image%20262.png"><img style="width:685.9734497070312px" src="assets/image%20262.png"/></a></figure><p id="2355b2cc-075b-80d8-8e0a-d2b233dd3b0d" class="">Now we will narrow down the result to show requests sent to our web server, which has the IP <code>192.168.250.70</code></p><p id="2355b2cc-075b-800d-83af-fca4d7702635" class=""><strong>Search Query:</strong> <code>index=botsv1 sourcetype=stream:http dest_ip=&quot;192.168.250.70&quot;</code></p><p id="2355b2cc-075b-80b1-94b1-cda452710e2a" class=""><strong>Query Explanation: </strong>This query will look for all the inbound traffic towards IP <strong>192.168.250.70.</strong></p><figure id="2355b2cc-075b-8017-b51f-c14272b50cac" class="image"><a href="assets/image%20263.png"><img style="width:685.986328125px" src="assets/image%20263.png"/></a></figure><p id="2355b2cc-075b-800e-ab2f-f792d6009819" class="">The result shows 3 IPs sending requests to the webserver, one of them is a private IP.</p><p id="2355b2cc-075b-806c-b4b0-fff85e048e17" class="">I also checked the HTTP Methods, and noticed that 70% of the requests are POST </p><figure id="2355b2cc-075b-8008-8512-c5dc5ed87162" class="image"><a href="assets/image%20264.png"><img style="width:685.9734497070312px" src="assets/image%20264.png"/></a></figure><p id="2355b2cc-075b-8017-8109-e3066a365407" class="">To see what kind of traffic is coming through the POST requests, we will narrow down on the field http_method=POST as shown below:</p><p id="2355b2cc-075b-80d9-bffb-f2682af26c59" class=""><strong>Search Query:</strong> <code>index=botsv1 sourcetype=stream:http dest_ip=&quot;192.168.250.70&quot; http_method=POST</code></p><p id="2355b2cc-075b-80fb-84c7-d5f8665f3f81" class="">The term Joomla is associated with the webserver found in a couple of fields like<strong> uri, uri_path, http_referrer</strong>, etc. This means our webserver is using Joomla CMS (Content Management Service) in the backend.</p><p id="2355b2cc-075b-804c-bad5-e1b1206c3c32" class="">A little search on the internet for the admin login page of the Joomla CMS will show as -&gt; <code>/joomla/administrator/index.php</code></p><p id="2355b2cc-075b-8082-b846-d0262ebdf133" class="">It is important because this uri contains the login page to access the web portal therefore we will be examining the traffic coming into this admin panel for a potential brute-force attack.</p><figure id="2355b2cc-075b-8063-bc00-f834c666d58f" class="image"><a href="https://tryhackme-images.s3.amazonaws.com/user-uploads/5e8dd9a4a45e18443162feab/room-content/ea62d4ec767a649904b5f5bba9ba1d62.png"><img src="https://tryhackme-images.s3.amazonaws.com/user-uploads/5e8dd9a4a45e18443162feab/room-content/ea62d4ec767a649904b5f5bba9ba1d62.png"/></a></figure><p id="2355b2cc-075b-8065-9ece-c356ee2bfc9a" class="">Reference: <a href="https://www.joomla.org/administrator/index.php">https://www.joomla.org/administrator/index.php</a></p><p id="2355b2cc-075b-8070-83b5-ee5f360c77ea" class="">We can narrow down our search to see the requests sent to the login portal using this information.</p><p id="2355b2cc-075b-8030-acec-eb33a4997727" class=""><strong>Search query: </strong><code>index=botsv1 imreallynotbatman.com sourcetype=stream:http dest_ip=&quot;192.168.250.70&quot;  uri=&quot;/joomla/administrator/index.php&quot;</code></p><p id="2355b2cc-075b-8086-b8d7-ddf31aa1a830" class=""><strong>Query Explanation:</strong> We are going to add <code>uri=&quot;/joomla/administrator/index.php&quot;</code> in the search query to show the traffic coming into this URI.</p><p id="2355b2cc-075b-8080-ab1b-fd4e2b44afe2" class=""><code>form_data</code> The field contains the requests sent through the form on the admin panel page, which has a login page. We suspect the attacker may have tried multiple credentials in an attempt to gain access to the admin panel. To confirm, we will dig deep into the values contained within the form_data field, as shown below:</p><p id="2355b2cc-075b-8008-971c-d8390dbcbc23" class=""><strong>Search Query: </strong><code>index=botsv1 sourcetype=stream:http dest_ip=&quot;192.168.250.70&quot; http_method=POST uri=&quot;/joomla/administrator/index.php&quot; | table _time uri src_ip dest_ip form_data</code></p><p id="2355b2cc-075b-8045-ac90-fa2bd7e08ce3" class=""><strong>Query Explanation:</strong> We will add this -&gt; <code>| table _time uri src_ip dest_ip form_data</code> to create a table containing important fields as shown below:</p><figure id="2355b2cc-075b-8086-9b65-f7547d0ff1fb" class="image"><a href="assets/image%20265.png"><img style="width:685.9734497070312px" src="assets/image%20265.png"/></a></figure><p id="2355b2cc-075b-8046-b427-fe575daeffe1" class="">If we keep looking at the results, we will find two interesting fields <code>username</code> that includes the single username <code>admin</code> in all the events and another field <code>passwd</code> that contains multiple passwords in it, which shows the attacker from the IP <code>23.22.63.114</code> Was trying to guess the password by brute-forcing and attempting numerous passwords.</p><p id="2355b2cc-075b-8028-99b3-d8427d4d9456" class="">The time elapsed between multiple events also suggests that the attacker was using an automated tool as various attempts were observed in a short time</p><p id="2355b2cc-075b-8072-9f01-e0f8429dbf5a" class="">
</p><h2 id="2355b2cc-075b-8042-b335-e37eb7119688" class=""><strong>Extracting Username and Passwd Fields using Regex</strong></h2><p id="2355b2cc-075b-80bb-bae0-cc8bf2d032aa" class="">Looking into the logs, we see that these fields are not parsed properly. Let us use <strong>Regex</strong> in the search to extract only these two fields and their values from the logs and display them.</p><p id="2355b2cc-075b-80b5-868c-cca1df478545" class="">We can display only the logs that contain the <strong>username</strong> and <strong>passwd</strong> values in the form_data field by adding <code>form_data=*username*passwd*</code> in the above search.</p><p id="2355b2cc-075b-808f-9e56-e643d7809a0e" class=""><strong>Search Query:</strong></p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="2355b2cc-075b-80fe-9485-d593811ad72a" class="code code-wrap"><code class="language-Plain Text" style="white-space:pre-wrap;word-break:break-all">index=botsv1 sourcetype=stream:http dest_ip=&quot;192.168.250.70&quot; http_method=POST uri=&quot;/joomla/administrator/index.php&quot; form_data=*username*passwd* | table _time uri src_ip dest_ip form_data</code></pre><figure id="2355b2cc-075b-807d-a81a-eb775b1ac9a6" class="image"><a href="https://tryhackme-images.s3.amazonaws.com/user-uploads/5e8dd9a4a45e18443162feab/room-content/9c47791d96dbadf8ab0d6a0adf1a9508.png"><img src="https://tryhackme-images.s3.amazonaws.com/user-uploads/5e8dd9a4a45e18443162feab/room-content/9c47791d96dbadf8ab0d6a0adf1a9508.png"/></a></figure><p id="2355b2cc-075b-80b9-a610-eb71d81a2542" class="">It&#x27;s time to use Regex <strong>(regular expressions)</strong> to extract all the password values found against the field passwd in the logs. To do so, Splunk has a function called rex. If we type it in the search head, it will show detail and an example of how to use it to extract the values.</p><figure id="2355b2cc-075b-8004-82cc-d4a69c6d2a04" class="image"><a href="https://tryhackme-images.s3.amazonaws.com/user-uploads/5e8dd9a4a45e18443162feab/room-content/5ff9ecd4bf13a65356c0f6b9431d90c5.png"><img src="https://tryhackme-images.s3.amazonaws.com/user-uploads/5e8dd9a4a45e18443162feab/room-content/5ff9ecd4bf13a65356c0f6b9431d90c5.png"/></a></figure><p id="2355b2cc-075b-80cc-943f-cf6911fe9db9" class="">Using this regex, i was able to list out all the passwords that was tried along with the admin username, then from there i can see that there is 412 attempts of passwords from a python script, then 1 from a browser, this might mean that the brute force worked and the attacker got the right password and used that to login using a browser.</p><p id="2355b2cc-075b-8084-995c-f734b4c725a3" class="">Let&#x27;s create a table to display key fields and values by appending -&gt; <code>| table _time src_ip uri http_user_agent creds</code> in the search query as shown below.</p><p id="2355b2cc-075b-80df-a602-ec31d24d0f3d" class=""><strong>Search Query: </strong><code>index=botsv1 sourcetype=stream:http dest_ip=&quot;192.168.250.70&quot; http_method=POST form_data=*username*passwd* | rex field=form_data &quot;passwd=(?&lt;creds&gt;\w+)&quot; |table _time src_ip uri http_user_agent creds</code></p><figure id="2355b2cc-075b-80fb-acdc-e0c16c813785" class="image"><a href="https://tryhackme-images.s3.amazonaws.com/user-uploads/5e8dd9a4a45e18443162feab/room-content/ef2cbed333760fbe7d2fa7c507d2c625.png"><img src="https://tryhackme-images.s3.amazonaws.com/user-uploads/5e8dd9a4a45e18443162feab/room-content/ef2cbed333760fbe7d2fa7c507d2c625.png"/></a></figure><p id="2355b2cc-075b-8042-87d4-e4a5d82558cb" class="">This result clearly shows a continuous brute-force attack attempt from an IP <strong>23.22.63.114</strong> and 1 password attempt <strong>batman</strong> from IP <strong>40.80.148.42</strong> using the Mozilla browser.</p><p id="2355b2cc-075b-803e-887b-e0e1e7ab429f" class="">The information so far,</p><figure id="2355b2cc-075b-80a3-90b3-e66878cf8fe9" class="image"><a href="assets/C4B152F6-FA84-4026-8847-377CEE524D6C.png"><img style="width:685.986328125px" src="assets/C4B152F6-FA84-4026-8847-377CEE524D6C.png"/></a></figure><p id="2355b2cc-075b-8003-ba68-ec6ebf5cc308" class="">
</p><h2 id="2355b2cc-075b-8092-8ba1-d90b3204287a" class=""><strong>Installation Phase</strong></h2><p id="2355b2cc-075b-8067-9c2b-fc2d20242c43" class="">Once the attacker has successfully exploited the security of a system, he will try to install a backdoor or an application for persistence or to gain more control of the system. This activity comes under the installation phase.</p><p id="2355b2cc-075b-809d-bea0-d761d61ed52e" class="">In the previous Exploitation phase, we found evidence of the webserver <code>iamreallynotbatman.com</code> getting compromised via brute-force attack by the attacker using the python script to automate getting the correct password. The attacker used the IP&quot; for the attack and the IP to log in to the server. This phase will investigate any payload / malicious program uploaded to the server from any attacker&#x27;s IPs and installed into the compromised server.</p><p id="2355b2cc-075b-8091-9bca-e96a68924495" class="">To begin an investigation, we first would narrow down any http traffic coming into our server <strong>192.168.250.70</strong> containing the term &quot;.exe.&quot; This query may not lead to the findings, but it&#x27;s good to start from 1 extension and move ahead.</p><p id="2355b2cc-075b-8063-84aa-fc3daa07f926" class=""><strong>Search Query</strong>: <code>index=botsv1 sourcetype=stream:http dest_ip=&quot;192.168.250.70&quot; *.exe</code></p><figure id="2355b2cc-075b-80b5-99e8-ceb24e27b96e" class="image"><a href="https://tryhackme-images.s3.amazonaws.com/user-uploads/5e8dd9a4a45e18443162feab/room-content/4097da92bb83bd61cdacec4539c58d67.gif"><img src="https://tryhackme-images.s3.amazonaws.com/user-uploads/5e8dd9a4a45e18443162feab/room-content/4097da92bb83bd61cdacec4539c58d67.gif"/></a></figure><p id="2355b2cc-075b-80d4-85fc-c61c22ae7bba" class="">With the search query in place, we are looking for the fields that could have some values of our interest. As we could not find the file name field, we looked at the missing fields and saw a field. <code>part_filename{}</code>.</p><p id="2355b2cc-075b-80a6-9346-cd23cfdb37ac" class="">Observing the interesting fields and values, we can see the field <code>part_filename{}</code> contains the two file names. an executable file <code>3791.exe</code> and a PHP file <code>agent.php</code></p><p id="2355b2cc-075b-8000-bd4f-f65ff55bdb83" class="">I found 2 files, as follows - </p><figure id="2355b2cc-075b-80f5-9a71-c53e15e151c5" class="image"><a href="assets/77F56E25-C968-4D2E-BAA1-F4FA51616FAE.png"><img style="width:685.986328125px" src="assets/77F56E25-C968-4D2E-BAA1-F4FA51616FAE.png"/></a></figure><p id="2355b2cc-075b-8014-99ed-f7902e058d48" class="">Next, we need to find if any of these files came from the IP addresses that were found to be associated with the attack earlier.</p><p id="2355b2cc-075b-8002-95ae-ca086314465e" class="">Click on the file name; it will be added to the search query, then look for the field c_ip, which seems to represent the client IP.</p><p id="2355b2cc-075b-8023-bafe-e3f4a236f346" class=""><strong>Search Query:</strong><code>index=botsv1 sourcetype=stream:http dest_ip=&quot;192.168.250.70&quot; &quot;part_filename{}&quot;=&quot;3791.exe&quot;</code></p><p id="2355b2cc-075b-80fc-8637-ebf9c658c13e" class="">
</p><p id="2355b2cc-075b-80a0-9d55-e22786694732" class=""><strong>Was this file executed on the server after being uploaded?</strong></p><p id="2355b2cc-075b-805f-a1dc-efc9f779cd8c" class="">We have found that file <strong>3791.exe</strong> was uploaded on the server. The question that may come to our mind would be, was this file executed on the server? We need to narrow down our search query to show the logs from the host-centric log sources to answer this question.</p><p id="2355b2cc-075b-808f-90da-f0251d3966d5" class=""><strong>Search Query:</strong> <code>index=botsv1 &quot;3791.exe&quot;</code></p><figure id="2355b2cc-075b-80ab-8401-cb52d4474f33" class="image"><a href="assets/image%20266.png"><img style="width:685.986328125px" src="assets/image%20266.png"/></a></figure><p id="2355b2cc-075b-805f-865c-f7dfb270c9fa" class="">Now we have identified the exe name, I can use that to see all the events related to that.</p><p id="2355b2cc-075b-807a-b4a9-ca077c93e98a" class="">Following the Host-centric log, sources were found to have traces of the executable 3791. exe.</p><ul id="2355b2cc-075b-80ef-8d6f-ea94a018576e" class="bulleted-list"><li style="list-style-type:disc">Sysmon</li></ul><ul id="2355b2cc-075b-80cd-be2e-f6539a05fd3d" class="bulleted-list"><li style="list-style-type:disc">WinEventlog</li></ul><ul id="2355b2cc-075b-80ca-906e-d19042eef773" class="bulleted-list"><li style="list-style-type:disc">fortigate_utm</li></ul><p id="2355b2cc-075b-8075-bb41-eb853787fede" class="">For the evidence of execution, we can leverage sysmon and look at the EventCode=1 for program execution.</p><p id="2355b2cc-075b-80d2-a9f6-c45626bead73" class="">Reference: <a href="https://docs.microsoft.com/en-us/sysinternals/downloads/sysmon">https://docs.microsoft.com/en-us/sysinternals/downloads/sysmon</a></p><figure id="2355b2cc-075b-80de-a3bf-ccefc07518e0" class="image"><a href="https://tryhackme-images.s3.amazonaws.com/user-uploads/5e8dd9a4a45e18443162feab/room-content/0135d57671ea197866054124115cfb4c.png"><img src="https://tryhackme-images.s3.amazonaws.com/user-uploads/5e8dd9a4a45e18443162feab/room-content/0135d57671ea197866054124115cfb4c.png"/></a></figure><p id="2355b2cc-075b-800e-9cb7-da826a65fcf4" class=""><strong>Search Query:</strong> <code>index=botsv1 &quot;3791.exe&quot; sourcetype=&quot;XmlWinEventLog&quot; EventCode=1</code></p><p id="2355b2cc-075b-8085-a654-f46d6bc869cb" class=""><strong>Query Explanation:</strong> This query will look for the process Creation logs containing the term <strong>&quot;3791.exe&quot;</strong> in the logs.</p><figure id="2355b2cc-075b-80f2-a187-ddc021f58102" class="image"><a href="https://tryhackme-images.s3.amazonaws.com/user-uploads/5e8dd9a4a45e18443162feab/room-content/140a87acbf87ae7b9cf62f41dd93acdb.png"><img src="https://tryhackme-images.s3.amazonaws.com/user-uploads/5e8dd9a4a45e18443162feab/room-content/140a87acbf87ae7b9cf62f41dd93acdb.png"/></a></figure><p id="2355b2cc-075b-804b-9353-ff06b6c94cad" class="">Looking at the output, we can clearly say that this file was executed on the compromised server. We can also look at other host-centric log sources to confirm the result.</p><p id="2355b2cc-075b-8040-a713-e5c942a3d834" class="">I managed to find the hash of the file, </p><figure id="2355b2cc-075b-80d7-8443-f23434ee0f46" class="image"><a href="assets/F5209E4E-0F43-4F3C-B727-BC2BED020E31.png"><img style="width:685.9091186523438px" src="assets/F5209E4E-0F43-4F3C-B727-BC2BED020E31.png"/></a></figure><p id="2355b2cc-075b-8041-afc7-e7af52e19abb" class=""><a href="https://www.virustotal.com/gui/file/ec78c938d8453739ca2a370b9c275971ec46caf6e479de2b2d04e97cc47fa45d/details">https://www.virustotal.com/gui/file/ec78c938d8453739ca2a370b9c275971ec46caf6e479de2b2d04e97cc47fa45d/details</a></p><p id="2355b2cc-075b-8098-ae9a-c4b95cc305d7" class="">The file is a known <a href="https://www.virustotal.com/gui/search/engines:trojan%20AND%20engines:hacktool%20AND%20engines:swrort%20AND%20engines:cryptz%20AND%20engines:marte">trojan.swrort/cryptz</a>. The exe was run by the user NT AUTHORITY\IUSR</p><figure id="2355b2cc-075b-807d-a698-fded629e2734" class="image"><a href="assets/997BAA4D-7B2C-4A26-8B67-B6FC8CAFA4B8.png"><img style="width:685.9605712890625px" src="assets/997BAA4D-7B2C-4A26-8B67-B6FC8CAFA4B8.png"/></a></figure><p id="2355b2cc-075b-8066-af9e-caa90b5db5fb" class="">
</p><h2 id="2355b2cc-075b-803a-8a05-ca03d497e16f" class="">Action on Objectives</h2><p id="2355b2cc-075b-8044-a384-e612104c5903" class="">As the website was defaced due to a successful attack by the adversary, it would be helpful to understand better what ended up on the website that caused defacement.</p><p id="2355b2cc-075b-80e2-9dcb-ee1e084fdb44" class="">As an analyst, our first quest could be to figure out the traffic flow that could lead us to the answer to this question. There can be a different approach to finding the answer to this question. We will start our investigation by examining the <strong>Suricata</strong> log source and the IP addresses communicating with the webserver 192.168.250.70.</p><p id="2355b2cc-075b-80e1-843c-ce3bafc2c6ad" class=""><strong>Search Query</strong>:<code>index=botsv1 dest=192.168.250.70 sourcetype=suricata</code></p><figure id="2355b2cc-075b-8035-8154-c541dceb5786" class="image"><a href="https://tryhackme-images.s3.amazonaws.com/user-uploads/5e8dd9a4a45e18443162feab/room-content/47741c5563b7aebe667ec7eafdeaf1b3.png"><img src="https://tryhackme-images.s3.amazonaws.com/user-uploads/5e8dd9a4a45e18443162feab/room-content/47741c5563b7aebe667ec7eafdeaf1b3.png"/></a></figure><p id="2355b2cc-075b-80fd-8489-d13851915bbe" class="">The logs do not show any external IP communicating with the server. Let us change the flow direction to see if any communication originates from the server.</p><p id="2355b2cc-075b-803b-a929-fda07a945886" class=""><strong>Search Query:</strong> <code>index=botsv1 src=192.168.250.70 sourcetype=suricata</code></p><figure id="2355b2cc-075b-8016-a631-dde33fc2d57a" class="image"><a href="https://tryhackme-images.s3.amazonaws.com/user-uploads/5e8dd9a4a45e18443162feab/room-content/9cdce04d736980734ede35d17bc9d9a7.png"><img src="https://tryhackme-images.s3.amazonaws.com/user-uploads/5e8dd9a4a45e18443162feab/room-content/9cdce04d736980734ede35d17bc9d9a7.png"/></a></figure><p id="2355b2cc-075b-80c9-9a8b-e0feb3fa160c" class="">What is interesting about the output? Usually, the web servers do not originate the traffic. The browser or the client would be the source, and the server would be the destination. Here we see three external IPs towards which our web server initiates the outbound traffic. There is a large chunk of traffic going to these external IP addresses, which could be worth checking.</p><p id="2355b2cc-075b-8011-97db-c2773334e7c1" class="">Pivot into the destination IPs one by one to see what kind of traffic/communication is being carried out.</p><p id="2355b2cc-075b-80cb-afa2-c439afa10bd7" class=""><strong>Search Query:</strong> <code>index=botsv1 src=192.168.250.70 sourcetype=suricata dest_ip=23.22.63.114</code></p><figure id="2355b2cc-075b-802a-8734-e464f00d4d6d" class="image"><a href="https://tryhackme-images.s3.amazonaws.com/user-uploads/5e8dd9a4a45e18443162feab/room-content/d012293c246dcc717ab0c80a7190845b.png"><img src="https://tryhackme-images.s3.amazonaws.com/user-uploads/5e8dd9a4a45e18443162feab/room-content/d012293c246dcc717ab0c80a7190845b.png"/></a></figure><p id="2355b2cc-075b-80a5-ab64-f640525c41d0" class="">The URL field shows 2 PHP files and one jpeg file. This jpeg file looks interesting. Let us change the search query and see where this jpeg file came from.</p><p id="2355b2cc-075b-802f-a5f5-cdb471932439" class=""><strong>Search Query:</strong> <code>index=botsv1 url=&quot;/poisonivy-is-coming-for-you-batman.jpeg&quot; dest_ip=&quot;192.168.250.70&quot; | table _time src dest_ip http.hostname url</code></p><figure id="2355b2cc-075b-807c-a1ce-f73a943565ad" class="image"><a href="https://tryhackme-images.s3.amazonaws.com/user-uploads/5e8dd9a4a45e18443162feab/room-content/da31347a03f68b6e9998e66db946dccb.gif"><img src="https://tryhackme-images.s3.amazonaws.com/user-uploads/5e8dd9a4a45e18443162feab/room-content/da31347a03f68b6e9998e66db946dccb.gif"/></a></figure><p id="2355b2cc-075b-80b4-9221-d74309e1f465" class="">The end result clearly shows a suspicious jpeg <code>poisonivy-is-coming-for-you-batman.jpeg</code> was downloaded from the attacker&#x27;s host <code>prankglassinebracket.jumpingcrab.com</code> that defaced the site.</p><figure id="2355b2cc-075b-80fe-be16-c533b6f591f7" class="image"><a href="https://tryhackme-images.s3.amazonaws.com/user-uploads/5e8dd9a4a45e18443162feab/room-content/b71e2d7ed8b035a368d34ce02441a105.png"><img src="https://tryhackme-images.s3.amazonaws.com/user-uploads/5e8dd9a4a45e18443162feab/room-content/b71e2d7ed8b035a368d34ce02441a105.png"/></a></figure><figure id="2355b2cc-075b-8008-8024-f3335c49f0e7" class="image"><a href="assets/87C5C71F-7D7B-4394-8F57-7272394AC8B0.png"><img style="width:685.986328125px" src="assets/87C5C71F-7D7B-4394-8F57-7272394AC8B0.png"/></a></figure><p id="2355b2cc-075b-802e-818e-c1d9679d280c" class="">
</p><h2 id="2355b2cc-075b-8063-a456-d0797d418fcf" class=""><strong>Command and Control:</strong></h2><p id="2355b2cc-075b-8028-afeb-e80d91f43089" class="">The attacker uploaded the file to the server before defacing it. While doing so, the attacker used a Dynamic DNS to resolve a malicious IP. Our objective would be to find the IP that the attacker decided the DNS.</p><p id="2355b2cc-075b-808a-849b-e5f5b96c7dd5" class="">To investigate the communication to and from the adversary&#x27;s IP addresses, we will be examining the network-centric log sources mentioned above. We will first pick fortigate_utm to review the firewall logs and then move on to the other log sources.</p><p id="2355b2cc-075b-8055-829d-db40fe53eb21" class=""><strong>Search Query:</strong> <code>index=botsv1 sourcetype=fortigate_utm&quot;poisonivy-is-coming-for-you-batman.jpeg&quot;</code></p><figure id="2355b2cc-075b-8048-8a30-c5acd596564f" class="image"><a href="https://tryhackme-images.s3.amazonaws.com/user-uploads/5e8dd9a4a45e18443162feab/room-content/a2df650b7d76e7cc7a795b8d0b627bfe.png"><img src="https://tryhackme-images.s3.amazonaws.com/user-uploads/5e8dd9a4a45e18443162feab/room-content/a2df650b7d76e7cc7a795b8d0b627bfe.png"/></a></figure><p id="2355b2cc-075b-8004-8b55-c470f9302093" class="">Looking into the Fortinet firewall logs, we can see the src IP, destination IP, and URL. Look at the fields on the left panel and the field <code>url</code> contains the FQDN (Fully Qualified Domain Name).</p><figure id="2355b2cc-075b-80ac-b072-edc6ffb0b39a" class="image"><a href="https://tryhackme-images.s3.amazonaws.com/user-uploads/5e8dd9a4a45e18443162feab/room-content/e5cda837fe7a7cbfa791515b49756f69.png"><img src="https://tryhackme-images.s3.amazonaws.com/user-uploads/5e8dd9a4a45e18443162feab/room-content/e5cda837fe7a7cbfa791515b49756f69.png"/></a></figure><p id="2355b2cc-075b-804d-b280-d8aee8de139e" class="">Though we have found the answer, we can verify other log sources.</p><p id="2355b2cc-075b-8057-90c6-cfc29198c7ea" class="">Let us verify the answer by looking at another log source.</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="2355b2cc-075b-80f8-9b60-c6ac2b9460da" class="code code-wrap"><code class="language-Plain Text" style="white-space:pre-wrap;word-break:break-all">stream:http</code></pre><p id="2355b2cc-075b-80f3-a2ea-c9fca8744bc3" class="">.</p><p id="2355b2cc-075b-8024-aa5c-d659c42864d4" class=""><strong>Search Query:</strong> <code>index=botsv1 sourcetype=stream:http dest_ip=23.22.63.114 &quot;poisonivy-is-coming-for-you-batman.jpeg&quot; src_ip=192.168.250.70</code></p><figure id="2355b2cc-075b-8016-acc3-ca17527d0fe1" class="image"><a href="https://tryhackme-images.s3.amazonaws.com/user-uploads/5e8dd9a4a45e18443162feab/room-content/495918ac13b99ae950a0ac470fa349fc.png"><img src="https://tryhackme-images.s3.amazonaws.com/user-uploads/5e8dd9a4a45e18443162feab/room-content/495918ac13b99ae950a0ac470fa349fc.png"/></a></figure><p id="2355b2cc-075b-8002-bdef-e5b4c0cfbba4" class="">We have identified the suspicious domain as a Command and Control Server, which the attacker contacted after gaining control of the server.</p><p id="2355b2cc-075b-8005-9430-eebac5024d2c" class=""><strong>Note: </strong>We can also confirm the domain by looking at the last log source <code>stream:dns</code> to see what DNS queries were sent from the webserver during the infection perio</p><figure id="2355b2cc-075b-8011-a070-c1b147eac632" class="image"><a href="assets/image%20267.png"><img style="width:685.9348754882812px" src="assets/image%20267.png"/></a></figure><p id="2355b2cc-075b-8081-a33a-d5ae72446394" class="">
</p><h2 id="2355b2cc-075b-80bc-8b33-c395f1b4282b" class=""><strong>Weaponization</strong></h2><p id="2355b2cc-075b-8063-8c5d-d932a677f784" class="">In the weaponization phase, the adversaries would:</p><ul id="2355b2cc-075b-8022-ac65-ec95670ca226" class="bulleted-list"><li style="list-style-type:disc">Create Malware / Malicious document to gain initial access / evade detection etc.</li></ul><ul id="2355b2cc-075b-80f0-8f7d-dabb689ce560" class="bulleted-list"><li style="list-style-type:disc">Establish domains similar to the target domain to trick users.</li></ul><ul id="2355b2cc-075b-809d-9580-f7eac7b2e6e5" class="bulleted-list"><li style="list-style-type:disc">Create a Command and Control Server for the post-exploitation communication/activity etc.</li></ul><p id="2355b2cc-075b-807c-835f-c3eff1b49832" class="">We have found some domains / IP addresses associated with the attacker during the investigations. This task will mainly look into OSINT sites to see what more information we can get about the adversary.</p><p id="2355b2cc-075b-802a-b924-f8175c4112ac" class="">So far, we have found a domain <code>prankglassinebracket.jumpingcrab.com</code> associated with this attack. Our first task would be to find the IP address tied to the domains that may potentially be pre-staged to attack Wayne Enterprise.</p><p id="2355b2cc-075b-8084-b517-fcc9f2a26986" class="">In the following exercise, we will be searching the online Threat Intel sites for any information like IP addresses/domains / Email addresses associated with this domain which could help us know more about this adversary.</p><p id="2355b2cc-075b-8007-ae79-ed4804c8beed" class=""><strong>Robtex:</strong><a href="https://www.robtex.com/">Robtex</a> is a Threat Intel site that provides information about IP addresses, domain names, etc.</p><p id="2355b2cc-075b-805a-bec6-f5ff46a4e1cf" class="">Please search for the domain on the robtex site and see what we get. We will get the IP addresses associated with this domain.</p><figure id="2355b2cc-075b-803c-8443-e697d3b868f2" class="image"><a href="https://tryhackme-images.s3.amazonaws.com/user-uploads/5e8dd9a4a45e18443162feab/room-content/7ad2296f02b00a73a3ae2e4182fa7cfc.png"><img src="https://tryhackme-images.s3.amazonaws.com/user-uploads/5e8dd9a4a45e18443162feab/room-content/7ad2296f02b00a73a3ae2e4182fa7cfc.png"/></a></figure><p id="2355b2cc-075b-804c-ba5a-fcefec959e6b" class="">Some domains/subdomains associated with this domain:</p><figure id="2355b2cc-075b-802f-8fa0-dd981756e121" class="image"><a href="https://tryhackme-images.s3.amazonaws.com/user-uploads/5e8dd9a4a45e18443162feab/room-content/c6aa355d30ed9425cd6e923526a03d46.png"><img src="https://tryhackme-images.s3.amazonaws.com/user-uploads/5e8dd9a4a45e18443162feab/room-content/c6aa355d30ed9425cd6e923526a03d46.png"/></a></figure><p id="2355b2cc-075b-802f-a8a5-e38624d741ba" class="">Reference<strong>:</strong> <a href="https://www.robtex.com/dns-lookup/prankglassinebracket.jumpingcrab.com">https://www.robtex.com/dns-lookup/prankglassinebracket.jumpingcrab.com</a></p><p id="2355b2cc-075b-8083-af58-ca7181c292d0" class="">Next, search for the IP address <code>23.22.63.114 </code>  on this Threat Intel site.</p><figure id="2355b2cc-075b-8014-b66d-eda8757aca69" class="image"><a href="https://tryhackme-images.s3.amazonaws.com/user-uploads/5e8dd9a4a45e18443162feab/room-content/2a9dd066e2b6ef2cd55a5e0c04983776.png"><img src="https://tryhackme-images.s3.amazonaws.com/user-uploads/5e8dd9a4a45e18443162feab/room-content/2a9dd066e2b6ef2cd55a5e0c04983776.png"/></a></figure><p id="2355b2cc-075b-800d-907e-e4454b08eb65" class="">What did we find? this IP is associated with some domains that look pretty similar to <strong>the WAYNE Enterprise</strong> site.</p><p id="2355b2cc-075b-8022-a57b-fdc2bbad055a" class="">Reference: <a href="https://www.robtex.com/ip-lookup/23.22.63.114">https://www.robtex.com/ip-lookup/23.22.63.114</a></p><figure id="2355b2cc-075b-8027-9059-ddb3e02a0553" class="image"><a href="https://tryhackme-images.s3.amazonaws.com/user-uploads/5e8dd9a4a45e18443162feab/room-content/87794e9d70b8b0dac729232443427181.png"><img src="https://tryhackme-images.s3.amazonaws.com/user-uploads/5e8dd9a4a45e18443162feab/room-content/87794e9d70b8b0dac729232443427181.png"/></a></figure><p id="2355b2cc-075b-802b-a970-d35b1b31f13a" class=""><strong>Virustotal</strong></p><p id="2355b2cc-075b-8018-aed1-e196238bf55c" class=""><a href="https://www.virustotal.com/">Virustotal</a> is an OSINT site used to analyze suspicious files, domains, IP, etc. Let&#x27;s now search for the IP address on the virustotal site. If we go to the <strong>RELATIONS</strong> tab, we can see all the domains associated with this IP which look similar to the Wayn Enterprise company.</p><figure id="2355b2cc-075b-80cf-a88d-c6baa45557a9" class="image"><a href="https://tryhackme-images.s3.amazonaws.com/user-uploads/5e8dd9a4a45e18443162feab/room-content/b217030ec313023a8d811ad513a28378.png"><img src="https://tryhackme-images.s3.amazonaws.com/user-uploads/5e8dd9a4a45e18443162feab/room-content/b217030ec313023a8d811ad513a28378.png"/></a></figure><p id="2355b2cc-075b-8016-a2f3-feef1a8d1001" class="">In the domain list, we saw the domain that is associated with the attacker<code> www.po1s0n1vy.com</code> . Let us search for this domain on the virustotal.</p><figure id="2355b2cc-075b-80d1-9af0-ea337d0cd891" class="image"><a href="https://tryhackme-images.s3.amazonaws.com/user-uploads/5e8dd9a4a45e18443162feab/room-content/0d1024a79200a34705ac77b986782104.png"><img src="https://tryhackme-images.s3.amazonaws.com/user-uploads/5e8dd9a4a45e18443162feab/room-content/0d1024a79200a34705ac77b986782104.png"/></a></figure><p id="2355b2cc-075b-8089-aa3e-f5c4d008d215" class="">We can also look for the whois information on this site -&gt; <a href="https://whois.domaintools.com/">whois.domaintools.com</a> to see if we can find something valuable.</p><figure id="2355b2cc-075b-80fd-a03c-db91f2e7749f" class="image"><a href="https://tryhackme-images.s3.amazonaws.com/user-uploads/5e8dd9a4a45e18443162feab/room-content/a306319398fa56470363ca0f41cd814f.png"><img src="https://tryhackme-images.s3.amazonaws.com/user-uploads/5e8dd9a4a45e18443162feab/room-content/a306319398fa56470363ca0f41cd814f.png"/></a></figure><p id="2355b2cc-075b-805c-b3e9-fa6e3e3e926c" class="">
</p><figure id="2355b2cc-075b-80bb-a89b-c177a20eca12" class="image"><a href="assets/76EFC139-573E-4542-A36C-2BB1BAE4B6CE.png"><img style="width:685.9348754882812px" src="assets/76EFC139-573E-4542-A36C-2BB1BAE4B6CE.png"/></a></figure><p id="2355b2cc-075b-803e-9eea-c4765b8b43bc" class="">
</p><h2 id="2355b2cc-075b-80c8-8fae-f8be6720fcb5" class=""><strong>Delivery</strong></h2><p id="2355b2cc-075b-8096-bc15-c277d471cca6" class="">Attackers create malware and infect devices to gain initial access or evade defenses and find ways to deliver it through different means. We have identified various IP addresses, domains and Email addresses associated with this adversary. Our task for this lesson would be to use the information we have about the adversary and use various Threat Hunting platforms and OSINT sites to find any malware linked with the adversary.</p><p id="2355b2cc-075b-806a-a3c3-ca28613f4221" class="">Threat Intel report suggested that this adversary group Poison lvy appears to have a secondary attack vector in case the <code>initial compromise</code> fails. Our objective would be to understand more about the attacker and their methodology and correlate the information found in the logs with various threat Intel sources.</p><p id="2355b2cc-075b-80ca-8827-e065b5ccd647" class=""><strong>OSINT sites</strong></p><ul id="2355b2cc-075b-80f9-b9bf-f4e2d3df39a3" class="bulleted-list"><li style="list-style-type:disc">Virustotal</li></ul><ul id="2355b2cc-075b-8051-8719-d36233d60334" class="bulleted-list"><li style="list-style-type:disc">ThreatMiner</li></ul><ul id="2355b2cc-075b-8077-a1f3-ca4814af890e" class="bulleted-list"><li style="list-style-type:disc">Hybrid-Analysis</li></ul><p id="2355b2cc-075b-803e-a6d5-f4d3d0bf6e2e" class=""><strong>ThreatMiner</strong></p><p id="2355b2cc-075b-8062-a780-c793eb46fb27" class="">Let&#x27;s start our investigation by looking for the IP <code>23.22.63.114</code> on the Threat Intel site <a href="https://www.threatminer.org/host.php?q=23.22.63.114#gsc.tab=0&amp;gsc.q=23.22.63.114&amp;gsc.page=1">ThreatMiner.</a></p><figure id="2355b2cc-075b-806b-bf78-f335b0644505" class="image"><a href="https://tryhackme-images.s3.amazonaws.com/user-uploads/5e8dd9a4a45e18443162feab/room-content/994b52e66e64ffba61ca57d32ace6a54.png"><img src="https://tryhackme-images.s3.amazonaws.com/user-uploads/5e8dd9a4a45e18443162feab/room-content/994b52e66e64ffba61ca57d32ace6a54.png"/></a></figure><p id="2355b2cc-075b-804b-9708-dc36200503f8" class="">We found three files associated with this IP, from which one file with the hash value  <code>c99131e0169171935c5ac32615ed6261</code> seems to be malicious and something of interest.</p><p id="2355b2cc-075b-80b2-9a69-eb8ce1c8c14a" class="">Now, click on this MD5 hash value to see the metadata and other important information about this particular file.</p><figure id="2355b2cc-075b-8059-a5e0-c60f115874aa" class="image"><a href="https://tryhackme-images.s3.amazonaws.com/user-uploads/5e8dd9a4a45e18443162feab/room-content/511a309aacc571f2176931686df681e0.png"><img src="https://tryhackme-images.s3.amazonaws.com/user-uploads/5e8dd9a4a45e18443162feab/room-content/511a309aacc571f2176931686df681e0.png"/></a></figure><p id="2355b2cc-075b-8093-9f62-e99a7f72b0eb" class="">Reference: <a href="https://www.threatminer.org/host.php?q=23.22.63.114#gsc.tab=0&amp;gsc.q=23.22.63.114&amp;gsc.page=1">https://www.threatminer.org/host.php?q=23.22.63.114#gsc.tab=0&amp;gsc.q=23.22.63.114&amp;gsc.page=1</a></p><p id="2355b2cc-075b-8094-83d9-c566053a53f4" class=""><strong>Virustotal</strong></p><p id="2355b2cc-075b-801f-887d-d3f38d7a5ec3" class="">Open <a href="http://virustotal.com/">virustotal.com</a> and search for the hash on the virustotal now. Here, we can get information about the metadata about this Malware in the Details tab.</p><figure id="2355b2cc-075b-80e9-85ab-f10ff097f07b" class="image"><a href="https://tryhackme-images.s3.amazonaws.com/user-uploads/5e8dd9a4a45e18443162feab/room-content/c380913c90e52016683cbcfe9174b35e.png"><img src="https://tryhackme-images.s3.amazonaws.com/user-uploads/5e8dd9a4a45e18443162feab/room-content/c380913c90e52016683cbcfe9174b35e.png"/></a></figure><figure id="2355b2cc-075b-80d4-9bdf-d91e3f69051c" class="image"><a href="https://tryhackme-images.s3.amazonaws.com/user-uploads/5e8dd9a4a45e18443162feab/room-content/8edbbf929731d7718587d3c1adc66648.png"><img src="https://tryhackme-images.s3.amazonaws.com/user-uploads/5e8dd9a4a45e18443162feab/room-content/8edbbf929731d7718587d3c1adc66648.png"/></a></figure><p id="2355b2cc-075b-800a-b2f0-df80b7881f37" class="">Reference: <a href="https://www.virustotal.com/gui/file/9709473ab351387aab9e816eff3910b9f28a7a70202e250ed46dba8f820f34a8/community">https://www.virustotal.com/gui/file/9709473ab351387aab9e816eff3910b9f28a7a70202e250ed46dba8f820f34a8/community</a></p><p id="2355b2cc-075b-80a0-a8fc-d28957227d07" class=""><strong>Hybrid-Analysis</strong></p><p id="2355b2cc-075b-8045-853d-dac614216659" class="">Hybrid Analysis is a beneficial site that shows the behavior Analysis of any malware. Here you can look at all the activities performed by this Malware after being executed. Some of the information that Hybrid-Analysis provides are:</p><ul id="2355b2cc-075b-802a-8d24-dd74bac30085" class="bulleted-list"><li style="list-style-type:disc">Network Communication.</li></ul><ul id="2355b2cc-075b-8053-ae8c-cd5f8a518918" class="bulleted-list"><li style="list-style-type:disc">DNS Requests</li></ul><ul id="2355b2cc-075b-8027-b6fa-ebfaf575283a" class="bulleted-list"><li style="list-style-type:disc">Contacted Hosts with Country Mapping</li></ul><ul id="2355b2cc-075b-800a-a6c4-c4457dc2de27" class="bulleted-list"><li style="list-style-type:disc">Strings</li></ul><ul id="2355b2cc-075b-8062-8fae-cec57c4fcc49" class="bulleted-list"><li style="list-style-type:disc">MITRE ATT&amp;CK Mapping</li></ul><ul id="2355b2cc-075b-8035-8d4e-c82113944f4d" class="bulleted-list"><li style="list-style-type:disc">Malicious Indicators.</li></ul><ul id="2355b2cc-075b-80cb-8258-eadd7a71eee3" class="bulleted-list"><li style="list-style-type:disc">DLLs Imports / Exports</li></ul><ul id="2355b2cc-075b-8007-b9d3-c948e387bd02" class="bulleted-list"><li style="list-style-type:disc">Mutex Information if created</li></ul><ul id="2355b2cc-075b-8034-a3b0-f33e826c30b4" class="bulleted-list"><li style="list-style-type:disc">File Metadata</li></ul><ul id="2355b2cc-075b-80e1-bb06-f3fb38842b2f" class="bulleted-list"><li style="list-style-type:disc">Screenshots</li></ul><figure id="2355b2cc-075b-8086-a3b5-c185143d5114" class="image"><a href="https://tryhackme-images.s3.amazonaws.com/user-uploads/5e8dd9a4a45e18443162feab/room-content/6ef05247bb5c92e91d0a2894f219758a.png"><img src="https://tryhackme-images.s3.amazonaws.com/user-uploads/5e8dd9a4a45e18443162feab/room-content/6ef05247bb5c92e91d0a2894f219758a.png"/></a></figure><p id="2355b2cc-075b-80e0-b3c5-c7c610d019ff" class="">Scroll down, and you will get a lot of information about this Malware.</p><figure id="2355b2cc-075b-808a-b485-d733ee273149" class="image"><a href="https://tryhackme-images.s3.amazonaws.com/user-uploads/5e8dd9a4a45e18443162feab/room-content/7a714d6ca3a44c0c570c45cb2711b660.png"><img src="https://tryhackme-images.s3.amazonaws.com/user-uploads/5e8dd9a4a45e18443162feab/room-content/7a714d6ca3a44c0c570c45cb2711b660.png"/></a></figure><p id="2355b2cc-075b-80e3-b288-c3023f62bbc3" class="">Reference<strong>:</strong> <a href="https://www.hybrid-analysis.com/sample/9709473ab351387aab9e816eff3910b9f28a7a70202e250ed46dba8f820f34a8?environmentId=100">https://www.hybrid-analysis.com/sample/9709473ab351387aab9e816eff3910b9f28a7a70202e250ed46dba8f820f34a8?environmentId=100</a></p><figure id="2355b2cc-075b-8040-b985-fdc889e42e33" class="image"><a href="assets/image%20268.png"><img style="width:685.9348754882812px" src="assets/image%20268.png"/></a></figure><p id="2355b2cc-075b-80ca-ac16-f0577c866f44" class="">
</p><h2 id="2355b2cc-075b-8088-9d1c-fab1b285bf66" class=""><strong>Conclusion:</strong></h2><p id="2355b2cc-075b-809f-ac31-d481a24ed6d7" class="">In this fun exercise, as a SOC Analyst, we have investigated a cyber-attack where the attacker had defaced a website &#x27;imreallynotbatman.com&#x27; of the Wayne Enterprise. We mapped the attacker&#x27;s activities into the 7 phases of the Cyber Kill Chain. Let us recap everything we have found so far:</p><p id="2355b2cc-075b-8082-99b5-c486056016a6" class=""><strong>Reconnaissance Phase:</strong></p><p id="2355b2cc-075b-807c-852f-f08faf40f1dc" class="">We first looked at any reconnaissance activity from the attacker to identify the IP address and other details about the adversary.</p><p id="2355b2cc-075b-80ae-8941-e74a33ca3cb9" class=""><strong>Findings:</strong></p><ul id="2355b2cc-075b-8040-a7b2-f62516dc4736" class="bulleted-list"><li style="list-style-type:disc">IP Address <code>40.80.148.42</code> was found to be scanning our webserver.</li></ul><ul id="2355b2cc-075b-8081-9794-fdc2d7745a90" class="bulleted-list"><li style="list-style-type:disc">The attacker was using Acunetix as a web scanner.</li></ul><p id="2355b2cc-075b-8099-8461-d2a65384d995" class=""><strong>Exploitation Phase:</strong></p><p id="2355b2cc-075b-80bc-bd5a-d9ddc21f16ee" class="">We then looked into the traces of exploitation attempts and found brute-force attacks against our server, which were successful.</p><p id="2355b2cc-075b-804f-81b2-c40da6227701" class=""><strong>Findings:</strong></p><ul id="2355b2cc-075b-80e4-abcf-f96bfe3cbeca" class="bulleted-list"><li style="list-style-type:disc">Brute force attack originated from IP <code>23.22.63.114.</code></li></ul><ul id="2355b2cc-075b-80a7-b7e0-db6a07c79f67" class="bulleted-list"><li style="list-style-type:disc">The IP address used to gain access: <code>40.80.148.42</code></li></ul><ul id="2355b2cc-075b-80cc-8910-dc4d7f0cc9ed" class="bulleted-list"><li style="list-style-type:disc">142 unique brute force attempts were made against the server, out of which one attempt was successful</li></ul><p id="2355b2cc-075b-80f0-8898-c4bf50d98e55" class=""><strong>Installation Phase:</strong></p><p id="2355b2cc-075b-80f7-8628-c3a59e32f4fc" class="">Next, we looked at the installation phase to see any executable from the attacker&#x27;s IP Address uploaded to our server.</p><p id="2355b2cc-075b-8075-9876-d53243feb6a1" class=""><strong>Findings:</strong></p><ul id="2355b2cc-075b-80e8-9fee-ca711174017d" class="bulleted-list"><li style="list-style-type:disc">A malicious executable file <code>3791.exe</code> was observed to be uploaded by the attacker.</li></ul><ul id="2355b2cc-075b-80e1-9b4b-c1f97a3ac98a" class="bulleted-list"><li style="list-style-type:disc">We looked at the sysmon logs and found the MD5 hash of the file.</li></ul><p id="2355b2cc-075b-80d4-8e36-e04cb9a5375d" class=""><strong>Action on Objective:</strong></p><p id="2355b2cc-075b-8055-8036-c6f45d8e8b51" class="">After compromising the web server, the attacker defaced the website.</p><p id="2355b2cc-075b-8005-bce8-ddc78d9a45a0" class=""><strong>Findings:</strong></p><ul id="2355b2cc-075b-804b-9033-cabdf4c041f3" class="bulleted-list"><li style="list-style-type:disc">We examined the logs and found the file name used to deface the webserver.</li></ul><p id="2355b2cc-075b-80c9-8af9-c9c86442f4a2" class=""><strong>Weaponization Phase:</strong></p><p id="2355b2cc-075b-8079-ab51-e4314c58a662" class="">We used various threat Intel platforms to find the attacker&#x27;s infrastructure based on the following information we saw in the above activities.</p><p id="2355b2cc-075b-80e8-9f10-de18dd212497" class="">Information we had:</p><p id="2355b2cc-075b-8019-be10-c0f4114dad0f" class="">Domain: <code>prankglassinebracket.jumpingcrab.com</code></p><p id="2355b2cc-075b-8030-981c-fb26f48d773b" class="">IP Address: 23.22.63.114</p><p id="2355b2cc-075b-800a-8375-e9ac00351ae1" class=""><strong>Findings:</strong></p><ul id="2355b2cc-075b-8062-85f3-f4e977a95481" class="bulleted-list"><li style="list-style-type:disc">Multiple masquerading domains were found associated with the attacker&#x27;s IPs.</li></ul><ul id="2355b2cc-075b-80a4-8dca-c83065e7d380" class="bulleted-list"><li style="list-style-type:disc">An email of the user <code>Lillian.rose@po1s0n1vy.com</code> was also found associated with the attacker&#x27;s IP address.</li></ul><p id="2355b2cc-075b-801d-97a2-ff853e6b3ce3" class=""><strong>Deliver Phase:</strong></p><p id="2355b2cc-075b-800e-918a-cffac2c99fb2" class="">In this phase, we again leveraged online Threat Intel sites to find malware associated with the adversary&#x27;s IP address, which appeared to be a secondary attack vector if the initial compromise failed.</p><p id="2355b2cc-075b-80bd-800d-eeebb2866323" class=""><strong>Findings:</strong></p><ul id="2355b2cc-075b-8058-8885-ef5ea8c9376b" class="bulleted-list"><li style="list-style-type:disc">A malware name <code>MirandaTateScreensaver.scr.exe</code> was found associated with the adversary.</li></ul><ul id="2355b2cc-075b-80a4-96a3-d51721f74bad" class="bulleted-list"><li style="list-style-type:disc">MD5 of the malware was <code>c99131e0169171935c5ac32615ed6261</code></li></ul><p id="2355b2cc-075b-80ef-b658-f41037f159a5" class="">
</p></div></article><span class="sans" style="font-size:14px;padding-top:2em"></span></body></html>