<html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><title>Malware Analysis - Intro</title><style>
/* cspell:disable-file */
/* webkit printing magic: print all background colors */
html {
	-webkit-print-color-adjust: exact;
}
* {
	box-sizing: border-box;
	-webkit-print-color-adjust: exact;
}

html,
body {
	margin: 0;
	padding: 0;
}
@media only screen {
	body {
		margin: 2em auto;
		max-width: 900px;
		color: rgb(55, 53, 47);
	}
}

body {
	line-height: 1.5;
	white-space: pre-wrap;
}

a,
a.visited {
	color: inherit;
	text-decoration: underline;
}

.pdf-relative-link-path {
	font-size: 80%;
	color: #444;
}

h1,
h2,
h3 {
	letter-spacing: -0.01em;
	line-height: 1.2;
	font-weight: 600;
	margin-bottom: 0;
}

.page-title {
	font-size: 2.5rem;
	font-weight: 700;
	margin-top: 0;
	margin-bottom: 0.75em;
}

h1 {
	font-size: 1.875rem;
	margin-top: 1.875rem;
}

h2 {
	font-size: 1.5rem;
	margin-top: 1.5rem;
}

h3 {
	font-size: 1.25rem;
	margin-top: 1.25rem;
}

.source {
	border: 1px solid #ddd;
	border-radius: 3px;
	padding: 1.5em;
	word-break: break-all;
}

.callout {
	border-radius: 3px;
	padding: 1rem;
}

figure {
	margin: 1.25em 0;
	page-break-inside: avoid;
}

figcaption {
	opacity: 0.5;
	font-size: 85%;
	margin-top: 0.5em;
}

mark {
	background-color: transparent;
}

.indented {
	padding-left: 1.5em;
}

hr {
	background: transparent;
	display: block;
	width: 100%;
	height: 1px;
	visibility: visible;
	border: none;
	border-bottom: 1px solid rgba(55, 53, 47, 0.09);
}

img {
	max-width: 100%;
}

@media only print {
	img {
		max-height: 100vh;
		object-fit: contain;
	}
}

@page {
	margin: 1in;
}

.collection-content {
	font-size: 0.875rem;
}

.column-list {
	display: flex;
	justify-content: space-between;
}

.column {
	padding: 0 1em;
}

.column:first-child {
	padding-left: 0;
}

.column:last-child {
	padding-right: 0;
}

.table_of_contents-item {
	display: block;
	font-size: 0.875rem;
	line-height: 1.3;
	padding: 0.125rem;
}

.table_of_contents-indent-1 {
	margin-left: 1.5rem;
}

.table_of_contents-indent-2 {
	margin-left: 3rem;
}

.table_of_contents-indent-3 {
	margin-left: 4.5rem;
}

.table_of_contents-link {
	text-decoration: none;
	opacity: 0.7;
	border-bottom: 1px solid rgba(55, 53, 47, 0.18);
}

table,
th,
td {
	border: 1px solid rgba(55, 53, 47, 0.09);
	border-collapse: collapse;
}

table {
	border-left: none;
	border-right: none;
}

th,
td {
	font-weight: normal;
	padding: 0.25em 0.5em;
	line-height: 1.5;
	min-height: 1.5em;
	text-align: left;
}

th {
	color: rgba(55, 53, 47, 0.6);
}

ol,
ul {
	margin: 0;
	margin-block-start: 0.6em;
	margin-block-end: 0.6em;
}

li > ol:first-child,
li > ul:first-child {
	margin-block-start: 0.6em;
}

ul > li {
	list-style: disc;
}

ul.to-do-list {
	padding-inline-start: 0;
}

ul.to-do-list > li {
	list-style: none;
}

.to-do-children-checked {
	text-decoration: line-through;
	opacity: 0.375;
}

ul.toggle > li {
	list-style: none;
}

ul {
	padding-inline-start: 1.7em;
}

ul > li {
	padding-left: 0.1em;
}

ol {
	padding-inline-start: 1.6em;
}

ol > li {
	padding-left: 0.2em;
}

.mono ol {
	padding-inline-start: 2em;
}

.mono ol > li {
	text-indent: -0.4em;
}

.toggle {
	padding-inline-start: 0em;
	list-style-type: none;
}

/* Indent toggle children */
.toggle > li > details {
	padding-left: 1.7em;
}

.toggle > li > details > summary {
	margin-left: -1.1em;
}

.selected-value {
	display: inline-block;
	padding: 0 0.5em;
	background: rgba(206, 205, 202, 0.5);
	border-radius: 3px;
	margin-right: 0.5em;
	margin-top: 0.3em;
	margin-bottom: 0.3em;
	white-space: nowrap;
}

.collection-title {
	display: inline-block;
	margin-right: 1em;
}

.page-description {
	margin-bottom: 2em;
}

.simple-table {
	margin-top: 1em;
	font-size: 0.875rem;
	empty-cells: show;
}
.simple-table td {
	height: 29px;
	min-width: 120px;
}

.simple-table th {
	height: 29px;
	min-width: 120px;
}

.simple-table-header-color {
	background: rgb(247, 246, 243);
	color: black;
}
.simple-table-header {
	font-weight: 500;
}

time {
	opacity: 0.5;
}

.icon {
	display: inline-block;
	max-width: 1.2em;
	max-height: 1.2em;
	text-decoration: none;
	vertical-align: text-bottom;
	margin-right: 0.5em;
}

img.icon {
	border-radius: 3px;
}

.user-icon {
	width: 1.5em;
	height: 1.5em;
	border-radius: 100%;
	margin-right: 0.5rem;
}

.user-icon-inner {
	font-size: 0.8em;
}

.text-icon {
	border: 1px solid #000;
	text-align: center;
}

.page-cover-image {
	display: block;
	object-fit: cover;
	width: 100%;
	max-height: 30vh;
}

.page-header-icon {
	font-size: 3rem;
	margin-bottom: 1rem;
}

.page-header-icon-with-cover {
	margin-top: -0.72em;
	margin-left: 0.07em;
}

.page-header-icon img {
	border-radius: 3px;
}

.link-to-page {
	margin: 1em 0;
	padding: 0;
	border: none;
	font-weight: 500;
}

p > .user {
	opacity: 0.5;
}

td > .user,
td > time {
	white-space: nowrap;
}

input[type="checkbox"] {
	transform: scale(1.5);
	margin-right: 0.6em;
	vertical-align: middle;
}

p {
	margin-top: 0.5em;
	margin-bottom: 0.5em;
}

.image {
	border: none;
	margin: 1.5em 0;
	padding: 0;
	border-radius: 0;
	text-align: center;
}

.code,
code {
	background: rgba(135, 131, 120, 0.15);
	border-radius: 3px;
	padding: 0.2em 0.4em;
	border-radius: 3px;
	font-size: 85%;
	tab-size: 2;
}

code {
	color: #eb5757;
}

.code {
	padding: 1.5em 1em;
}

.code-wrap {
	white-space: pre-wrap;
	word-break: break-all;
}

.code > code {
	background: none;
	padding: 0;
	font-size: 100%;
	color: inherit;
}

blockquote {
	font-size: 1.25em;
	margin: 1em 0;
	padding-left: 1em;
	border-left: 3px solid rgb(55, 53, 47);
}

.bookmark {
	text-decoration: none;
	max-height: 8em;
	padding: 0;
	display: flex;
	width: 100%;
	align-items: stretch;
}

.bookmark-title {
	font-size: 0.85em;
	overflow: hidden;
	text-overflow: ellipsis;
	height: 1.75em;
	white-space: nowrap;
}

.bookmark-text {
	display: flex;
	flex-direction: column;
}

.bookmark-info {
	flex: 4 1 180px;
	padding: 12px 14px 14px;
	display: flex;
	flex-direction: column;
	justify-content: space-between;
}

.bookmark-image {
	width: 33%;
	flex: 1 1 180px;
	display: block;
	position: relative;
	object-fit: cover;
	border-radius: 1px;
}

.bookmark-description {
	color: rgba(55, 53, 47, 0.6);
	font-size: 0.75em;
	overflow: hidden;
	max-height: 4.5em;
	word-break: break-word;
}

.bookmark-href {
	font-size: 0.75em;
	margin-top: 0.25em;
}

.sans { font-family: ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI Variable Display", "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol"; }
.code { font-family: "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace; }
.serif { font-family: Lyon-Text, Georgia, ui-serif, serif; }
.mono { font-family: iawriter-mono, Nitti, Menlo, Courier, monospace; }
.pdf .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI Variable Display", "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK JP'; }
.pdf:lang(zh-CN) .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI Variable Display", "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK SC'; }
.pdf:lang(zh-TW) .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI Variable Display", "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK TC'; }
.pdf:lang(ko-KR) .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI Variable Display", "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK KR'; }
.pdf .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK JP'; }
.pdf:lang(zh-CN) .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK SC'; }
.pdf:lang(zh-TW) .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK TC'; }
.pdf:lang(ko-KR) .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK KR'; }
.pdf .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK JP'; }
.pdf:lang(zh-CN) .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK SC'; }
.pdf:lang(zh-TW) .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK TC'; }
.pdf:lang(ko-KR) .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK KR'; }
.pdf .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK JP'; }
.pdf:lang(zh-CN) .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK SC'; }
.pdf:lang(zh-TW) .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK TC'; }
.pdf:lang(ko-KR) .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK KR'; }
.highlight-default {
	color: rgba(50, 48, 44, 1);
}
.highlight-gray {
	color: rgba(115, 114, 110, 1);
	fill: rgba(115, 114, 110, 1);
}
.highlight-brown {
	color: rgba(159, 107, 83, 1);
	fill: rgba(159, 107, 83, 1);
}
.highlight-orange {
	color: rgba(217, 115, 13, 1);
	fill: rgba(217, 115, 13, 1);
}
.highlight-yellow {
	color: rgba(203, 145, 47, 1);
	fill: rgba(203, 145, 47, 1);
}
.highlight-teal {
	color: rgba(68, 131, 97, 1);
	fill: rgba(68, 131, 97, 1);
}
.highlight-blue {
	color: rgba(51, 126, 169, 1);
	fill: rgba(51, 126, 169, 1);
}
.highlight-purple {
	color: rgba(144, 101, 176, 1);
	fill: rgba(144, 101, 176, 1);
}
.highlight-pink {
	color: rgba(193, 76, 138, 1);
	fill: rgba(193, 76, 138, 1);
}
.highlight-red {
	color: rgba(205, 60, 58, 1);
	fill: rgba(205, 60, 58, 1);
}
.highlight-default_background {
	color: rgba(50, 48, 44, 1);
}
.highlight-gray_background {
	background: rgba(248, 248, 247, 1);
}
.highlight-brown_background {
	background: rgba(244, 238, 238, 1);
}
.highlight-orange_background {
	background: rgba(251, 236, 221, 1);
}
.highlight-yellow_background {
	background: rgba(251, 243, 219, 1);
}
.highlight-teal_background {
	background: rgba(237, 243, 236, 1);
}
.highlight-blue_background {
	background: rgba(231, 243, 248, 1);
}
.highlight-purple_background {
	background: rgba(248, 243, 252, 1);
}
.highlight-pink_background {
	background: rgba(252, 241, 246, 1);
}
.highlight-red_background {
	background: rgba(253, 235, 236, 1);
}
.block-color-default {
	color: inherit;
	fill: inherit;
}
.block-color-gray {
	color: rgba(115, 114, 110, 1);
	fill: rgba(115, 114, 110, 1);
}
.block-color-brown {
	color: rgba(159, 107, 83, 1);
	fill: rgba(159, 107, 83, 1);
}
.block-color-orange {
	color: rgba(217, 115, 13, 1);
	fill: rgba(217, 115, 13, 1);
}
.block-color-yellow {
	color: rgba(203, 145, 47, 1);
	fill: rgba(203, 145, 47, 1);
}
.block-color-teal {
	color: rgba(68, 131, 97, 1);
	fill: rgba(68, 131, 97, 1);
}
.block-color-blue {
	color: rgba(51, 126, 169, 1);
	fill: rgba(51, 126, 169, 1);
}
.block-color-purple {
	color: rgba(144, 101, 176, 1);
	fill: rgba(144, 101, 176, 1);
}
.block-color-pink {
	color: rgba(193, 76, 138, 1);
	fill: rgba(193, 76, 138, 1);
}
.block-color-red {
	color: rgba(205, 60, 58, 1);
	fill: rgba(205, 60, 58, 1);
}
.block-color-default_background {
	color: inherit;
	fill: inherit;
}
.block-color-gray_background {
	background: rgba(248, 248, 247, 1);
}
.block-color-brown_background {
	background: rgba(244, 238, 238, 1);
}
.block-color-orange_background {
	background: rgba(251, 236, 221, 1);
}
.block-color-yellow_background {
	background: rgba(251, 243, 219, 1);
}
.block-color-teal_background {
	background: rgba(237, 243, 236, 1);
}
.block-color-blue_background {
	background: rgba(231, 243, 248, 1);
}
.block-color-purple_background {
	background: rgba(248, 243, 252, 1);
}
.block-color-pink_background {
	background: rgba(252, 241, 246, 1);
}
.block-color-red_background {
	background: rgba(253, 235, 236, 1);
}
.select-value-color-default { background-color: rgba(84, 72, 49, 0.08); }
.select-value-color-gray { background-color: rgba(84, 72, 49, 0.15); }
.select-value-color-brown { background-color: rgba(210, 162, 141, 0.35); }
.select-value-color-orange { background-color: rgba(224, 124, 57, 0.27); }
.select-value-color-yellow { background-color: rgba(236, 191, 66, 0.39); }
.select-value-color-green { background-color: rgba(123, 183, 129, 0.27); }
.select-value-color-blue { background-color: rgba(93, 165, 206, 0.27); }
.select-value-color-purple { background-color: rgba(168, 129, 197, 0.27); }
.select-value-color-pink { background-color: rgba(225, 136, 179, 0.27); }
.select-value-color-red { background-color: rgba(244, 171, 159, 0.4); }

.checkbox {
	display: inline-flex;
	vertical-align: text-bottom;
	width: 16;
	height: 16;
	background-size: 16px;
	margin-left: 2px;
	margin-right: 5px;
}

.checkbox-on {
	background-image: url("data:image/svg+xml;charset=UTF-8,%3Csvg%20width%3D%2216%22%20height%3D%2216%22%20viewBox%3D%220%200%2016%2016%22%20fill%3D%22none%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%0A%3Crect%20width%3D%2216%22%20height%3D%2216%22%20fill%3D%22%2358A9D7%22%2F%3E%0A%3Cpath%20d%3D%22M6.71429%2012.2852L14%204.9995L12.7143%203.71436L6.71429%209.71378L3.28571%206.2831L2%207.57092L6.71429%2012.2852Z%22%20fill%3D%22white%22%2F%3E%0A%3C%2Fsvg%3E");
}

.checkbox-off {
	background-image: url("data:image/svg+xml;charset=UTF-8,%3Csvg%20width%3D%2216%22%20height%3D%2216%22%20viewBox%3D%220%200%2016%2016%22%20fill%3D%22none%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%0A%3Crect%20x%3D%220.75%22%20y%3D%220.75%22%20width%3D%2214.5%22%20height%3D%2214.5%22%20fill%3D%22white%22%20stroke%3D%22%2336352F%22%20stroke-width%3D%221.5%22%2F%3E%0A%3C%2Fsvg%3E");
}
	
</style></head><body><article id="2415b2cc-075b-8076-9ad6-ee74aa2e4642" class="page sans"><header><div class="page-header-icon undefined"><img class="icon" src="https://tryhackme-images.s3.amazonaws.com/room-icons/9b79084a1041cc0acf8c736bb32a1543.png"/></div><h1 class="page-title"><strong>Malware Analysis - Intro</strong></h1><p class="page-description"></p></header><div class="page-body"><p id="2415b2cc-075b-80a2-9830-f55cb5f96520" class="">
</p><p id="2415b2cc-075b-8000-8ff3-f2aa6f9987b4" class="">Every once in a while, when you are working as a SOC analyst, you will come across content (a file or traffic) that seems suspicious, and you will have to decide whether that content is malicious or not. It is normal to feel confused with all the mixed signals that such content provides. This becomes a little overwhelming for somebody who is just starting in Cybersecurity, and it is common to begin self-guessing oneself. Knowing what steps to take to resolve such a scenario is helpful. This room will lay down some steps to help you make the initial conclusion about a particular suspicious file.</p><p id="2415b2cc-075b-804f-acf6-f8c14c5b7ac6" class="">Notably here, you will learn:</p><ul id="2415b2cc-075b-8078-b804-c1bc749be603" class="bulleted-list"><li style="list-style-type:disc">What is malware?</li></ul><ul id="2415b2cc-075b-80c5-85d6-ef00bc3eb77e" class="bulleted-list"><li style="list-style-type:disc">How to start analyzing a malware</li></ul><ul id="2415b2cc-075b-8093-a954-d6b1b712a258" class="bulleted-list"><li style="list-style-type:disc">Static and Dynamic malware analysis</li></ul><ul id="2415b2cc-075b-8031-bab0-fa80a710ae59" class="bulleted-list"><li style="list-style-type:disc">Resources to help you analyze malware</li></ul><h2 id="2415b2cc-075b-801c-9c0a-c1c16d66d5f7" class=""><strong>Malware</strong></h2><p id="2415b2cc-075b-808b-b243-f267828d7b96" class="">The word malware is derived from the term MALicious softWARE. Therefore, any software that has a malicious purpose can be considered malware. Malware is further classified into different categories based on its behavior. However, we will not go into the details of those in this room. Here we will ponder the steps we will take if we suspect that we found malware in a machine. So, let&#x27;s get started.</p><h2 id="2415b2cc-075b-80f8-a8eb-fbafc62a8370" class=""><strong>The purpose behind Malware Analysis</strong></h2><p id="2415b2cc-075b-80de-b072-ff9443b24528" class="">Malware Analysis is an important skill to have. As a quick overview, Malware Analysis is performed by the following people in the Security Industry:</p><ul id="2415b2cc-075b-8047-a166-e50741fa81ad" class="bulleted-list"><li style="list-style-type:disc"><strong>Security Operations</strong> teams analyze malware to write detections for malicious activity in their networks.</li></ul><ul id="2415b2cc-075b-806d-bd3d-efbc14042bee" class="bulleted-list"><li style="list-style-type:disc"><strong>Incident Response</strong> teams analyze malware to determine what damage has been done to an environment to remediate and revert that damage.</li></ul><ul id="2415b2cc-075b-80bb-a030-c760b91f72bb" class="bulleted-list"><li style="list-style-type:disc"><strong>Threat Hunt</strong> teams analyze malware to identify IOCs, which they use to hunt for malware in a network.</li></ul><ul id="2415b2cc-075b-805b-834e-f0d7ed4b0dd5" class="bulleted-list"><li style="list-style-type:disc"><strong>Malware Researchers</strong> in security product vendor teams analyze malware to add detections for them in their security products.</li></ul><ul id="2415b2cc-075b-80b2-9140-fbb7451a1eb1" class="bulleted-list"><li style="list-style-type:disc"><strong>Threat Research</strong> teams in OS Vendors like Microsoft and Google analyze malware to discover the vulnerabilities exploited and add more security features to the OS/applications.</li></ul><p id="2415b2cc-075b-8007-a34b-cab86a3f3cec" class="">Overall, it seems like many different people do malware Analysis for many compelling reasons. So let&#x27;s see how to start!</p><h2 id="2415b2cc-075b-80bb-ac95-c43329c6ba59" class=""><strong>Before we begin!</strong></h2><figure id="2415b2cc-075b-80ee-a5f9-ef1576bb111e" class="image"><a href="https://tryhackme-images.s3.amazonaws.com/user-uploads/61306d87a330ed00419e22e7/room-content/07dbfda63ff296b6732c4533145d4eb8.png"><img src="https://tryhackme-images.s3.amazonaws.com/user-uploads/61306d87a330ed00419e22e7/room-content/07dbfda63ff296b6732c4533145d4eb8.png"/></a></figure><p id="2415b2cc-075b-80e2-aeab-e7ae1e835bc6" class="">Please note that malware is like a weapon because it can produce great harm if not handled with care. For this reason, always take the following precautions while analyzing malware:</p><ul id="2415b2cc-075b-8037-932b-dc60cc18334c" class="bulleted-list"><li style="list-style-type:disc">Never analyze malware or suspected malware on a machine that does not have the sole purpose of analyzing malware.</li></ul><ul id="2415b2cc-075b-80db-9d34-f7d0f0cff6e3" class="bulleted-list"><li style="list-style-type:disc">When not analyzing or moving malware samples around to different locations, always keep them in password-protected zip/rar or other archives so that we can avoid accidental detonation.</li></ul><ul id="2415b2cc-075b-80b4-8706-dc53e53c1a0f" class="bulleted-list"><li style="list-style-type:disc">Only extract the malware from this password-protected archive inside the isolated environment, and only when analyzing it.</li></ul><ul id="2415b2cc-075b-808b-a592-ca89062e9c6b" class="bulleted-list"><li style="list-style-type:disc">Create an isolated VM specifically for malware analysis, which has the capability of being reverted to a clean slate once you are done.</li></ul><ul id="2415b2cc-075b-806b-acdf-f405b6d59186" class="bulleted-list"><li style="list-style-type:disc">Ensure that all internet connections are closed or at least monitored.</li></ul><ul id="2415b2cc-075b-807c-851b-e14b0950825f" class="bulleted-list"><li style="list-style-type:disc">Once you are done with malware analysis, revert the VM to its clean slate for the next malware analysis session to avoid residue from a previous malware execution corrupting the next one.</li></ul><p id="2415b2cc-075b-809a-bc4c-db94878b2199" class="">
</p><h2 id="2415b2cc-075b-805c-9c6f-e996da06d165" class="">Techniques of malware analysis</h2><hr id="2415b2cc-075b-8096-b5fc-cdcc701696d6"/><h2 id="2415b2cc-075b-808f-a0c1-db5308ad6948" class="">🧩 <strong>Malware Analysis Overview</strong></h2><p id="2415b2cc-075b-8021-a9a6-df0e4fbe7912" class="">Malware analysis is like solving a puzzle—each tool or technique reveals a piece of what the malware is doing. The most commonly analyzed files are:</p><ul id="2415b2cc-075b-80b4-9559-f7269db0c659" class="bulleted-list"><li style="list-style-type:disc"><strong>PE (Portable Executable)</strong> files (e.g., <code>.exe</code>)</li></ul><ul id="2415b2cc-075b-80f1-ae94-dfbb11f6522a" class="bulleted-list"><li style="list-style-type:disc"><strong>Malicious documents</strong> (e.g., macro-enabled Office files)</li></ul><ul id="2415b2cc-075b-8080-aa78-d7e27134d7e8" class="bulleted-list"><li style="list-style-type:disc"><strong>Network captures (Pcap files)</strong></li></ul><hr id="2415b2cc-075b-805f-a6a9-e9dc53cae442"/><h2 id="2415b2cc-075b-80d7-a4ea-c1ca5f142636" class="">🧪 <strong>Types of Malware Analysis</strong></h2><h3 id="2415b2cc-075b-8020-bcfc-db336396ce4a" class="">🔍 1. <strong>Static Analysis</strong></h3><blockquote id="2415b2cc-075b-802a-b77e-f7cb18629eb2" class="">Analyzing the malware without running it.</blockquote><p id="2415b2cc-075b-8005-8110-d1400a546dfb" class=""><strong>Purpose</strong>: To extract clues from the file’s structure, metadata, and content without execution.</p><p id="2415b2cc-075b-8072-85bb-d1aac98883a2" class=""><strong>Techniques include</strong>:</p><ul id="2415b2cc-075b-805b-929d-d463f01ed5be" class="bulleted-list"><li style="list-style-type:disc">Viewing <strong>embedded strings</strong> (e.g., using <code>strings</code>)</li></ul><ul id="2415b2cc-075b-80c0-9c8d-c2aff1b3f6ce" class="bulleted-list"><li style="list-style-type:disc">Analyzing <strong>PE headers</strong> and file structure</li></ul><ul id="2415b2cc-075b-8021-9cfb-d94554e19172" class="bulleted-list"><li style="list-style-type:disc">Using <strong>disassemblers</strong> (e.g., IDA, Ghidra)</li></ul><ul id="2415b2cc-075b-80c3-8817-d3390a092713" class="bulleted-list"><li style="list-style-type:disc">Reviewing <strong>imported libraries</strong> and <strong>function calls</strong></li></ul><ul id="2415b2cc-075b-80cf-87a8-eaf36f9562bf" class="bulleted-list"><li style="list-style-type:disc"><strong>Checking for digital signatures</strong> or compile-time artifacts</li></ul><p id="2415b2cc-075b-8046-b2e0-ddfafc0acc34" class=""><strong>Challenges</strong>:</p><ul id="2415b2cc-075b-80bd-b423-cbe1f3a751df" class="bulleted-list"><li style="list-style-type:disc">Malware may be <strong>obfuscated</strong>, <strong>packed</strong>, or <strong>encrypted</strong></li></ul><ul id="2415b2cc-075b-8069-9a23-ebcaf1246569" class="bulleted-list"><li style="list-style-type:disc">Code might be <strong>stripped</strong> or designed to break analysis tools</li></ul><hr id="2415b2cc-075b-8094-acfb-d959311fc459"/><h3 id="2415b2cc-075b-803c-a92b-fe0dca2e9122" class="">⚙️ 2. <strong>Dynamic Analysis</strong></h3><blockquote id="2415b2cc-075b-8073-a1bf-c89fec21c07f" class="">Observing malware behavior by running it in a controlled environment.</blockquote><p id="2415b2cc-075b-804f-8acf-d8df777c7ee8" class=""><strong>Purpose</strong>: To see what the malware does during execution.</p><p id="2415b2cc-075b-80a3-9559-ec78875fade3" class=""><strong>Techniques include</strong>:</p><ul id="2415b2cc-075b-8040-9c5d-c55ddcea74b8" class="bulleted-list"><li style="list-style-type:disc">Running in a <strong>VM/sandbox</strong></li></ul><ul id="2415b2cc-075b-80cb-8d4c-ce1b9fd963eb" class="bulleted-list"><li style="list-style-type:disc">Monitoring <strong>file system changes</strong>, <strong>registry</strong>, <strong>processes</strong>, <strong>network activity</strong></li></ul><ul id="2415b2cc-075b-803a-8945-c9feb2d8d97f" class="bulleted-list"><li style="list-style-type:disc">Tools like:<ul id="2415b2cc-075b-8029-ab02-d227f86d7a12" class="bulleted-list"><li style="list-style-type:circle"><code>Procmon</code>, <code>Wireshark</code>, <code>Regshot</code>, <code>Process Explorer</code></li></ul><ul id="2415b2cc-075b-80f5-8013-c59aa546ece0" class="bulleted-list"><li style="list-style-type:circle">Automated sandboxes: <strong>Cuckoo</strong>, <strong>Any.Run</strong>, <strong>Hybrid Analysis</strong></li></ul></li></ul><p id="2415b2cc-075b-80b6-8829-c6c8e6e5a96e" class=""><strong>Benefits</strong>:</p><ul id="2415b2cc-075b-8095-a398-f9c782a31788" class="bulleted-list"><li style="list-style-type:disc">Reveals <strong>actual behavior</strong> (e.g., C2 communication, payload download, privilege escalation)</li></ul><ul id="2415b2cc-075b-8027-8b37-fea067a799bd" class="bulleted-list"><li style="list-style-type:disc">Can observe <strong>persistence mechanisms</strong>, <strong>encryption routines</strong>, etc.</li></ul><p id="2415b2cc-075b-80ae-bcf7-cbb8139cbdbf" class=""><strong>Challenges</strong>:</p><ul id="2415b2cc-075b-80de-8847-e3594f0dd40b" class="bulleted-list"><li style="list-style-type:disc">Malware can detect VMs/sandboxes and <strong>alter behavior</strong></li></ul><ul id="2415b2cc-075b-80e1-b48f-c1b6ba66c15b" class="bulleted-list"><li style="list-style-type:disc">Some malware includes <strong>time delays</strong>, <strong>user interaction checks</strong>, or <strong>environment checks</strong> to evade detection</li></ul><hr id="2415b2cc-075b-8037-a20e-c57dd2b2411c"/><h2 id="2415b2cc-075b-8020-b077-fe011e98c569" class="">🧠 <strong>Advanced Malware Analysis (Not covered in this module)</strong></h2><p id="2415b2cc-075b-80ac-b929-d5233979cc7f" class="">Used when basic static/dynamic methods are insufficient.</p><h3 id="2415b2cc-075b-8026-9980-e9bd12a12813" class="">Tools:</h3><ul id="2415b2cc-075b-80e7-8efd-e044eed579a8" class="bulleted-list"><li style="list-style-type:disc"><strong>Disassemblers</strong> (e.g., IDA, Ghidra): Convert binary → assembly for in-depth code reading</li></ul><ul id="2415b2cc-075b-8025-bd8a-eb31b38e9e01" class="bulleted-list"><li style="list-style-type:disc"><strong>Debuggers</strong> (e.g., x64dbg, OllyDbg, WinDbg): Allow real-time step-through of execution</li></ul><p id="2415b2cc-075b-8065-86c6-f247ca02be72" class=""><strong>Use Cases</strong>:</p><ul id="2415b2cc-075b-804f-9dce-f5d4b2d4a6ad" class="bulleted-list"><li style="list-style-type:disc">Analyzing <strong>packed/encrypted code</strong></li></ul><ul id="2415b2cc-075b-8025-b912-d952b2454ca7" class="bulleted-list"><li style="list-style-type:disc">Understanding <strong>control flow</strong>, <strong>keygen routines</strong>, or <strong>anti-analysis logic</strong></li></ul><ul id="2415b2cc-075b-8018-a362-d58415c86843" class="bulleted-list"><li style="list-style-type:disc">Viewing <strong>runtime memory content</strong></li></ul><hr id="2415b2cc-075b-80c6-876e-ee28fbcc293b"/><h2 id="2415b2cc-075b-8070-93ca-c78485061747" class="">🔐 <strong>Key Insight</strong></h2><p id="2415b2cc-075b-80cb-954e-d20501fcfc58" class="">Malware must eventually <strong>execute</strong> to be effective. No matter how well it&#x27;s hidden statically, its actions during execution are observable—this is the analyst’s advantage when using dynamic and advanced techniques.</p><hr id="2415b2cc-075b-80e7-a520-faa01013755f"/><p id="2415b2cc-075b-8019-91b4-f302ba1f518d" class="">
</p><h2 id="2415b2cc-075b-8013-aabb-e045218c237c" class="">Basic Static Analysis</h2><p id="2415b2cc-075b-8058-a506-d3ce5c394f8d" class=""><a href="https://docs.remnux.org/">https://docs.remnux.org/</a></p><p id="2415b2cc-075b-80b9-a03b-d5717ecf1679" class="">When analyzing a new piece of malware, the first step is usually performing basic static analysis. Basic static analysis can be considered sizing up the malware, trying to find its properties before diving deep into analysis. It provides us with an overview of what we are dealing with. Sometimes it might give us some critical information, for example, what API calls the malware is making or whether it&#x27;s packed or not. However, other times, it might only give us information to help us size the malware up and give us an idea of the effort required to analyze it.</p><p id="2415b2cc-075b-806f-880f-e428ea04df8b" class="">So without further ado, let&#x27;s see some of the techniques we can use to perform basic static analysis.</p><h2 id="2415b2cc-075b-80ac-af03-e557f317858c" class=""><strong>Caution!</strong></h2><p id="2415b2cc-075b-80c9-9e94-ffa65c89d250" class="">Although static analysis is performed without running the malware, it is highly recommended that you perform malware analysis in an isolated Virtual Machine. You can create a clean snapshot of your Virtual Machine before performing any malware analysis and revert it to start from a clean state again after every analysis. Don&#x27;t perform malware analysis on a live machine not purpose-built for malware analysis. For this room, we will be using the attached <a href="https://docs.remnux.org/">Remnux VM</a>. Remnux (<strong>R</strong>everse <strong>E</strong>ngineering <strong>M</strong>alware Li<strong>nux</strong>) is a Linux distribution purpose-built for malware analysis. It has many tools required for malware analysis already installed on it.</p><h2 id="2415b2cc-075b-8000-9891-c9353ea0dfab" class=""><strong>Examining the file type</strong></h2><p id="2415b2cc-075b-80b2-97b7-de008c12f4f3" class="">Though often the file type of malware is visible in the file extension and is obvious, sometimes malware authors try to trick users by using misleading file extensions. In such scenarios, it is helpful to know how to find the actual file type of a file without depending on file extensions. In Linux, we can find the file type of a file using the <code>file</code> command. To understand what the file command does, we can read its <code>man page</code> or use the <code>--help</code> option:</p><p id="2415b2cc-075b-8047-a984-caa175f7faa0" class=""><code>man file</code> or <code>file --help</code></p><p id="2415b2cc-075b-8060-be1d-fda91435e523" class="">We will find out that it is a simple command to use. We can use the following command to find the file type of a file:</p><p id="2415b2cc-075b-80e8-91f1-c5c4cb965c66" class=""><code>file &lt;filename&gt;</code></p><p id="2415b2cc-075b-8049-a698-e77118353fe9" class="">Remnux</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="2415b2cc-075b-8009-85db-de550c72d0c7" class="code code-wrap"><code class="language-Markup" style="white-space:pre-wrap;word-break:break-all">user@machine$ file wannacry
wannacry: PE32 executable (GUI) Intel 80386, for MS Windows
user@machine$</code></pre><p id="2415b2cc-075b-8039-af86-d8882c058226" class="">There is a folder named <code>Samples</code> on the Desktop in the attached VM. We will be using the samples present in that folder for our analysis. The above terminal shows the <code>file</code> command being run on the &#x27;wannacry&#x27; sample. The output shows a PE32 executable file with a Graphical User Interface, which was compiled for a system that runs Microsoft Windows with an Intel 80386-based processor. The Intel 80386 processor was one of the first 32-bit processors ever, and the instruction set designed for the 80386 is still used for 32-bit Intel processors, which is why you see &quot;x86&quot; processors and code. This means that the &quot;80386&quot; in the output above tells us that this application was designed for 32-bit Intel processors.</p><h2 id="2415b2cc-075b-80e8-88c5-f74316244b8d" class=""><strong>Examining Strings</strong></h2><p id="2415b2cc-075b-800c-9cac-cf652ba24d55" class="">Another really important command that provides us with useful information about a file is the <code>strings</code> command. This command lists down the strings present in a file. To understand what the string command does, we can read its <code>man page</code> or use the <code>--help</code> option:</p><p id="2415b2cc-075b-8033-8f89-edbade49781b" class=""><code>man strings</code> or <code>strings --help</code></p><p id="2415b2cc-075b-8088-b3ed-f7f987c4eb34" class="">We will find that it is also a simple command to use. We can use the following command to find the strings in a file:</p><p id="2415b2cc-075b-802e-a9b6-fca4c7ad9827" class=""><code>strings &lt;filename&gt;</code></p><p id="2415b2cc-075b-8090-96b4-cda5647fef85" class="">Looking at strings in a file can often give clues related to the behavior of malware. For example, if we see URLDownloadToFile in the output of the strings command, we will know that this malware is doing something with the URLDownloadToFile Windows API. Most likely, it is downloading a file from the internet and saving it on the disk. Similarly, strings might also provide contextual information that helps us later during malware analysis.</p><p id="2415b2cc-075b-8071-bd85-d3e2e8021c5d" class="">Remnux</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="2415b2cc-075b-8099-92ca-ed3e56cd71a5" class="code code-wrap"><code class="language-Markup" style="white-space:pre-wrap;word-break:break-all">user@machine$ strings wannacry
!This program cannot be run in DOS mode.
Rich
.text
`.rdata
@.data
.rsrc
49t$
TVWj
PVVh
tE9u
.
.
.
.
 inflate 1.1.3 Copyright 1995-1998 Mark Adler
 n;^
Qkkbal
i]Wb
9a&amp;g
MGiI
wn&gt;Jj
#.zf
+o*7
- unzip 0.15 Copyright 1998 Gilles Vollant
CloseHandle
GetExitCodeProcess
TerminateProcess
WaitForSingleObject
CreateProcessA
GlobalFree
GetProcAddress
LoadLibraryA
GlobalAlloc
SetCurrentDirectoryA
GetCurrentDirectoryA
GetComputerNameW
SetFileTime
SetFilePointer
MultiByteToWideChar
GetFileAttributesW
GetFileSizeEx
.
.
.
.
user@machine$</code></pre><p id="2415b2cc-075b-8023-b67c-f6aea0668434" class="">Here we can see the <code>strings</code> command being run against the &#x27;wannacry&#x27; sample. We will see that the output starts with the <code>DOS Stub</code>, which is the text that says <code>!This program cannot be run in DOS mode</code>. Some values don&#x27;t make much sense and look like garbage, but you will also see useful output. For example, we can see above that some strings look like Windows APIs. For example, <code>CloseHandle</code>, <code>GetExitCodeProcess</code>, <code>TerminateProcess</code>, and so on. Similarly, we can see text that says <code>inflate 1.1.3 Copyright 1995-1998 Mark Adler</code>. A quick search shows that it is a part of the <a href="http://zlib.net/">zlib data compression </a>library, this tells us that the sample might be using this library.</p><p id="2415b2cc-075b-80e6-9417-c3c41cd6e1f4" class=""><strong>Tip:</strong> Sometimes, the output of the strings command is too big to be shown on the terminal completely. We can redirect it, write it to a file, and read it using vim or any other tool. The below terminal shows the output being redirected to a file named str:</p><p id="2415b2cc-075b-80bb-bd4c-d93106c7bf6f" class="">Remnux</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="2415b2cc-075b-801c-9bf2-e738d07d89a9" class="code code-wrap"><code class="language-Markup" style="white-space:pre-wrap;word-break:break-all">user@machine$ strings wannacry&gt;str
user@machine$</code></pre><p id="2415b2cc-075b-805e-98af-e24202d8383e" class="">Alternatively, you can use the <code>more</code> or <code>less</code> command to parse the output in a more visible manner:</p><p id="2415b2cc-075b-80e9-ba97-d34b8e475c81" class="">Remnux</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="2415b2cc-075b-80a6-927c-e4a5fd109f54" class="code code-wrap"><code class="language-Markup" style="white-space:pre-wrap;word-break:break-all">user@machine$ strings wannacry |more
!This program cannot be run in DOS mode.
Rich
.text
`.rdata
@.data
.rsrc
49t$
TVWj
PVVh
tE9u
PVVW
SVWjcf
X_^[
X_^[
^t19
QPPh
tXVP
X_^]
^t)9
X_^[]
WWWWWPj
SjJ3
X[_^
Yu#j
uSh8
Yu8S
SSh
hn!@
SVWj@
--more--</code></pre><p id="2415b2cc-075b-80be-af92-d533ae29cc72" class="">We can use the space key to scroll down the list of strings here. If you are interested, <a href="https://tryhackme.com/room/malstrings">this room</a> contains more information about strings.</p><h2 id="2415b2cc-075b-80df-bdb8-e12815333674" class=""><strong>Calculating Hashes</strong></h2><p id="2415b2cc-075b-80aa-b855-e398e99922b9" class="">File Hashing provides us with a fixed-size unique number that identifies a file. A File Hash can therefore be considered a unique identifier for a file, similar to Social Security Numbers or National Identification Numbers used for the citizens of a country. Hashing is an important concept in malware analysis. It can be used as an identifier for specific malware. As we will see later in this task, this identifier can then be shared with other analysts or searched online for information sharing purposes. Please note that a single bit of difference in two files will result in different hashes, so changing the hash of a file is as simple as changing one bit in it.</p><p id="2415b2cc-075b-8002-a3d1-e519b96a7d0e" class="">Commonly, <code>md5sum</code>, <code>sha1sum</code> and <code>sha256sum</code> hashes are used for file hashing. We can calculate file hashes by using a simple command in Linux, as shown below for the md5sum hash:</p><p id="2415b2cc-075b-802c-aa82-c0d1c962d0ad" class=""><code>md5sum &lt;filename&gt;</code></p><p id="2415b2cc-075b-80ec-9d7f-c76d991e3ac3" class="">Remnux</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="2415b2cc-075b-803e-b973-cb2cf26a1419" class="code code-wrap"><code class="language-Plain Text" style="white-space:pre-wrap;word-break:break-all">user@machine$ md5sum wannacry
84c82835a5d21bbcf75a61706d8ab549  wannacry
user@machine$</code></pre><p id="2415b2cc-075b-8079-95fe-e90ab9813d67" class="">Above, we can see the md5sum hash is calculated for the file named &#x27;wannacry.&#x27;</p><p id="2415b2cc-075b-80f0-8045-c9f1ea56462c" class="">Similarly, <code>sha1sum</code> and <code>sha256sum</code> commands can be used for calculating <code>sha1sum</code> or <code>sha256sum</code> of a file (Hashes are often referred to without the `sum` at the end, e.g. <code>md5</code> instead of <code>md5sum</code> and so on.)</p><p id="2415b2cc-075b-8080-b93d-ebe87c2f2350" class="">If you are interested in learning more about hashes, you can check out <a href="https://tryhackme.com/room/malresearching">this room</a>.</p><h2 id="2415b2cc-075b-80a8-ad1a-c864fdff6973" class=""><strong>AV scans and VirusTotal</strong></h2><p id="2415b2cc-075b-80da-a88d-d812b1631cc9" class="">Scanning a file using AVs or searching for a hash on <a href="https://www.virustotal.com/gui/home/upload">VirusTotal</a> can also provide useful information about the classification of malware performed by security researchers. However, when using an online scanner, it is recommended to search for the malware&#x27;s hash instead of uploading online to avoid leaking sensitive information online. Only upload a sample if you are sure of what you are doing.</p><p id="2415b2cc-075b-80e4-8084-c4819f6e1fee" class="">
</p><h2 id="2415b2cc-075b-80df-9c23-ebfcbda90c3c" class="">The PE file Header</h2><h2 id="2415b2cc-075b-80ec-9d3d-e7c24b4c16a6" class=""><strong>PE Header</strong></h2><figure id="2415b2cc-075b-8053-a62b-f90163b83112" class="image"><a href="https://tryhackme-images.s3.amazonaws.com/user-uploads/61306d87a330ed00419e22e7/room-content/180bb73415dd511f9399ce6cfff9db9a.png"><img src="https://tryhackme-images.s3.amazonaws.com/user-uploads/61306d87a330ed00419e22e7/room-content/180bb73415dd511f9399ce6cfff9db9a.png"/></a></figure><p id="2415b2cc-075b-807a-a855-c31f9474629a" class="">The PE File Header contains the metadata about a Portable Executable file. This data can help us find a lot of helpful information to help us in our analysis. We will go into detail about the PE header and the information it contains in the upcoming Malware Analysis module for the advanced path. However, some of the vital information found in the PE header is explained below:</p><h3 id="2415b2cc-075b-802f-9fc4-cdc75a17670e" class=""><strong>Imports/Exports</strong></h3><p id="2415b2cc-075b-809f-b33c-cb84e4275261" class="">A PE file seldom contains all the code that it needs to run on a system on its own. Most of the time, it re-uses code provided by the Operating System. This is done to use less space and leverage the framework the Operating System has laid to perform tasks instead of re-inventing the wheel. Imports are such functions that the PE file imports from outside to perform different tasks.</p><p id="2415b2cc-075b-8059-95b5-fd66525e67c0" class="">For example, if a developer wants to Query a Windows Registry value, they will import the <a href="https://docs.microsoft.com/en-us/windows/win32/api/winreg/nf-winreg-regqueryvaluew">RegQueryValue</a> function provided by Microsoft instead of writing the code themselves. It is understood that this function will be present on any Windows machine on which the developer&#x27;s code is going to run, so it does not need to be included in the PE file itself. Similarly, any PE file export functions are exposed to other binaries that can use that function instead of implementing it themselves. Exports are generally associated with Dynamically-Linked libraries (DLL files), and it is not typical for a non-DLL PE file to have a lot of exports.</p><p id="2415b2cc-075b-80c8-befa-df4ecfd68d50" class="">Since most PE files use the Windows API to perform the bulk of their jobs, a PE file&#x27;s imports provide us with crucial information on what that PE file will do. It becomes evident that a PE file that is importing the InternetOpen function will communicate with the internet, a URLDownloadToFile function shows that a PE file will download something from the internet, and so on. Names of Windows APIs are generally intuitive and self-explanatory. However, we can always consult <a href="https://docs.microsoft.com/en-us/windows/win32/api/_winprog/">Microsoft Documentation</a> to verify the purpose of a particular Windows function.</p><h3 id="2415b2cc-075b-8043-a10e-ebd462d2251b" class=""><strong>Sections:</strong></h3><p id="2415b2cc-075b-8045-9616-e2a74d2992e1" class="">Another useful piece of information available in the PE file header is the information about sections in the PE file. A PE file is divided into different sections which have different purposes. Although the sections in a PE file depend on the compiler or packer used to compile or pack the binary, the following are the most commonly seen sections in a PE file.</p><ul id="2415b2cc-075b-80ed-aa42-dc0b7222c1cf" class="bulleted-list"><li style="list-style-type:disc">.<strong>text: </strong>This Section generally contains the CPU instructions executed when the PE file is run. This section is marked as executable.</li></ul><ul id="2415b2cc-075b-80a1-9458-e891af9611cc" class="bulleted-list"><li style="list-style-type:disc"><strong>.data: </strong>This Section contains the global variables and other global data used by the PE file.</li></ul><ul id="2415b2cc-075b-807f-8871-e20475bd82f2" class="bulleted-list"><li style="list-style-type:disc"><strong>.rsrc: </strong>This Section contains resources that are used by the PE file, for example, images, icons, etc.</li></ul><h2 id="2415b2cc-075b-800f-9931-ed13f627eb44" class=""><strong>Analyzing PE header using pecheck utility</strong></h2><p id="2415b2cc-075b-80bc-9e40-c8258e561c3f" class="">We can use the pecheck utility present in the Remnux VM attached with the room to check the PE header.</p><p id="2415b2cc-075b-8020-8c94-c394dc50e2cf" class="">Remnux</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="2415b2cc-075b-803b-b362-e822d46512be" class="code code-wrap"><code class="language-Shell" style="white-space:pre-wrap;word-break:break-all">user@machine$ pecheck wannacry PE check for &#x27;wannacry&#x27;:
Entropy: 7.995471 (Min=0.0, Max=8.0)
MD5     hash: 84c82835a5d21bbcf75a61706d8ab549
SHA-1   hash: 5ff465afaabcbf0150d1a3ab2c2e74f3a4426467
SHA-256 hash: ed01ebfbc9eb5bbea545af4d01bf5f1071661840480439c6e5babe8e080e41aa
SHA-512 hash: 90723a50c20ba3643d625595fd6be8dcf88d70ff7f4b4719a88f055d5b3149a4231018ea30d375171507a147e59f73478c0c27948590794554d031e7d54b7244
.text entropy: 6.404235 (Min=0.0, Max=8.0)
.rdata entropy: 6.663571 (Min=0.0, Max=8.0)
.data entropy: 4.455750 (Min=0.0, Max=8.0)
.rsrc entropy: 7.999868 (Min=0.0, Max=8.0)
Dump Info:
----------DOS_HEADER----------

[IMAGE_DOS_HEADER]
0x0        0x0   e_magic:                       0x5A4D
0x2        0x2   e_cblp:                        0x90
0x4        0x4   e_cp:                          0x3
.
.
.
.
.
[IMAGE_IMPORT_DESCRIPTOR]
0xD5D0     0x0   OriginalFirstThunk:            0xD60C
0xD5D0     0x0   Characteristics:               0xD60C
0xD5D4     0x4   TimeDateStamp:                 0x0        [Thu Jan  1 00:00:00 1970 UTC]
0xD5D8     0x8   ForwarderChain:                0x0
0xD5DC     0xC   Name:                          0xDC84
0xD5E0     0x10  FirstThunk:                    0x8000

ADVAPI32.dll.CreateServiceA Hint[100]
ADVAPI32.dll.OpenServiceA Hint[431]
ADVAPI32.dll.StartServiceA Hint[585]
ADVAPI32.dll.CloseServiceHandle Hint[62]
ADVAPI32.dll.CryptReleaseContext Hint[160]
ADVAPI32.dll.RegCreateKeyW Hint[467]
ADVAPI32.dll.RegSetValueExA Hint[516]
ADVAPI32.dll.RegQueryValueExA Hint[503]
ADVAPI32.dll.RegCloseKey Hint[459]
ADVAPI32.dll.OpenSCManagerA Hint[429]
.
.
.
.
.
.</code></pre><p id="2415b2cc-075b-8073-9fb3-f7f7db3bb2f7" class="">Here we can see information pecheck has extracted from the PE header of the wannacry sample. We see that the sample has 4 sections, .text, .rdata, .data and .rsrc and their respective entropy. Similarly, it has also shown us the different hashes of the sample. Pecheck also shows us the functions that a PE file imports. In the above terminal window, we can see the IMAGE_IMPORT_DESCRIPTOR, which shows the functions it imports from the ADVAPI32.dll Linked library. We will see similar descriptors for all the other linked libraries whose functions are imported by the sample.</p><p id="2415b2cc-075b-8086-9e29-c7217230724a" class="">We can see that pecheck shows us a lot more information than what we discussed in this task; however, discussing all that information is out of the scope of this room. We will dive into further details in the upcoming malware analysis module. We will take what we are looking for from the information we see, namely, the section information and the imports of our</p><p id="2415b2cc-075b-8041-8f49-dcde4c187c18" class="">
</p><h3 id="2415b2cc-075b-8063-b88e-fb76e2b585db" class="">Questions</h3><ul id="2415b2cc-075b-803c-b790-feee65a5abcd" class="bulleted-list"><li style="list-style-type:disc">In the attached VM, there is a sample named &#x27;redline&#x27; in the directory Desktop/Samples. What is the entropy of the .text section of this sample?</li></ul><figure id="2415b2cc-075b-809b-a13b-c0606bceecd0" class="image"><a href="assets/7C14011D-A625-4A2A-B964-C3FF175DFC92.png"><img style="width:685.9219970703125px" src="assets/7C14011D-A625-4A2A-B964-C3FF175DFC92.png"/></a></figure><ul id="2415b2cc-075b-802e-974c-f861c553968f" class="bulleted-list"><li style="list-style-type:disc">The sample named &#x27;redline&#x27; has five sections. .text, .rdata, .data and .rsrc are four of them. What is the name of the fifth section?</li></ul><p id="2415b2cc-075b-804c-9bc9-dff3dd6a4528" class=""><code> .ndata</code></p><ul id="2415b2cc-075b-8047-8e87-f9e8dd05ac56" class="bulleted-list"><li style="list-style-type:disc">From which dll file does the sample named &#x27;redline&#x27; import the RegOpenKeyExW function?</li></ul><figure id="2415b2cc-075b-80ff-a99c-ec9a12f08337" class="image"><a href="assets/82588451-0505-46A9-8954-C78B8A6FCA6C.png"><img style="width:685.986328125px" src="assets/82588451-0505-46A9-8954-C78B8A6FCA6C.png"/></a></figure><p id="2415b2cc-075b-80f5-98ef-d52bbc728df7" class="">Check out the GUI-based Petree tool and see what information it shows. You can use the following command for using the pe-tree tool to analyze the &#x27;redline&#x27; malware. (The pe-tree tool might take some time to initiate.)</p><p id="2415b2cc-075b-8088-a627-d5a9665ad9dd" class=""><code>pe-tree redline</code></p><figure id="2415b2cc-075b-80bc-a75a-f722b4090afc" class="image"><a href="assets/1E94FEA3-8A65-4047-B434-DA8F3196596A.png"><img style="width:685.9734497070312px" src="assets/1E94FEA3-8A65-4047-B434-DA8F3196596A.png"/></a></figure><p id="2415b2cc-075b-8091-9a39-e85667811504" class="">
</p><h2 id="2415b2cc-075b-806f-ad93-fef1354e6c8a" class="">Basic Dynamic Analysis</h2><p id="2415b2cc-075b-8003-90ea-ec907cbad503" class="">While basic static analysis provides us with useful information about a sample, most times, we need to perform additional analysis to move further in our analysis procedure. One quick and dirty way to find more clues about a malware&#x27;s behavior is by performing basic dynamic analysis. Many of the properties of a malware sample can be hidden when it&#x27;s not running. However, when we perform dynamic analysis, we can lay these properties bare and learn more about the behavior of a malware sample.</p><h2 id="2415b2cc-075b-80f5-b6f9-e0a339a338e9" class=""><strong>Caution!</strong></h2><p id="2415b2cc-075b-80c7-ba9d-f6f64d50eeed" class="">Dynamic analysis requires running live malware samples that can be destructive. It is highly recommended that you perform malware analysis in an isolated Virtual Machine. You can create a clean snapshot of your Virtual Machine before performing any malware analysis and revert it to start from a clean state again after every analysis. Don&#x27;t perform malware analysis on a live machine not purpose-built for malware analysis.</p><h2 id="2415b2cc-075b-80a0-bb0e-e8a95abb6fc3" class=""><strong>Introduction to Sandboxes</strong></h2><figure id="2415b2cc-075b-8092-9b01-cf39ea2ef819" class="image"><a href="https://tryhackme-images.s3.amazonaws.com/user-uploads/61306d87a330ed00419e22e7/room-content/7c03de48312f00f8a4fa904f9666668e.png"><img src="https://tryhackme-images.s3.amazonaws.com/user-uploads/61306d87a330ed00419e22e7/room-content/7c03de48312f00f8a4fa904f9666668e.png"/></a></figure><p id="2415b2cc-075b-80a7-8b0d-c5ce00d389d1" class="">Sandbox is a term borrowed from the military. A sandbox is a box of sand, as the name suggests, modeling the terrain where an operation has to take place, in which a military team dry runs their scenarios to identify possible outcomes. In malware analysis, a sandbox is an isolated environment mimicking the actual target environment of a malware, where an analyst runs a sample to learn more about it. Malware analysis sandboxes heavily rely on Virtual Machines, their ability to take snapshots and revert to a clean state when required.</p><h2 id="2415b2cc-075b-8004-8241-fc8cc6b0c132" class=""><strong>Construction of a sandbox</strong></h2><p id="2415b2cc-075b-8011-be0d-cdc1f3fe29ab" class="">For malware analysis using sandboxes, the following considerations make the malware analysis effective:</p><ul id="2415b2cc-075b-8053-8444-ed80318ba2e3" class="bulleted-list"><li style="list-style-type:disc">Virtual Machine mimicking the actual target environment of the malware sample</li></ul><ul id="2415b2cc-075b-8094-8bab-f4cee98b49d4" class="bulleted-list"><li style="list-style-type:disc">Ability to take snapshots and revert to clean state</li></ul><ul id="2415b2cc-075b-806e-a25e-e26e5f1fee4e" class="bulleted-list"><li style="list-style-type:disc">OS monitoring software, for example, Procmon, ProcExplorer or Regshot, etc.</li></ul><ul id="2415b2cc-075b-80e0-8031-f676ba33b40f" class="bulleted-list"><li style="list-style-type:disc">Network monitoring software, for example, Wireshark, tcpdump, etc.</li></ul><ul id="2415b2cc-075b-80ea-a20f-d649362a971d" class="bulleted-list"><li style="list-style-type:disc">Control over the network through a dummy DNS server and webserver.</li></ul><ul id="2415b2cc-075b-80c0-94d3-c9c55f35a308" class="bulleted-list"><li style="list-style-type:disc">A mechanism to move analysis logs and malware samples in and out of the Virtual Machine without compromising the host (Be careful with this one. If you have a shared directory with your malware analysis VM that remains accessible when running malware, you might risk malware affecting all files in your shared directory)</li></ul><h2 id="2415b2cc-075b-8082-b39f-d06400eeac08" class=""><strong>Open Source Sandboxes</strong></h2><p id="2415b2cc-075b-80aa-be4f-e1f18d3a4736" class="">Though it is good to understand what a good sandbox is made of, building a sandbox from scratch is not always necessary. One can always set up Open Source Sandboxes. These sandboxes provide the framework for performing basic dynamic analysis and are also customizable to a significant extent to help those with a more adventurous mindset.</p><h3 id="2415b2cc-075b-805b-8363-cadf2bae8f2c" class=""><strong>Cuckoo&#x27;s Sandbox</strong></h3><p id="2415b2cc-075b-80a2-8266-f4b4102d3884" class=""><a href="https://github.com/cuckoosandbox/cuckoo">Cuckoo&#x27;s sandbox</a> is the most widely known sandbox in the malware analysis community. It was developed as part of a Google Summer of Code project in 2010. It is an open-source project that you will often see deployed in SOC environments and with enthusiasts&#x27; home labs. Advantages of Cuckoo&#x27;s sandbox include huge community support, easy-to-understand documentation, and lots of customizations. You can deploy it on your network and let the community signatures guide you into identifying which files are malicious and which are benign because of the vast corpus of community signatures that come with it.</p><p id="2415b2cc-075b-8053-a0e1-f360e394ac09" class="">Cuckoo&#x27;s sandbox has been archived, and an update is pending. It also doesn&#x27;t support Python 3, making it obsolete right now. However, all is not lost because we have alternatives.</p><h3 id="2415b2cc-075b-8023-ada5-dba54b95bc7e" class=""><strong>CAPE Sandbox</strong></h3><p id="2415b2cc-075b-8014-b7dc-dd92adeefc58" class=""><a href="https://github.com/kevoreilly/CAPEv2">CAPE Sandbox</a> is a little more advanced version of Cuckoo&#x27;s sandbox. It supports debugging and memory dumping to support the unpacking of packed malware (We will learn more about packing and unpacking in the advanced malware analysis module). Though beginners can use this sandbox, advanced knowledge is required for making full use of it. A community version of this sandbox is available online, which can be used to test run it before installing. CAPE Sandbox is so far actively developed and supports Python 3.</p><h2 id="2415b2cc-075b-8052-a99a-dd4cb31faf45" class=""><strong>Online Sandboxes:</strong></h2><p id="2415b2cc-075b-806f-8631-ebd23f2cbe4c" class="">Setting up and maintaining a sandbox can be a time-consuming task. Keeping that in view, online sandboxes can be of great help. Some of the most commonly used online sandboxes are as follows:</p><ul id="2415b2cc-075b-80ea-9731-f8c803d9de10" class="bulleted-list"><li style="list-style-type:disc"><a href="https://cuckoo.cert.ee/">Online Cuckoo Sandbox</a></li></ul><ul id="2415b2cc-075b-80bc-900b-f938be51df84" class="bulleted-list"><li style="list-style-type:disc"><a href="https://any.run/">Any.run</a></li></ul><ul id="2415b2cc-075b-80a7-81bc-d21121eab47a" class="bulleted-list"><li style="list-style-type:disc"><a href="https://analyze.intezer.com/">Intezer</a></li></ul><ul id="2415b2cc-075b-804b-b6ae-d07107095e5c" class="bulleted-list"><li style="list-style-type:disc"><a href="https://hybrid-analysis.com/">Hybrid Analysis</a></li></ul><p id="2415b2cc-075b-8011-a1d2-ca3159299ac9" class="">Though online sandboxes provide a useful utility, it is best not to submit a sample online unless you are sure of what you are doing. A better approach is to search for the sample&#x27;s hash on the service you are using to see if someone has already submitted it. Let&#x27;s look at Hybrid Analysis to see what interesting analysis it provides for our sample.</p><h3 id="2415b2cc-075b-8071-86ba-ca38c0346907" class=""><strong>Analyzing samples using Hybrid Analysis</strong></h3><p id="2415b2cc-075b-8078-8b10-f13db7e3de52" class="">On its homepage, we are greeted with the following screen:</p><figure id="2415b2cc-075b-80be-baa7-ca5d158f3fb8" class="image"><a href="https://tryhackme-images.s3.amazonaws.com/user-uploads/61306d87a330ed00419e22e7/room-content/947a74dd9d2ff42810c1a0c91079a1e8.png"><img style="width:692px" src="https://tryhackme-images.s3.amazonaws.com/user-uploads/61306d87a330ed00419e22e7/room-content/947a74dd9d2ff42810c1a0c91079a1e8.png"/></a></figure><p id="2415b2cc-075b-8098-be27-c4f0c3964cd2" class="">As we mentioned, we will not be submitting a sample. Instead, we will search for the hash of our sample. Therefore, we will search for the md5sum of the wannacry sample from the attached VM. We will see that it is already submitted multiple times, and we can choose from the submitted results.</p><figure id="2415b2cc-075b-804d-9bbb-f7e7b8d3a92f" class="image"><a href="https://tryhackme-images.s3.amazonaws.com/user-uploads/61306d87a330ed00419e22e7/room-content/9d8e2a97315e6b458f583d211b4819ba.png"><img style="width:700px" src="https://tryhackme-images.s3.amazonaws.com/user-uploads/61306d87a330ed00419e22e7/room-content/9d8e2a97315e6b458f583d211b4819ba.png"/></a></figure><p id="2415b2cc-075b-805c-972d-dda2bfff2fd9" class="">Let&#x27;s open the one submitted on Windows 7 64 bit from among these.</p><figure id="2415b2cc-075b-8000-90d0-da43a3177d2b" class="image"><a href="https://tryhackme-images.s3.amazonaws.com/user-uploads/61306d87a330ed00419e22e7/room-content/cb173e0611090adc2327e7f5770d89c1.png"><img src="https://tryhackme-images.s3.amazonaws.com/user-uploads/61306d87a330ed00419e22e7/room-content/cb173e0611090adc2327e7f5770d89c1.png"/></a></figure><p id="2415b2cc-075b-80f1-8bf2-f79ef6c77ade" class="">We will see the above interface when we click on the sample. We can see a navigation pane on the right that highlights different parts of the report. We can also see that the verdict is malicious, with a threat score of 100/100 and AV detection of 95%. Below that, we see the overview of the sample&#x27;s behavior. Below that, we will see the mapping to MITRE ATT&amp;CK techniques. We will see the following mapping when we click <code>view all details</code>:</p><figure id="2415b2cc-075b-8076-a3ca-c3a00b4b0aec" class="image"><a href="https://tryhackme-images.s3.amazonaws.com/user-uploads/61306d87a330ed00419e22e7/room-content/9e1a1a01fcf353c9a75c33ab0358a877.png"><img style="width:700px" src="https://tryhackme-images.s3.amazonaws.com/user-uploads/61306d87a330ed00419e22e7/room-content/9e1a1a01fcf353c9a75c33ab0358a877.png"/></a></figure><p id="2415b2cc-075b-80ff-a0b8-caf731de46bc" class="">Below that, we will see some indicators and context information and some static analysis information for the sample. The dynamic analysis part comes below that:</p><figure id="2415b2cc-075b-80a5-aa2e-df4493b6495e" class="image"><a href="https://tryhackme-images.s3.amazonaws.com/user-uploads/61306d87a330ed00419e22e7/room-content/c817a7e0dcaa383e9d9f84bd19f527c1.png"><img style="width:700px" src="https://tryhackme-images.s3.amazonaws.com/user-uploads/61306d87a330ed00419e22e7/room-content/c817a7e0dcaa383e9d9f84bd19f527c1.png"/></a></figure><p id="2415b2cc-075b-80e1-ac87-d1294a44966b" class="">This part provides us with a lot of information about the behavior of the sample when it was run in a sandbox. We can click each process to find more detail about it. In the above screenshot, of particular interest can be the executions of cmd.exe. We can see that the sample is running script files and deleting backups and volume shadow copies, something often done by ransomware operators to stop the victim from restoring their files from these sources.</p><p id="2415b2cc-075b-80b7-b070-d982fc455d8d" class="">Below this section, we will see network analysis of the sample:</p><figure id="2415b2cc-075b-8072-972d-f8b5a8e24989" class="image"><a href="https://tryhackme-images.s3.amazonaws.com/user-uploads/61306d87a330ed00419e22e7/room-content/77053f26e9374259ca622908bcb0fab0.png"><img style="width:700px" src="https://tryhackme-images.s3.amazonaws.com/user-uploads/61306d87a330ed00419e22e7/room-content/77053f26e9374259ca622908bcb0fab0.png"/></a></figure><p id="2415b2cc-075b-80ab-a9d9-fa4ef0781d09" class="">Extracted strings and extracted files are also available in the report. These can provide information about the batch scripts we saw in the processes above.</p><figure id="2415b2cc-075b-8076-849f-fc4c6c21369b" class="image"><a href="https://tryhackme-images.s3.amazonaws.com/user-uploads/61306d87a330ed00419e22e7/room-content/afe475fcc71679a4c07297bdcf60cd48.png"><img style="width:700px" src="https://tryhackme-images.s3.amazonaws.com/user-uploads/61306d87a330ed00419e22e7/room-content/afe475fcc71679a4c07297bdcf60cd48.png"/></a></figure><p id="2415b2cc-075b-80ff-945f-fab6697c1f78" class="">And there are comments from the community at the very end. As we might have seen, we can find many pieces of the puzzle that a malware sample is, using the discussed techniques. However, in some cases, these techniques can prove insufficient to make a decision. Let&#x27;s move to the next task to determine what scenarios can make it challenging to analyze malwa</p><p id="2415b2cc-075b-8097-ab88-e97d473bc5e5" class="">
</p><h3 id="2415b2cc-075b-80d9-a9ab-fc0aec81012b" class="">Questions</h3><ul id="2415b2cc-075b-80ac-81cb-fb4cdb71913e" class="bulleted-list"><li style="list-style-type:disc">Check the hash of the sample &#x27;redline&#x27; on Hybrid analysis and check out the hybrid analysis report. In the process tree, which is the first process launched when the sample is launched?</li></ul><figure id="2415b2cc-075b-8044-8633-fd4998a3358b" class="image"><a href="assets/0823E7B1-B602-4447-88C0-434ED90D26CC.png"><img style="width:685.9605712890625px" src="assets/0823E7B1-B602-4447-88C0-434ED90D26CC.png"/></a></figure><ul id="2415b2cc-075b-803e-8ca3-e6fdae23f94d" class="bulleted-list"><li style="list-style-type:disc">In the process tree, there are two Windows utilities utilized by the malware to perform its activities. What are the names of the two utilities? (Format: utility1.exe and utility2.exe)</li></ul><figure id="2415b2cc-075b-80d3-bafb-ccab81486161" class="image"><a href="assets/EF6A0C67-C6C8-4C25-A098-D8BBA2AF97FF.png"><img style="width:685.9734497070312px" src="assets/EF6A0C67-C6C8-4C25-A098-D8BBA2AF97FF.png"/></a></figure><p id="2415b2cc-075b-8036-8c04-e7c97ccd05ad" class="">
</p><h3 id="2415b2cc-075b-8052-b854-cc69e1720671" class="">Anti-analysis techniques</h3><p id="2415b2cc-075b-8085-bf66-da4a639faa87" class="">While the security researchers are devising techniques and tools to analyze malware, the malware authors are working on rendering these tools and techniques ineffective. We found a great deal of information in the previous tasks about the malware we analyzed. However, there are ways malware authors can make our life difficult. Below are some of the techniques used by malware authors to do the same.</p><h2 id="2415b2cc-075b-80d2-a843-d8405ba56171" class=""><strong>Packing and Obfuscation:</strong></h2><p id="2415b2cc-075b-809f-a36e-cb8f25d0d482" class="">Malware authors often use packing and obfuscation to make an analyst&#x27;s life difficult. A packer obfuscates, compresses, or encrypts the contents of malware. These techniques make it difficult to analyze malware statically. Specifically, a packed malware will not show important information when running a string search against it. For example, let&#x27;s run a string search against the file named <code>zmsuz3pinwl</code> in the Samples folder in the attached VM.</p><p id="2415b2cc-075b-8051-87ab-dd1ce7322eeb" class="">Remnux</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="2415b2cc-075b-80fa-a10d-ec1c5a217615" class="code code-wrap"><code class="language-Shell" style="white-space:pre-wrap;word-break:break-all">user@machine$ strings zmsuz3pinwl!This program cannot be run in DOS mode.
RichH
.rsrc
.data
.adata
dApB
Qtq5
wn;3b:TC,n
*tVlr
D6j[
^sZ&quot;4V
JIoL
j~AI
tYFu
7^V1
vYB09
&quot;PeHy
M4AF#
3134
%}W\+
3A;a5
dLq&lt;
.
.
.
.
.
.
</code></pre><p id="2415b2cc-075b-8082-ad7a-ddfc2060eb1d" class="">We will notice that this sample contains mainly garbage strings that don&#x27;t provide much value to us. Let&#x27;s run pecheck on the sample to see what else we get.</p><p id="2415b2cc-075b-80d0-b739-ce0f8e5c28ba" class="">Remnux</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="2415b2cc-075b-803a-8957-fc5d09c4aadb" class="code code-wrap"><code class="language-Shell" style="white-space:pre-wrap;word-break:break-all">user@machine$ pecheck zmsuz3pinwl PE check for &#x27;zmsuz3pinwl&#x27;:
Entropy: 7.978052 (Min=0.0, Max=8.0)
MD5     hash: 1ebb1e268a462d56a389e8e1d06b4945
SHA-1   hash: 1ecc0b9f380896373e81ed166c34a89bded873b5
SHA-256 hash: 98c6cf0b129438ec62a628e8431e790b114ba0d82b76e625885ceedef286d6f5
SHA-512 hash: 6921532b4b5ed9514660eb408dfa5d28998f52aa206013546f9eb66e26861565f852ec7f04c85ae9be89e7721c4f1a5c31d2fae49b0e7fdfd20451191146614a
 entropy: 7.999788 (Min=0.0, Max=8.0)
 entropy: 7.961048 (Min=0.0, Max=8.0)
 entropy: 7.554513 (Min=0.0, Max=8.0)
.rsrc entropy: 6.938747 (Min=0.0, Max=8.0)
 entropy: 0.000000 (Min=0.0, Max=8.0)
.data entropy: 7.866646 (Min=0.0, Max=8.0)
.adata entropy: 0.000000 (Min=0.0, Max=8.0)
Dump Info:
----------Parsing Warnings----------

Suspicious flags set for section 0. Both IMAGE_SCN_MEM_WRITE and IMAGE_SCN_MEM_EXECUTE are set. This might indicate a packed executable.

Suspicious flags set for section 1. Both IMAGE_SCN_MEM_WRITE and IMAGE_SCN_MEM_EXECUTE are set. This might indicate a packed executable.

Suspicious flags set for section 2. Both IMAGE_SCN_MEM_WRITE and IMAGE_SCN_MEM_EXECUTE are set. This might indicate a packed executable.

Suspicious flags set for section 3. Both IMAGE_SCN_MEM_WRITE and IMAGE_SCN_MEM_EXECUTE are set. This might indicate a packed executable.

Suspicious flags set for section 4. Both IMAGE_SCN_MEM_WRITE and IMAGE_SCN_MEM_EXECUTE are set. This might indicate a packed executable.

Suspicious flags set for section 5. Both IMAGE_SCN_MEM_WRITE and IMAGE_SCN_MEM_EXECUTE are set. This might indicate a packed executable.

Suspicious flags set for section 6. Both IMAGE_SCN_MEM_WRITE and IMAGE_SCN_MEM_EXECUTE are set. This might indicate a packed executable.

Imported symbols contain entries typical of packed executables.
.
.
.
.
.
.
.
</code></pre><p id="2415b2cc-075b-8068-914e-f392391adeab" class="">As suspected, we see that the executable has characteristics typical of a packed executable, as per pecheck. We will notice that there is no .text section in the sample, and other sections have execute permissions, which shows that these sections contain executable instructions or will be populated with executable instructions during execution. We will also see that this sample does not have many imports that might show us its functionality, as we saw with the previous sample.</p><p id="2415b2cc-075b-80d0-9987-c81c4c42454a" class="">For analysis of packed executables, the first step is generally to unpack the sample. This is an advanced topic that will be covered in the upcoming rooms.</p><h2 id="2415b2cc-075b-80b8-8e5a-d5c69dbb3657" class=""><strong>Sandbox evasion:</strong></h2><p id="2415b2cc-075b-8085-bba7-f8b4bb42ac13" class="">As we have seen previously, we can always run a sample in a sandbox to analyze it. In many cases, that might help us analyze samples that evade our basic static analysis techniques. However, malware authors have some tricks up their sleeves that hamper that effort. Some of these techniques are as follows:</p><ul id="2415b2cc-075b-807e-911a-d37204a07db6" class="bulleted-list"><li style="list-style-type:disc"><strong>Long sleep calls: </strong>Malware authors know that sandboxes run for a limited time. Therefore, they program the malware not to perform any activity for a long time after execution. This is often accomplished through long sleep calls. The purpose of this technique is to time out the sandbox.</li></ul><ul id="2415b2cc-075b-80df-8711-fc298e17488d" class="bulleted-list"><li style="list-style-type:disc"><strong>User activity detection: </strong>Some malware samples will wait for user activity before performing malicious activity. The premise of this technique is that there will be no user in a sandbox. Therefore there will be no mouse movement or typing on the keyboard. Advanced malware also detects patterns in mouse movements that are often used in automated sandboxes. This technique is designed to bypass automated sandbox detection.</li></ul><ul id="2415b2cc-075b-808e-92b2-c347764ce482" class="bulleted-list"><li style="list-style-type:disc"><strong>Footprinting user activity: </strong>Some malware checks for user files or activity, like if there are any files in the MS Office history or internet browsing history. If no or little activity is found, the malware will consider the machine as a sandbox and quit.</li></ul><ul id="2415b2cc-075b-8035-a2b2-e34317c3f15c" class="bulleted-list"><li style="list-style-type:disc"><strong>Detecting VMs: </strong>Sandboxes run on virtual machines. Virtual machines leave artifacts that can be identified by malware. For example, some drivers installed in VMs being run on VMWare or Virtualbox give away the fact that the machine is a VM. Malware authors often associate VMs with sandboxes and would terminate the malware if a VM is detected.</li></ul><p id="2415b2cc-075b-8087-b7fe-cbc24d3b1063" class="">The above list is not exhaustive but gives us an idea of what to expect when analyzing malware. In a future module dedicated to malware analysis, we will discuss these techniques and ways to detect malware that employs them.</p><p id="2415b2cc-075b-80de-b607-f65dd611b96f" class="">
</p><h3 id="2415b2cc-075b-8062-905a-cd1fb03dfa2d" class="">CONCLUSION</h3><p id="2415b2cc-075b-803a-a979-dd2648f688cb" class="">That was a primer on malware analysis. However, this was just scratching the surface. So far, we learned:</p><ul id="2415b2cc-075b-80ae-b42b-e45ef680b7f4" class="bulleted-list"><li style="list-style-type:disc">Static and Dynamic analysis of malware</li></ul><ul id="2415b2cc-075b-80ee-9114-c04a193a26b3" class="bulleted-list"><li style="list-style-type:disc">Finding strings, calculating hashes, and running AV scans on malware</li></ul><ul id="2415b2cc-075b-801c-a06e-c90a81acb9ba" class="bulleted-list"><li style="list-style-type:disc">Introduction to the PE header and how to use information from it in malware analysis</li></ul><ul id="2415b2cc-075b-80de-9556-f21262adbe4a" class="bulleted-list"><li style="list-style-type:disc">Sandboxing and different online sandboxes that we can use</li></ul><ul id="2415b2cc-075b-8008-85ea-e5baee7008c3" class="bulleted-list"><li style="list-style-type:disc">How malware evades the techniques we just discussed.</li></ul><p id="2415b2cc-075b-800c-97f0-fb2843329e78" class="">
</p></div></article><span class="sans" style="font-size:14px;padding-top:2em"></span></body></html>